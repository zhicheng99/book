<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>仿有道云笔记网页剪报效果 抽取网页主内容区的算法原理 | 日常收集</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/book/assets/css/0.styles.d473fa6d.css" as="style"><link rel="preload" href="/book/assets/js/app.5837577d.js" as="script"><link rel="preload" href="/book/assets/js/3.0d5fb1e8.js" as="script"><link rel="preload" href="/book/assets/js/160.2c6daaf8.js" as="script"><link rel="preload" href="/book/assets/js/4.4c5f7830.js" as="script"><link rel="prefetch" href="/book/assets/js/10.7e7e15e3.js"><link rel="prefetch" href="/book/assets/js/100.c6e21005.js"><link rel="prefetch" href="/book/assets/js/101.5440e694.js"><link rel="prefetch" href="/book/assets/js/102.d066b8fb.js"><link rel="prefetch" href="/book/assets/js/103.a637cd07.js"><link rel="prefetch" href="/book/assets/js/104.4671f2d2.js"><link rel="prefetch" href="/book/assets/js/105.6bbaec44.js"><link rel="prefetch" href="/book/assets/js/106.c3b4924e.js"><link rel="prefetch" href="/book/assets/js/107.8d44540e.js"><link rel="prefetch" href="/book/assets/js/108.3aae0552.js"><link rel="prefetch" href="/book/assets/js/109.5dba325c.js"><link rel="prefetch" href="/book/assets/js/11.44217601.js"><link rel="prefetch" href="/book/assets/js/110.a40e4289.js"><link rel="prefetch" href="/book/assets/js/111.47d90c89.js"><link rel="prefetch" href="/book/assets/js/112.39a68b1f.js"><link rel="prefetch" href="/book/assets/js/113.4e6463dc.js"><link rel="prefetch" href="/book/assets/js/114.967075e2.js"><link rel="prefetch" href="/book/assets/js/115.33921643.js"><link rel="prefetch" href="/book/assets/js/116.ea0df0ff.js"><link rel="prefetch" href="/book/assets/js/117.07ad7ce4.js"><link rel="prefetch" href="/book/assets/js/118.79b24a4d.js"><link rel="prefetch" href="/book/assets/js/119.7a82943c.js"><link rel="prefetch" href="/book/assets/js/12.47f0516b.js"><link rel="prefetch" href="/book/assets/js/120.4d8016fe.js"><link rel="prefetch" href="/book/assets/js/121.9fce224e.js"><link rel="prefetch" href="/book/assets/js/122.60e9d0a0.js"><link rel="prefetch" href="/book/assets/js/123.f0183da7.js"><link rel="prefetch" href="/book/assets/js/124.c09a686c.js"><link rel="prefetch" href="/book/assets/js/125.17f3f2f4.js"><link rel="prefetch" href="/book/assets/js/126.5d06ad3c.js"><link rel="prefetch" href="/book/assets/js/127.509b0029.js"><link rel="prefetch" href="/book/assets/js/128.833eb16c.js"><link rel="prefetch" href="/book/assets/js/129.09d92397.js"><link rel="prefetch" href="/book/assets/js/13.5ef8e835.js"><link rel="prefetch" href="/book/assets/js/130.d9e17f5c.js"><link rel="prefetch" href="/book/assets/js/131.682bdab7.js"><link rel="prefetch" href="/book/assets/js/132.c9566b96.js"><link rel="prefetch" href="/book/assets/js/133.1a253cb2.js"><link rel="prefetch" href="/book/assets/js/134.fd4dd490.js"><link rel="prefetch" href="/book/assets/js/135.dbe02774.js"><link rel="prefetch" href="/book/assets/js/136.5bbded3d.js"><link rel="prefetch" href="/book/assets/js/137.9b69ce3a.js"><link rel="prefetch" href="/book/assets/js/138.9c610e7f.js"><link rel="prefetch" href="/book/assets/js/139.dccc188d.js"><link rel="prefetch" href="/book/assets/js/14.3d533f57.js"><link rel="prefetch" href="/book/assets/js/140.9a7c410d.js"><link rel="prefetch" href="/book/assets/js/141.ebe0046a.js"><link rel="prefetch" href="/book/assets/js/142.bef18da4.js"><link rel="prefetch" href="/book/assets/js/143.1c68a47a.js"><link rel="prefetch" href="/book/assets/js/144.2c49e7f5.js"><link rel="prefetch" href="/book/assets/js/145.ed8f75fd.js"><link rel="prefetch" href="/book/assets/js/146.48ff7127.js"><link rel="prefetch" href="/book/assets/js/147.674d8e71.js"><link rel="prefetch" href="/book/assets/js/148.ffe8e1f9.js"><link rel="prefetch" href="/book/assets/js/149.2c5cedbc.js"><link rel="prefetch" href="/book/assets/js/15.64e47055.js"><link rel="prefetch" href="/book/assets/js/150.a81273ed.js"><link rel="prefetch" href="/book/assets/js/151.9d9aac2d.js"><link rel="prefetch" href="/book/assets/js/152.192edee2.js"><link rel="prefetch" href="/book/assets/js/153.1f5d7e62.js"><link rel="prefetch" href="/book/assets/js/154.b0513355.js"><link rel="prefetch" href="/book/assets/js/155.b9288b4f.js"><link rel="prefetch" href="/book/assets/js/156.c52f5143.js"><link rel="prefetch" href="/book/assets/js/157.2517dc4b.js"><link rel="prefetch" href="/book/assets/js/158.85b05e63.js"><link rel="prefetch" href="/book/assets/js/159.57441629.js"><link rel="prefetch" href="/book/assets/js/16.21614f1d.js"><link rel="prefetch" href="/book/assets/js/161.68378ada.js"><link rel="prefetch" href="/book/assets/js/162.a5b7e8af.js"><link rel="prefetch" href="/book/assets/js/163.f8b1a67b.js"><link rel="prefetch" href="/book/assets/js/164.6ddf9148.js"><link rel="prefetch" href="/book/assets/js/165.21a81d79.js"><link rel="prefetch" href="/book/assets/js/166.f06daa8c.js"><link rel="prefetch" href="/book/assets/js/167.65966c57.js"><link rel="prefetch" href="/book/assets/js/168.7eba77a3.js"><link rel="prefetch" href="/book/assets/js/169.4037418f.js"><link rel="prefetch" href="/book/assets/js/17.b8b34eba.js"><link rel="prefetch" href="/book/assets/js/170.23e454be.js"><link rel="prefetch" href="/book/assets/js/171.aed743f2.js"><link rel="prefetch" href="/book/assets/js/172.efa5d7f6.js"><link rel="prefetch" href="/book/assets/js/173.69f1af6e.js"><link rel="prefetch" href="/book/assets/js/174.4ab7a601.js"><link rel="prefetch" href="/book/assets/js/175.463316ef.js"><link rel="prefetch" href="/book/assets/js/176.e6150d0c.js"><link rel="prefetch" href="/book/assets/js/18.68a1d4d3.js"><link rel="prefetch" href="/book/assets/js/19.323db867.js"><link rel="prefetch" href="/book/assets/js/20.cfa0aec5.js"><link rel="prefetch" href="/book/assets/js/21.6229732b.js"><link rel="prefetch" href="/book/assets/js/22.6cc91e41.js"><link rel="prefetch" href="/book/assets/js/23.fb025ad5.js"><link rel="prefetch" href="/book/assets/js/24.36f14df7.js"><link rel="prefetch" href="/book/assets/js/25.eca0455e.js"><link rel="prefetch" href="/book/assets/js/26.cdaab27d.js"><link rel="prefetch" href="/book/assets/js/27.e436033e.js"><link rel="prefetch" href="/book/assets/js/28.1d43f2e5.js"><link rel="prefetch" href="/book/assets/js/29.13191716.js"><link rel="prefetch" href="/book/assets/js/30.64a7a28d.js"><link rel="prefetch" href="/book/assets/js/31.5caab6ef.js"><link rel="prefetch" href="/book/assets/js/32.52c8742c.js"><link rel="prefetch" href="/book/assets/js/33.12aba373.js"><link rel="prefetch" href="/book/assets/js/34.75da57c9.js"><link rel="prefetch" href="/book/assets/js/35.ee075cac.js"><link rel="prefetch" href="/book/assets/js/36.3ca8d8ad.js"><link rel="prefetch" href="/book/assets/js/37.f96e5b12.js"><link rel="prefetch" href="/book/assets/js/38.43de425f.js"><link rel="prefetch" href="/book/assets/js/39.1dd2fbe4.js"><link rel="prefetch" href="/book/assets/js/40.1b68ef64.js"><link rel="prefetch" href="/book/assets/js/41.9e49e0cf.js"><link rel="prefetch" href="/book/assets/js/42.03fbcb0f.js"><link rel="prefetch" href="/book/assets/js/43.fe97e66d.js"><link rel="prefetch" href="/book/assets/js/44.90269fc6.js"><link rel="prefetch" href="/book/assets/js/45.4eaae730.js"><link rel="prefetch" href="/book/assets/js/46.abb995b5.js"><link rel="prefetch" href="/book/assets/js/47.efefb847.js"><link rel="prefetch" href="/book/assets/js/48.a86022f3.js"><link rel="prefetch" href="/book/assets/js/49.996807d8.js"><link rel="prefetch" href="/book/assets/js/5.a3244244.js"><link rel="prefetch" href="/book/assets/js/50.a83cef96.js"><link rel="prefetch" href="/book/assets/js/51.e333bb78.js"><link rel="prefetch" href="/book/assets/js/52.5d0f6c72.js"><link rel="prefetch" href="/book/assets/js/53.e42cc193.js"><link rel="prefetch" href="/book/assets/js/54.4524c464.js"><link rel="prefetch" href="/book/assets/js/55.2db723ed.js"><link rel="prefetch" href="/book/assets/js/56.4879d74b.js"><link rel="prefetch" href="/book/assets/js/57.1aafc455.js"><link rel="prefetch" href="/book/assets/js/58.ae55aef1.js"><link rel="prefetch" href="/book/assets/js/59.9e4b468e.js"><link rel="prefetch" href="/book/assets/js/6.961a656a.js"><link rel="prefetch" href="/book/assets/js/60.22aa4a5b.js"><link rel="prefetch" href="/book/assets/js/61.0907f36e.js"><link rel="prefetch" href="/book/assets/js/62.f75b6320.js"><link rel="prefetch" href="/book/assets/js/63.11581819.js"><link rel="prefetch" href="/book/assets/js/64.6e01c8f8.js"><link rel="prefetch" href="/book/assets/js/65.29ac8546.js"><link rel="prefetch" href="/book/assets/js/66.5b6c0025.js"><link rel="prefetch" href="/book/assets/js/67.9cb18842.js"><link rel="prefetch" href="/book/assets/js/68.c36038ef.js"><link rel="prefetch" href="/book/assets/js/69.8382b40e.js"><link rel="prefetch" href="/book/assets/js/7.e5eadd5e.js"><link rel="prefetch" href="/book/assets/js/70.e1cc77b1.js"><link rel="prefetch" href="/book/assets/js/71.0398ac26.js"><link rel="prefetch" href="/book/assets/js/72.2d568e0e.js"><link rel="prefetch" href="/book/assets/js/73.012d3896.js"><link rel="prefetch" href="/book/assets/js/74.22068dc5.js"><link rel="prefetch" href="/book/assets/js/75.6fea3cc7.js"><link rel="prefetch" href="/book/assets/js/76.1607821a.js"><link rel="prefetch" href="/book/assets/js/77.df49cf9b.js"><link rel="prefetch" href="/book/assets/js/78.d30f63dd.js"><link rel="prefetch" href="/book/assets/js/79.b5edd36e.js"><link rel="prefetch" href="/book/assets/js/8.3201113b.js"><link rel="prefetch" href="/book/assets/js/80.7784e3a4.js"><link rel="prefetch" href="/book/assets/js/81.3d3a35b2.js"><link rel="prefetch" href="/book/assets/js/82.cd5814e6.js"><link rel="prefetch" href="/book/assets/js/83.f7b8fe61.js"><link rel="prefetch" href="/book/assets/js/84.52d944b4.js"><link rel="prefetch" href="/book/assets/js/85.6f911071.js"><link rel="prefetch" href="/book/assets/js/86.4ba7470b.js"><link rel="prefetch" href="/book/assets/js/87.0b431d7f.js"><link rel="prefetch" href="/book/assets/js/88.cf59763b.js"><link rel="prefetch" href="/book/assets/js/89.d8cafb07.js"><link rel="prefetch" href="/book/assets/js/9.5cf4899a.js"><link rel="prefetch" href="/book/assets/js/90.1bab1d5f.js"><link rel="prefetch" href="/book/assets/js/91.4545c322.js"><link rel="prefetch" href="/book/assets/js/92.02880ae1.js"><link rel="prefetch" href="/book/assets/js/93.72ffce48.js"><link rel="prefetch" href="/book/assets/js/94.a6d57b47.js"><link rel="prefetch" href="/book/assets/js/95.dba426bb.js"><link rel="prefetch" href="/book/assets/js/96.e98dde02.js"><link rel="prefetch" href="/book/assets/js/97.9f432a0f.js"><link rel="prefetch" href="/book/assets/js/98.68aa75ea.js"><link rel="prefetch" href="/book/assets/js/99.09f28172.js"><link rel="prefetch" href="/book/assets/js/vendors~docsearch.c8693219.js">
    <link rel="stylesheet" href="/book/assets/css/0.styles.d473fa6d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/book/" class="home-link router-link-active"><!----> <span class="site-name">日常收集</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dom的事件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>element-ui</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Qcanvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/365.html" class="sidebar-link"> WASM 在动画引擎中的设计优化</a></li><li><a href="/book/364.html" class="sidebar-link"> 你管这破玩意叫指针？</a></li><li><a href="/book/362.html" class="sidebar-link"> 图说 WebAssembly</a></li><li><a href="/book/328.html" class="sidebar-link"> 从哲学层面浅谈计算机学习方法论</a></li><li><a href="/book/324.html" class="sidebar-link"> 微信游览器，解决安卓和ios自动播放音乐</a></li><li><a href="/book/323.html" class="sidebar-link"> CSS3 animation属性中的steps功能符深入介绍</a></li><li><a href="/book/322.html" class="sidebar-link"> 前端搞工程化：从零打造性能检测库「源码 + 视频」</a></li><li><a href="/book/321.html" class="sidebar-link"> 还在看那些老掉牙的性能优化文章么？这些最新性能指标了解下</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/301.html" class="sidebar-link">从App store下载App的不同版本ipa文件----很多东西也不是越新越好，比如APP——在 iPhone 上尤其如此</a></li><li><a href="/book/294.html" class="sidebar-link">迟子建老师的《一坛猪油》</a></li><li><a href="/book/288.html" class="sidebar-link">文本文档的协同编辑实现</a></li><li><a href="/book/287.html" class="sidebar-link">再见，整洁代码</a></li><li><a href="/book/286.html" class="sidebar-link"> 可以在 Nginx 中运行 JavaScript，厉害了！</a></li><li><a href="/book/284.html" class="sidebar-link"> word中批量调整图片大小</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>electron打包的一些问题</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/274.html" class="sidebar-link"> 文件分片代码</a></li><li><a href="/book/273.html" class="sidebar-link"> 重学 JS：为啥 await 不能用在 forEach 中详解</a></li><li><a href="/book/269.html" class="sidebar-link"> Excel函数之王，Vlookup到底怎么用？</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/248.html" class="sidebar-link"> 《提问的智慧》精读注解版</a></li><li><a href="/book/199.html" class="sidebar-link"> js监听div的resize事件</a></li><li><a href="/book/198.html" class="sidebar-link"> 引入第三方字体体积太大的问题</a></li><li><a href="/book/195.html" class="sidebar-link"> 多行溢出省略号显示（css/js）实现！</a></li><li><a href="/book/190.html" class="sidebar-link">今天带大家一起来看看下，如何实现“划词高亮”功能。</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>算法</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/book/50.html" aria-current="page" class="active sidebar-link"> 仿有道云笔记网页剪报效果 抽取网页主内容区的算法原理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工作中解决的疑难问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/135.html" class="sidebar-link"> 深夜，我偷听到程序员要对session下手</a></li><li><a href="/book/132.html" class="sidebar-link"> 读 《深入浅出webpack》</a></li><li><a href="/book/103.html" class="sidebar-link"> 一道被人轻视的前端面试题</a></li><li><a href="/book/101.html" class="sidebar-link">部分前端面试题参考答案</a></li><li><a href="/book/80.html" class="sidebar-link">SVGDeveloper制作矢量地图教程详解</a></li><li><a href="/book/76.html" class="sidebar-link">VisualStudio2010创建的WCF（.dll）服务第一个应用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="仿有道云笔记网页剪报效果-抽取网页主内容区的算法原理"><a href="#仿有道云笔记网页剪报效果-抽取网页主内容区的算法原理" class="header-anchor">#</a> 仿有道云笔记网页剪报效果 抽取网页主内容区的算法原理</h1> <h2 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h2> <p>为所有 dom （body.childNodes）节点评分，分数最高的即为主内容节点
影响某一个节点评分的因素主要有以下几项</p> <ol><li>文本节点<code>内容不为空</code> 的数量及内容里的标点符号的数量</li> <li>文本节点内容的长度</li> <li>图片或 svg 的数量</li> <li>图片或 svg 的大小</li> <li>标签的 class 或 id 使用了内容区常用的一些字符串（如 content article 等） 这些是需要加分的</li> <li>标签的 class 或 id 使用了非内容区常用的一些字符串 （如 head foot 等）这些是需要减分的</li> <li>标签的位置 （比如距页面顶部都超过一屏了）这样基本就可能排除这样的节点了</li></ol> <h3 id="实现过程"><a href="#实现过程" class="header-anchor">#</a> 实现过程</h3> <h4 id="第一步-取得所有节点"><a href="#第一步-取得所有节点" class="header-anchor">#</a> 第一步：取得所有节点</h4> <p>取得页面的所有 dom 节点（用递归把所有的子节点 <code>childNodes</code> 都列出来），过滤掉不需要参与评分的节点（也就是这些节点不太可能做为主内容的容器，当然也不排除极端情况，但我们只处理绝大多数）
需要过滤掉的节点有 link img i a svg style script select input textarea
还有 nodeType = 3 的内容为空的文本节点，nodeType==8 的注释节点</p> <blockquote><p>循环取得节点的同时 要统计各个评分因素的数量</p></blockquote> <h4 id="第二步-转化为评分"><a href="#第二步-转化为评分" class="header-anchor">#</a> 第二步：转化为评分</h4> <p>对第一步统计出来的评分因素的量转化为具体分数</p> <h4 id="第三步-排序"><a href="#第三步-排序" class="header-anchor">#</a> 第三步：排序</h4> <p>根据评分对节点进行一次降序排序，那么取出来的第一个就是所要找的主内容节点</p> <h4 id="注意"><a href="#注意" class="header-anchor">#</a> 注意：</h4> <p>如果要涵盖所有的网页，这个是不太可能的，对一些写得比较规范（页面结构清晰，class 和 id 名称运用也比较准确），内容所占的篇幅比较大的网页，那么选中主内容区的成功率是比较高的；反之，成功率就没那么高了；尤其是一些网页，可能是自动生成的，class 或 id 都是一些随机数，可能还存在大篇幅的广告区，成功率会更低。</p> <p>总之，这种算法是个不断优化的过程。</p> <h4 id="附类文件"><a href="#附类文件" class="header-anchor">#</a> 附类文件</h4> <div class="language- extra-class"><pre class="language-text"><code>

function Collect(){

	this.allNode = [];
	this.baseScore = 10;

	//不太可能做为主内容标签的 不参与评分
	this.notContentTagObj = {
		&quot;p&quot;:1,
		&quot;a&quot;:1,
		&quot;i&quot;:1,
		&quot;span&quot;:1,
		&quot;form&quot;:1,
		&quot;li&quot;:1,
		&quot;ul&quot;:1,
		&quot;ol&quot;:1,
		&quot;input&quot;:1,
		&quot;select&quot;:1,
		&quot;textarea&quot;:1,
		&quot;code&quot;:1,
		&quot;pre&quot;:1,
		&quot;button&quot;:1,
		&quot;img&quot;:1,
		&quot;h1&quot;:1,
		&quot;h2&quot;:1,
		&quot;h3&quot;:1,
		&quot;h4&quot;:1,
		&quot;h5&quot;:1,
		&quot;h6&quot;:1,
		&quot;meta&quot;:1,
		&quot;link&quot;:1,
		&quot;script&quot;:1,
		&quot;figure&quot;:1,
		&quot;svg&quot;:1,
		&quot;path&quot;:1,
		&quot;blockquote&quot;:1,
		&quot;table&quot;:1,
		&quot;thead&quot;:1,
		&quot;tbody&quot;:1,
		&quot;th&quot;:1,
		&quot;tr&quot;:1,
		&quot;td&quot;:1,
		&quot;widget&quot;:1,
		&quot;iframe&quot;:1
	};

	this.notConClassOrId = new RegExp(/(head|foot|side|comment|recommend|tag|widget)/ig);
	this.isConClassOrId = new RegExp(/(content|article)/ig);

	this.punctuationReg = new RegExp(/(\.|,|;|'|“|:|。|，|、|；|’|&quot;|：\(|\))/g);




	//宽度小于200 不参与评分
	this.MinRangeW = 200; 

	//高度小于50 不参与评分
	this.MinRangeH = 50;

}
Collect.prototype.getPoint = function(obj) {
    var t = obj.offsetTop; //获取该元素对应父容器的上边距
    var l = obj.offsetLeft; //对应父容器的上边距
    //判断是否有父容器，如果存在则累加其边距
    while (obj = obj.offsetParent) {//等效 obj = obj.offsetParent;while (obj != undefined)

    		t += obj.offsetTop; //叠加父容器的上边距
	        l += obj.offsetLeft; //叠加父容器的左边距
   
    }
 
    return {
    	top:t,
    	left:l
    }
};
Collect.prototype.getAllNode = function(dom) {
	var _this = this;
	var tmp = [];
	var innerF = function(dom){
		let child = dom.children;
		// let child = dom.childNodes;


		if(child &amp;&amp; (child.length&gt;0)){

			let cLen = child.length;
			for (let i = 0; i &lt; cLen; i++) {

				 


				// console.log(child[i].tagName.toLowerCase());
				// console.log(!_this.notContentTagReg.test(child[i].tagName.toLowerCase()));

				if(
					(!_this.notContentTagObj[child[i].tagName.toLowerCase()])
					// !(_this.notContentTagReg.test(child[i].tagName.toLowerCase())) 
					&amp;&amp; (child[i].clientWidth &gt; _this.MinRangeW)
					&amp;&amp; (child[i].clientHeight &gt; _this.MinRangeH)


					){

					// console.log(child[i].clientWidth);
					child[i].score = _this.baseScore;
					var pos = _this.getPoint(child[i]);
					if(pos){
						child[i].domPosTop = pos.top;
						child[i].domPosLeft = pos.left;
					}
					_this.allNode.push(child[i]);
				}

					_this.getAllNode.call(_this,child[i]);
			}
		}else{
			console.log('循环完毕');
		}
	}

	innerF(dom);


};
Collect.prototype.filterNode = function() {

	var _this = this;
	var tmp = [];
	this.allNode.filter(item=&gt;{
		console.log(item.tagName.toLowerCase());
		console.log(!_this.notContentTagReg.test(item.tagName.toLowerCase()));

		// if(!_this.notContentTagReg.test(item.tagName.toLowerCase())){
		if(

			(item.tagName.toLowerCase() !='input')

			){
			tmp.push(item);

		}

		// console.log(item.tagName.toLowerCase());
		// console.log(!_this.notContentTagReg.test(item.tagName.toLowerCase()));


		// return !_this.notContentTagReg.test(item.tagName.toLowerCase());

	})

	console.log(tmp);

	// this.allNode = tmp;

};
Collect.prototype.setBasicScore = function() {
	for (var i = 0; i &lt; this.allNode.length; i++) {
		this.allNode[i].score = 10;
	}
};
Collect.prototype.isString = function(s) {
	if(Object.prototype.toString.call(s)=='[object String]'){
		return true;
	}else{
		return false;
	}
};
Collect.prototype.updateScoreByTagName_Class_Id = function() {

	for (var i = 0; i &lt; this.allNode.length; i++) {
		if(
			this.isString(this.allNode[i].id) ||
			this.isString(this.allNode[i].className)

			){

			if(
				this.notConClassOrId.test(this.allNode[i].id.toLowerCase()) ||
				this.notConClassOrId.test(this.allNode[i].className.toLowerCase()) 


				)
			{

				this.allNode[i].score--;

			}

			if(
				this.isConClassOrId.test(this.allNode[i].id.toLowerCase()) ||
				this.isConClassOrId.test(this.allNode[i].className.toLowerCase()) 

				)
			{

				this.allNode[i].score++;

			}


		}
	}

	this.updateAllNode();


};
Collect.prototype.updateScoreByPunctuation = function() {

	var _this = this;

	var setParentScore = function(dom,score){

		if(typeof dom.score !='undefined'){
			dom.score +=score;
		}else{

			setParentScore(dom.parentElement,score);

		}

	}

	var innerF = function(dom){

		var child = dom.children;
		var len = child.length;
		var score = 0;
		for (var i = 0; i &lt; len; i++) {
			if(typeof child[i].score == 'undefined'){

				if(child[i].innerText){
					var tmp = child[i].innerText.match(_this.punctuationReg);

					if(tmp!==null &amp;&amp; (tmp.length &gt;0)){
						score+= tmp.length;
					}

				}

			}
		}

		setParentScore(dom,score); //累积分数加到父级上  父级必须是有score属性的 也就是必须是在this.allNode里的
		// dom.score +=score;

		child.children &amp;&amp; innerF(child.children);

	}

	//一直找到每个节点的没有评分的子项为止
	//没有评分的节点计算内容里的标点符号数量  累计的分数给到它的父级
	for (var i = 0; i &lt; this.allNode.length; i++) {

		innerF(this.allNode[i]);

	}
};

Collect.prototype.updateScoreByImgOrSvg = function() {

	var _this = this;

	var setParentScore = function(dom,score){

		if(typeof dom.score !='undefined'){
			dom.score +=score;
		}else{

			setParentScore(dom.parentElement,score);

		}

	}

	var innerF = function(dom){

		var child = dom.children;
		var len = child.length;
		var imgNum = 0;
		var score = 0;
		for (var i = 0; i &lt; len; i++) {
			if(typeof child[i].score == 'undefined'){

				if(
					 (child[i].tagName.toLowerCase()== 'img') 
					 || (child[i].tagName.toLowerCase()== 'svg') 

					){
					 if(child[i].offsetWidth &gt; 200){
					 	imgNum++;
					 }

				}

			}
		}

		if(imgNum&gt;2){
			score +=imgNum*6;
		}else if(imgNum&gt;4){
			score +=imgNum*8;
		}else{
			score +=imgNum;
		}



		setParentScore(dom,score); //累积分数加到父级上  父级必须是有score属性的 也就是必须是在this.allNode里的
		// dom.score +=score;

		child.children &amp;&amp; innerF(child.children);

	}
	//计算子项的图片数量 
	for (var i = 0; i &lt; this.allNode.length; i++) {

		innerF(this.allNode[i]);

	}

};
Collect.prototype.updateScoreByCodeTag = function() {

	var _this = this;

	var setParentScore = function(dom,score){

		if(typeof dom.score !='undefined'){
			dom.score +=score;
		}else{

			setParentScore(dom.parentElement,score);

		}

	}

	var innerF = function(dom){

		var child = dom.children;
		var len = child.length;
		var score = 0;
		for (var i = 0; i &lt; len; i++) {
			if(typeof child[i].score == 'undefined'){

				if(
					 (child[i].tagName.toLowerCase()== 'pre') 
					 || (child[i].tagName.toLowerCase()== 'code') 

					){
					 	score+=5;

				}

			}
		}

		  

		setParentScore(dom,score); //累积分数加到父级上  父级必须是有score属性的 也就是必须是在this.allNode里的
		// dom.score +=score;

		child.children &amp;&amp; innerF(child.children);

	}
	//计算子项的图片数量 
	for (var i = 0; i &lt; this.allNode.length; i++) {

		innerF(this.allNode[i]);

	}


};
Collect.prototype.updateByDomPosTop = function() {

	//根据距body的距离进行减分 数值越大 减得越多 以50为单位
	//
	for (var i = 0; i &lt; this.allNode.length; i++) {
		if(this.allNode[i].domPosTop){
			this.allNode[i].score -=(this.allNode[i].domPosTop/50);
		}

	}

};
Collect.prototype.updateAllNode = function() {

	//小于基础分的直接过滤掉
	this.allNode = this.allNode.filter(item=&gt;{
		return item.score&gt;=10;
	})


};
Collect.prototype.sort = function(list_data,item) {
	var by = function(name,minor)
        {
            return function(o, p)
            {
            var a, b;
            if (typeof o === &quot;object&quot; &amp;&amp; typeof p === &quot;object&quot; &amp;&amp; o &amp;&amp; p) 
            {
            a = o[name];
            b = p[name];
            if (a === b) {return typeof minor==='function' ?minor(o,p):0;}
            if (typeof a === typeof b) { return a &lt; b ? 1 : -1;}
            return typeof a &lt; typeof b ? -1 : 1;
            }
            else {throw (&quot;error&quot;); }
            }
        }
    list_data.sort(by(item)); 
};


Collect.prototype.getCoreContentArea = function() {

	var body = document.body;
	this.getAllNode(body);
	// this.filterNode();

	// this.setBasicScore();

	this.updateScoreByTagName_Class_Id(); 
	this.updateScoreByPunctuation();
	this.updateScoreByImgOrSvg();
	this.updateScoreByCodeTag();

	this.updateByDomPosTop();



	this.sort(this.allNode,'score'); 

	console.log(this.allNode);



	for (var i = 0; i &lt; this.allNode.length; i++) {

		this.allNode[i].setAttribute('score',this.allNode[i].score);
	}
};
var co = null;
function a(){
	co = new Collect();
	co.getCoreContentArea();

	$(co.allNode[0]).css({'border':'dashed red 3px'});
	console.log(html2canvas);
	 // html2canvas(co.allNode[0], {
  //       onrendered: function(canvas) {
  //           document.body.appendChild(canvas);
  //       },
  //     width: 300,
  //     height: 300
  //   });

 //  html2canvas(co.allNode[0]).then(function(canvas) {
	//     document.body.appendChild(canvas);
	// });

chrome.runtime.sendMessage({type:'init',html: co.allNode[0].innerHTML}, function(response) {
	    console.log('收到来自pop的回复：' +response);
	  
	});

}


//选择不准确，舍弃该节点选择下一个
function b(){

	console.log(co);

	if(co === null){
		return false;
	}

	$(co.allNode[0]).css({'border':'dashed red 0'});

	co.allNode = co.allNode.splice(1);
	$(co.allNode[0]).css({'border':'dashed red 3px'});


	chrome.runtime.sendMessage({type:'next',html: co.allNode[0].innerHTML}, function(response) {
	    console.log('收到来自pop的回复：' +response);
	  
	});

}

function c(){

	if(co === null){
		return false;
	}

	var origin = '&lt;br&gt;文章来源：'+location.href;
 
	chrome.runtime.sendMessage({type:'success',html: co.allNode[0].innerHTML+origin}, function(response) {
	    console.log('收到来自pop的回复：' +response);
	  
	});
}

function clear(){
	$(co.allNode[0]).css({'border':'dashed red 0'});
	$('body').click();
}

 
</code></pre></div><!----></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/book/42.html" class="prev">
        CSS实现显示两行文字，超出使用...
      </a></span> <span class="next"><a href="/book/241.html">
        canvas最佳实践（性能篇）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><section class="side-anchor"><ul style="display:none;"></ul></section></div></div>
    <script src="/book/assets/js/app.5837577d.js" defer></script><script src="/book/assets/js/3.0d5fb1e8.js" defer></script><script src="/book/assets/js/160.2c6daaf8.js" defer></script><script src="/book/assets/js/4.4c5f7830.js" defer></script>
  </body>
</html>
