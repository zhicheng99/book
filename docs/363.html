<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>让 JavaScript 在 WebAssembly 上加速运行！ | 日常收集</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/book/assets/css/0.styles.eec6d868.css" as="style"><link rel="preload" href="/book/assets/js/app.4c3d5465.js" as="script"><link rel="preload" href="/book/assets/js/3.0d5fb1e8.js" as="script"><link rel="preload" href="/book/assets/js/142.8c865bfb.js" as="script"><link rel="preload" href="/book/assets/js/4.4c5f7830.js" as="script"><link rel="prefetch" href="/book/assets/js/10.7e7e15e3.js"><link rel="prefetch" href="/book/assets/js/100.c6e21005.js"><link rel="prefetch" href="/book/assets/js/101.5440e694.js"><link rel="prefetch" href="/book/assets/js/102.7ad48500.js"><link rel="prefetch" href="/book/assets/js/103.a637cd07.js"><link rel="prefetch" href="/book/assets/js/104.4671f2d2.js"><link rel="prefetch" href="/book/assets/js/105.6bbaec44.js"><link rel="prefetch" href="/book/assets/js/106.c3b4924e.js"><link rel="prefetch" href="/book/assets/js/107.8d44540e.js"><link rel="prefetch" href="/book/assets/js/108.3aae0552.js"><link rel="prefetch" href="/book/assets/js/109.5dba325c.js"><link rel="prefetch" href="/book/assets/js/11.b6f67dd0.js"><link rel="prefetch" href="/book/assets/js/110.a40e4289.js"><link rel="prefetch" href="/book/assets/js/111.ded9790a.js"><link rel="prefetch" href="/book/assets/js/112.536dc07f.js"><link rel="prefetch" href="/book/assets/js/113.d14d5801.js"><link rel="prefetch" href="/book/assets/js/114.4ae5d1d1.js"><link rel="prefetch" href="/book/assets/js/115.33921643.js"><link rel="prefetch" href="/book/assets/js/116.cc70191a.js"><link rel="prefetch" href="/book/assets/js/117.57e7cda5.js"><link rel="prefetch" href="/book/assets/js/118.4cca96d1.js"><link rel="prefetch" href="/book/assets/js/119.925517b5.js"><link rel="prefetch" href="/book/assets/js/12.270dbc10.js"><link rel="prefetch" href="/book/assets/js/120.4bd8280b.js"><link rel="prefetch" href="/book/assets/js/121.68edf433.js"><link rel="prefetch" href="/book/assets/js/122.60e9d0a0.js"><link rel="prefetch" href="/book/assets/js/123.348b0c61.js"><link rel="prefetch" href="/book/assets/js/124.0df1fcf8.js"><link rel="prefetch" href="/book/assets/js/125.17f3f2f4.js"><link rel="prefetch" href="/book/assets/js/126.5d06ad3c.js"><link rel="prefetch" href="/book/assets/js/127.f0d8bd74.js"><link rel="prefetch" href="/book/assets/js/128.0028238f.js"><link rel="prefetch" href="/book/assets/js/129.09d92397.js"><link rel="prefetch" href="/book/assets/js/13.5ef8e835.js"><link rel="prefetch" href="/book/assets/js/130.d9e17f5c.js"><link rel="prefetch" href="/book/assets/js/131.682bdab7.js"><link rel="prefetch" href="/book/assets/js/132.7fd10d6d.js"><link rel="prefetch" href="/book/assets/js/133.1a253cb2.js"><link rel="prefetch" href="/book/assets/js/134.fd4dd490.js"><link rel="prefetch" href="/book/assets/js/135.a74ad769.js"><link rel="prefetch" href="/book/assets/js/136.5bbded3d.js"><link rel="prefetch" href="/book/assets/js/137.52643437.js"><link rel="prefetch" href="/book/assets/js/138.9c610e7f.js"><link rel="prefetch" href="/book/assets/js/139.7662d49e.js"><link rel="prefetch" href="/book/assets/js/14.3d533f57.js"><link rel="prefetch" href="/book/assets/js/140.1db34a16.js"><link rel="prefetch" href="/book/assets/js/141.ae4148de.js"><link rel="prefetch" href="/book/assets/js/143.1c68a47a.js"><link rel="prefetch" href="/book/assets/js/144.2c49e7f5.js"><link rel="prefetch" href="/book/assets/js/145.ed8f75fd.js"><link rel="prefetch" href="/book/assets/js/146.48ff7127.js"><link rel="prefetch" href="/book/assets/js/147.674d8e71.js"><link rel="prefetch" href="/book/assets/js/148.ffe8e1f9.js"><link rel="prefetch" href="/book/assets/js/149.78faa7de.js"><link rel="prefetch" href="/book/assets/js/15.64e47055.js"><link rel="prefetch" href="/book/assets/js/150.85f20f60.js"><link rel="prefetch" href="/book/assets/js/151.657a027c.js"><link rel="prefetch" href="/book/assets/js/152.9a460b73.js"><link rel="prefetch" href="/book/assets/js/153.4c83373a.js"><link rel="prefetch" href="/book/assets/js/154.15a64819.js"><link rel="prefetch" href="/book/assets/js/155.bf628be6.js"><link rel="prefetch" href="/book/assets/js/156.82a817ef.js"><link rel="prefetch" href="/book/assets/js/157.c629b9d4.js"><link rel="prefetch" href="/book/assets/js/158.436685f1.js"><link rel="prefetch" href="/book/assets/js/159.0eaa7bf7.js"><link rel="prefetch" href="/book/assets/js/16.a35212c2.js"><link rel="prefetch" href="/book/assets/js/160.ee349a03.js"><link rel="prefetch" href="/book/assets/js/161.87925fbe.js"><link rel="prefetch" href="/book/assets/js/162.8375f137.js"><link rel="prefetch" href="/book/assets/js/163.5313963b.js"><link rel="prefetch" href="/book/assets/js/164.2a2260df.js"><link rel="prefetch" href="/book/assets/js/165.4705a29b.js"><link rel="prefetch" href="/book/assets/js/166.18f59760.js"><link rel="prefetch" href="/book/assets/js/167.5d437991.js"><link rel="prefetch" href="/book/assets/js/168.8c069e64.js"><link rel="prefetch" href="/book/assets/js/169.d3f396ec.js"><link rel="prefetch" href="/book/assets/js/17.b8b34eba.js"><link rel="prefetch" href="/book/assets/js/170.a24792c8.js"><link rel="prefetch" href="/book/assets/js/171.2a0c18c1.js"><link rel="prefetch" href="/book/assets/js/172.7082d7f4.js"><link rel="prefetch" href="/book/assets/js/173.8bcbf506.js"><link rel="prefetch" href="/book/assets/js/174.688849ae.js"><link rel="prefetch" href="/book/assets/js/18.340eda39.js"><link rel="prefetch" href="/book/assets/js/19.323db867.js"><link rel="prefetch" href="/book/assets/js/20.cfa0aec5.js"><link rel="prefetch" href="/book/assets/js/21.6229732b.js"><link rel="prefetch" href="/book/assets/js/22.6cc91e41.js"><link rel="prefetch" href="/book/assets/js/23.fb025ad5.js"><link rel="prefetch" href="/book/assets/js/24.36f14df7.js"><link rel="prefetch" href="/book/assets/js/25.b4f46437.js"><link rel="prefetch" href="/book/assets/js/26.cdaab27d.js"><link rel="prefetch" href="/book/assets/js/27.e436033e.js"><link rel="prefetch" href="/book/assets/js/28.486b1dcf.js"><link rel="prefetch" href="/book/assets/js/29.75efb59d.js"><link rel="prefetch" href="/book/assets/js/30.64a7a28d.js"><link rel="prefetch" href="/book/assets/js/31.5caab6ef.js"><link rel="prefetch" href="/book/assets/js/32.52c8742c.js"><link rel="prefetch" href="/book/assets/js/33.12aba373.js"><link rel="prefetch" href="/book/assets/js/34.75da57c9.js"><link rel="prefetch" href="/book/assets/js/35.ee075cac.js"><link rel="prefetch" href="/book/assets/js/36.3ca8d8ad.js"><link rel="prefetch" href="/book/assets/js/37.f96e5b12.js"><link rel="prefetch" href="/book/assets/js/38.43de425f.js"><link rel="prefetch" href="/book/assets/js/39.1dd2fbe4.js"><link rel="prefetch" href="/book/assets/js/40.1b68ef64.js"><link rel="prefetch" href="/book/assets/js/41.9e49e0cf.js"><link rel="prefetch" href="/book/assets/js/42.03fbcb0f.js"><link rel="prefetch" href="/book/assets/js/43.fe97e66d.js"><link rel="prefetch" href="/book/assets/js/44.90269fc6.js"><link rel="prefetch" href="/book/assets/js/45.16e1b0b7.js"><link rel="prefetch" href="/book/assets/js/46.ee091a2d.js"><link rel="prefetch" href="/book/assets/js/47.efefb847.js"><link rel="prefetch" href="/book/assets/js/48.a86022f3.js"><link rel="prefetch" href="/book/assets/js/49.996807d8.js"><link rel="prefetch" href="/book/assets/js/5.4ec91f8c.js"><link rel="prefetch" href="/book/assets/js/50.a83cef96.js"><link rel="prefetch" href="/book/assets/js/51.e333bb78.js"><link rel="prefetch" href="/book/assets/js/52.5d0f6c72.js"><link rel="prefetch" href="/book/assets/js/53.e42cc193.js"><link rel="prefetch" href="/book/assets/js/54.4524c464.js"><link rel="prefetch" href="/book/assets/js/55.2db723ed.js"><link rel="prefetch" href="/book/assets/js/56.4879d74b.js"><link rel="prefetch" href="/book/assets/js/57.1aafc455.js"><link rel="prefetch" href="/book/assets/js/58.ae55aef1.js"><link rel="prefetch" href="/book/assets/js/59.9e4b468e.js"><link rel="prefetch" href="/book/assets/js/6.bea8ec1e.js"><link rel="prefetch" href="/book/assets/js/60.22aa4a5b.js"><link rel="prefetch" href="/book/assets/js/61.0907f36e.js"><link rel="prefetch" href="/book/assets/js/62.f75b6320.js"><link rel="prefetch" href="/book/assets/js/63.3f99ed03.js"><link rel="prefetch" href="/book/assets/js/64.ae6d2aee.js"><link rel="prefetch" href="/book/assets/js/65.29ac8546.js"><link rel="prefetch" href="/book/assets/js/66.5b6c0025.js"><link rel="prefetch" href="/book/assets/js/67.9cb18842.js"><link rel="prefetch" href="/book/assets/js/68.31baedbe.js"><link rel="prefetch" href="/book/assets/js/69.cbcad7b9.js"><link rel="prefetch" href="/book/assets/js/7.e5eadd5e.js"><link rel="prefetch" href="/book/assets/js/70.b341c253.js"><link rel="prefetch" href="/book/assets/js/71.0398ac26.js"><link rel="prefetch" href="/book/assets/js/72.c1ffd2d4.js"><link rel="prefetch" href="/book/assets/js/73.95a0d8b1.js"><link rel="prefetch" href="/book/assets/js/74.22068dc5.js"><link rel="prefetch" href="/book/assets/js/75.9cf3a486.js"><link rel="prefetch" href="/book/assets/js/76.1607821a.js"><link rel="prefetch" href="/book/assets/js/77.936225f9.js"><link rel="prefetch" href="/book/assets/js/78.d30f63dd.js"><link rel="prefetch" href="/book/assets/js/79.9aa087af.js"><link rel="prefetch" href="/book/assets/js/8.3201113b.js"><link rel="prefetch" href="/book/assets/js/80.7784e3a4.js"><link rel="prefetch" href="/book/assets/js/81.3d3a35b2.js"><link rel="prefetch" href="/book/assets/js/82.cd5814e6.js"><link rel="prefetch" href="/book/assets/js/83.83712b60.js"><link rel="prefetch" href="/book/assets/js/84.52d944b4.js"><link rel="prefetch" href="/book/assets/js/85.6f911071.js"><link rel="prefetch" href="/book/assets/js/86.4ba7470b.js"><link rel="prefetch" href="/book/assets/js/87.0b431d7f.js"><link rel="prefetch" href="/book/assets/js/88.cf59763b.js"><link rel="prefetch" href="/book/assets/js/89.d8cafb07.js"><link rel="prefetch" href="/book/assets/js/9.5cf4899a.js"><link rel="prefetch" href="/book/assets/js/90.a0198f04.js"><link rel="prefetch" href="/book/assets/js/91.4545c322.js"><link rel="prefetch" href="/book/assets/js/92.02880ae1.js"><link rel="prefetch" href="/book/assets/js/93.72ffce48.js"><link rel="prefetch" href="/book/assets/js/94.a6d57b47.js"><link rel="prefetch" href="/book/assets/js/95.09aff2b7.js"><link rel="prefetch" href="/book/assets/js/96.8e27b2bf.js"><link rel="prefetch" href="/book/assets/js/97.066a002e.js"><link rel="prefetch" href="/book/assets/js/98.68aa75ea.js"><link rel="prefetch" href="/book/assets/js/99.09f28172.js"><link rel="prefetch" href="/book/assets/js/vendors~docsearch.c8693219.js">
    <link rel="stylesheet" href="/book/assets/css/0.styles.eec6d868.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/book/" class="home-link router-link-active"><!----> <span class="site-name">日常收集</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dom的事件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/book/366.html" class="sidebar-link"> JavaScript 内存泄漏</a></li><li><a href="/book/363.html" aria-current="page" class="active sidebar-link"> 让 JavaScript 在 WebAssembly 上加速运行！</a></li><li><a href="/book/361.html" class="sidebar-link"> 《程序员数学：位运算》——如何使用二进制计算乘法？</a></li><li><a href="/book/360.html" class="sidebar-link"> 速记：一个http请求的全过程是怎样的？</a></li><li><a href="/book/359.html" class="sidebar-link"> 万字扫盲ByteBuffer</a></li><li><a href="/book/338.html" class="sidebar-link"> JS异步编程——WebWorker多线程机制</a></li><li><a href="/book/337.html" class="sidebar-link">js</a></li><li><a href="/book/336.html" class="sidebar-link"> [核心概念] 一文说透JS中的原型和继承(上)</a></li><li><a href="/book/335.html" class="sidebar-link"> [关联概念] 一文说透 JS 中的变量提升</a></li><li><a href="/book/334.html" class="sidebar-link"> [核心概念] 一文说透浏览器环境下的JS运行机制</a></li><li><a href="/book/333.html" class="sidebar-link"> [核心概念] 一文说透JS中的函数柯里化(Currying)</a></li><li><a href="/book/332.html" class="sidebar-link"> [核心概念] 一文说透 JS 中 this 的基本概念</a></li><li><a href="/book/331.html" class="sidebar-link"> [核心概念] 一文说透 JS 的作用域（scope）</a></li><li><a href="/book/330.html" class="sidebar-link"> [核心概念] 一文说透 JS 中的闭包（closure）</a></li><li><a href="/book/329.html" class="sidebar-link"> [核心概念] 一文说透 JS 中的执行上下文</a></li><li><a href="/book/268.html" class="sidebar-link"> 「硬核JS」你真的了解垃圾回收机制吗</a></li><li><a href="/book/262.html" class="sidebar-link"> 「硬核JS」你的程序中可能存在内存泄漏</a></li><li><a href="/book/229.html" class="sidebar-link"> 聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer</a></li><li><a href="/book/226.html" class="sidebar-link"> `Object.defineProperty()详解`</a></li><li><a href="/book/180.html" class="sidebar-link">yield是什么</a></li><li><a href="/book/175.html" class="sidebar-link">HTTP请求中，几种常见的Content-Type类型</a></li><li><a href="/book/172.html" class="sidebar-link"> js 给元素添加、删除父标签</a></li><li><a href="/book/171.html" class="sidebar-link"> 多个promise实现</a></li><li><a href="/book/131.html" class="sidebar-link"> Object.defineProperty和Object.defineProperties()</a></li><li><a href="/book/126.html" class="sidebar-link"> scrollHeight,scrollLeft,offsetHeight,offsetLeft</a></li><li><a href="/book/118.html" class="sidebar-link"> 怎样让 forEach 停下来呢；**try catch**</a></li><li><a href="/book/105.html" class="sidebar-link">div拖动的实现</a></li><li><a href="/book/93.html" class="sidebar-link">JavaScript对象之深拷贝和浅拷贝</a></li><li><a href="/book/92.html" class="sidebar-link">base64。js</a></li><li><a href="/book/85.html" class="sidebar-link">你也许不知道的JavaScript高级函数</a></li><li><a href="/book/78.html" class="sidebar-link">ESmodules:Acartoondeep-dive</a></li><li><a href="/book/73.html" class="sidebar-link">setTimeout和setImmediate到底谁先执行，本文让你彻底理解EventLoop</a></li><li><a href="/book/71.html" class="sidebar-link">一种对开发更友好的前端骨架屏自动生成方案</a></li><li><a href="/book/68.html" class="sidebar-link">深入理解ESModules(手绘示例)</a></li><li><a href="/book/48.html" class="sidebar-link">系统学习前端之FormData详解</a></li><li><a href="/book/47.html" class="sidebar-link">使用FormData上传文件</a></li><li><a href="/book/46.html" class="sidebar-link">数组排序方法</a></li><li><a href="/book/43.html" class="sidebar-link">利于FileReader实现二进制数据流转JSON</a></li><li><a href="/book/28.html" class="sidebar-link">reduce过滤数组中重复对象</a></li><li><a href="/book/27.html" class="sidebar-link">常用文件类型对应</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>element-ui</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Qcanvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>linux</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/365.html" class="sidebar-link"> WASM 在动画引擎中的设计优化</a></li><li><a href="/book/364.html" class="sidebar-link"> 你管这破玩意叫指针？</a></li><li><a href="/book/362.html" class="sidebar-link"> 图说 WebAssembly</a></li><li><a href="/book/328.html" class="sidebar-link"> 从哲学层面浅谈计算机学习方法论</a></li><li><a href="/book/324.html" class="sidebar-link"> 微信游览器，解决安卓和ios自动播放音乐</a></li><li><a href="/book/323.html" class="sidebar-link"> CSS3 animation属性中的steps功能符深入介绍</a></li><li><a href="/book/322.html" class="sidebar-link"> 前端搞工程化：从零打造性能检测库「源码 + 视频」</a></li><li><a href="/book/321.html" class="sidebar-link"> 还在看那些老掉牙的性能优化文章么？这些最新性能指标了解下</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/301.html" class="sidebar-link">从App store下载App的不同版本ipa文件----很多东西也不是越新越好，比如APP——在 iPhone 上尤其如此</a></li><li><a href="/book/294.html" class="sidebar-link">迟子建老师的《一坛猪油》</a></li><li><a href="/book/288.html" class="sidebar-link">文本文档的协同编辑实现</a></li><li><a href="/book/287.html" class="sidebar-link">再见，整洁代码</a></li><li><a href="/book/286.html" class="sidebar-link"> 可以在 Nginx 中运行 JavaScript，厉害了！</a></li><li><a href="/book/284.html" class="sidebar-link"> word中批量调整图片大小</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>electron打包的一些问题</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/274.html" class="sidebar-link"> 文件分片代码</a></li><li><a href="/book/273.html" class="sidebar-link"> 重学 JS：为啥 await 不能用在 forEach 中详解</a></li><li><a href="/book/269.html" class="sidebar-link"> Excel函数之王，Vlookup到底怎么用？</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/248.html" class="sidebar-link"> 《提问的智慧》精读注解版</a></li><li><a href="/book/199.html" class="sidebar-link"> js监听div的resize事件</a></li><li><a href="/book/198.html" class="sidebar-link"> 引入第三方字体体积太大的问题</a></li><li><a href="/book/195.html" class="sidebar-link"> 多行溢出省略号显示（css/js）实现！</a></li><li><a href="/book/190.html" class="sidebar-link">今天带大家一起来看看下，如何实现“划词高亮”功能。</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工作中解决的疑难问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/135.html" class="sidebar-link"> 深夜，我偷听到程序员要对session下手</a></li><li><a href="/book/132.html" class="sidebar-link"> 读 《深入浅出webpack》</a></li><li><a href="/book/103.html" class="sidebar-link"> 一道被人轻视的前端面试题</a></li><li><a href="/book/101.html" class="sidebar-link">部分前端面试题参考答案</a></li><li><a href="/book/80.html" class="sidebar-link">SVGDeveloper制作矢量地图教程详解</a></li><li><a href="/book/76.html" class="sidebar-link">VisualStudio2010创建的WCF（.dll）服务第一个应用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="让-javascript-在-webassembly-上加速运行"><a href="#让-javascript-在-webassembly-上加速运行" class="header-anchor">#</a> 让 JavaScript 在 WebAssembly 上加速运行！</h1> <p>大家好，很高兴又见面了，我是&quot;<strong>高级前端进阶</strong>&quot;，由我带着大家一起关注前端前沿、深入前端底层技术，大家一起进步，也欢迎大家关注、点赞、收藏、转发!</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/3622857b9aaa406fbae042eb4c8a8e36~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=osc5lyMuLjbMBMQnQEsB57tup7Q%3D" alt="">高级前端进阶</p> <h1 id="让-javascript-在-webassembly-上疾速运行"><a href="#让-javascript-在-webassembly-上疾速运行" class="header-anchor">#</a> 让 JavaScript 在 WebAssembly 上疾速运行</h1> <p>与二十年前相比，如今 JavaScript 在浏览器中的运行速度要快好多倍。而这多亏了浏览器厂商们在此期间坚持不懈地加强性能优化。</p> <p>而现在，我们又要开始在完全不同的运行环境中优化 JavaScript 的性能 —— 这些新环境中的游戏规则是截然不同的。而让 JavaScript 能够适应不同运行环境的，正是 WebAssembly。</p> <p>这里我们要明确一点 —— 如果你是在浏览器中运行 JavaScript，那么直接部署 JavaScript 就行了。浏览器中的 JavaScript 引擎已经被精心调校过，可以很快速地运行装载进来的 JavaScript 程序。</p> <p>但如果是在无服务器（Serverless）功能中运行 JavaScript 呢？又或者说，如果想要在 iOS 或游戏机这类不支持通常的即时编译的环境中运行 JavaScript，又该如何把控性能？</p> <p>在这些使用场景中，你会需要关注这新一轮的 JavaScript 优化。另外，若想要让 Python、Ruby 或者 Lua 等其他运行时语言在上述使用场景中提速，JavaScript 优化也有参考价值。</p> <p>但在开始探索如何在不同环境中进行优化前，我们需要了解一下其中的基本原理。</p> <h1 id="原理是什么"><a href="#原理是什么" class="header-anchor">#</a> 原理是什么？</h1> <p>不论你在何时运行 Javascript 程序，JavaScript 代码终归要以机器编码的形式执行。 JavaScript 引擎通过一系列技术来实现这一转换，例如各种解释器和 JIT 编译器。（详情请参见即时（JIT）编译器速成课。）</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/f24cecef45ae472598f22e26fa55ee9f~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=24ZVNE3TJfCLaA2Bq3EhVTtcTZc%3D" alt=""></p> <p>但如果你想要运行程序的平台没有 JavaScript 引擎怎么办？那你就需要把 JavaScript 引擎和程序代码一起部署。</p> <p>为了能让 JavaScript 随处运行，我们<strong>把 JavaScript 引擎部署为一个 WebAssembly 模块</strong>，这样就能够跨越不同机器架构之间的差异。而且，借助 WASI，跨操作系统也同样成为可能。</p> <p>这意味着，整个 JavaScript 运行环境被集成进了 WebAssembly 实例中。部署了 WebAssembly 后， 你只需把 JavaScript 代码喂进去就行了，WebAssembly 实例会自行消化代码。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/a58a65c909694d83845a8dc77c77a671~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=gOdyVgtz26ZSQpEkuiPzRyZ6%2Bd0%3D" alt=""></p> <p>JavaScript 引擎并不会直接在机器内存中运转，从二进制码到二进制码的垃圾回收对象，JavaScript 引擎把这一切都放到 Wasm 模块的线性内存中。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/6a7815bae2a84676965438b27c3d8e4d~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=AVxdFw4wr0le3p7lTOoMucxHGWo%3D" alt=""></p> <p>对于 JavaScript 引擎，我们选用了 SpiderMonkey，就是 Firefox 浏览器中用到的那个。SpiderMonkey 是行业级别的 JavaScript 虚拟机（VM）之一，在浏览器领域里是久经沙场的老将。当你运行不可信代码，或者代码会处理不可信输入信息时，这种皮实耐用、安全性高的特性就显得尤为重要了。</p> <p>SpiderMonkey 还使用了一种叫做精确堆栈扫描的技术，它对我下面将要说到的部分优化点极其重要。SpiderMonkey 还具有包容度极高的代码库，这一点也很重要，因为协作开发者们来自三个不同的组织 —— Fastly、Mozilla 和 Igalia。</p> <p>我刚刚描述的运行方式并没有显得具有什么颠覆性特征。几年前大家就已经开始这样用 WebAssembly 运行 JavaScript 了。</p> <p>但问题在于，这样运行很慢。<strong>WebAssembly 并不支持动态地生成新的机器编码，然后在纯 Wasm 代码里运行</strong>。这就意味着你无法使用即时编译。你只能使用解释器。</p> <p>知道了有这种局限性，你可能会问：</p> <h1 id="那为何还要说性能优化"><a href="#那为何还要说性能优化" class="header-anchor">#</a> 那为何还要说性能优化？</h1> <p>鉴于即时编译让浏览器能快速运行 JavaScript（且鉴于在 WebAssembly 模块中不能进行即时编译），还想提速似乎是反直觉的。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/24fd6d90686244b6a71834a7ca12c469~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=yHmk2bbbG3TL40WwPDZ5OAKT9fo%3D" alt=""></p> <p>但假如，即使不能用即时编译，我们还有没有办法能让 JavaScript 运行提速呢？</p> <p>让我们通过几个案例来看看，如果 WebAssembly 可以快速运行 JavaScript，将会产生多么大的效益。</p> <h1 id="在-ios-以及其他-jit-受限的环境-中运行-javascript"><a href="#在-ios-以及其他-jit-受限的环境-中运行-javascript" class="header-anchor">#</a> 在 iOS（以及其他 JIT 受限的环境）中运行 JavaScript</h1> <p>在有些环境下，由于安全原因，无法使用即时编译，举例来说，无特殊权限的 iOS 应用、部分智能电视以及游戏机设备都属于此范畴。</p> <p><img src="https://p26-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/7c995ae6b1574eee8078f246c564a147~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=JuCMYQjv%2B7VOOxz1aYes9uJRovI%3D" alt=""></p> <p>在这些平台上，必须要使用解释器才行。但想在这些平台上运行的，都是那种运行周期长、代码量大的应用。正是这些条件让<strong>你不想用解释器，因为解释器会严重拖慢执行速度</strong>。</p> <p>如果能让 JavaScript 在这样的环境中提速，那么开发者们就可以在不支持即时编译的平台使用 JavaScript 而无需顾虑性能了。</p> <h1 id="让无服务器即刻冷启动"><a href="#让无服务器即刻冷启动" class="header-anchor">#</a> 让无服务器即刻冷启动</h1> <p>在另外一些场景中，即时编译不成问题，但启动时间却拖了后腿，比如在使用无服务器功能时。这就是冷启动延迟的问题，你可能已经有所耳闻。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/5232bc76cc0f4dc9b0927ace962d5dc6~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=k%2BaLh0ktRKDwFyoJgLVHouO2vKI%3D" alt=""></p> <p>即使用精简到极致的 JavaScript 环境 ， 一个仅启动纯 JavaScript 引擎的隔离环境，最低延迟也有 5 毫秒左右，还没有把初始化应用的时间算进去。</p> <p>倒是有一些办法可以把收到的请求的启动延迟隐藏起来。但随着 QUIC 这类提案在网络层中对连接时长的优化，想要隐藏延迟越来越困难。而当你链式执行多个无服务器功能等这类操作时，要隐藏延迟更是难上加难。</p> <p>使用这些技术去隐藏延迟的平台页，常常会在多个请求间复用实例。某些情况下，这意味着在不同请求中都可以观察到全局状态，这就是拿安全当儿戏了。</p> <p>正是由于这个冷启动问题，开发者们常常无法遵循最佳实践来开发。他们会在一次无服务器部署中，塞入大量功能。这就导致了另一个安全问题 ，一处暴雷，全盘完蛋。如果这次部署中的一部分破防了，那么攻击者就有了整个部署的访问权限。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/66ae905210054adaaaa71cde13f8cbf9~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=g9e341qMeRg3rkTF6FufA94oKd4%3D" alt=""></p> <p>但如果能把上述场景中 JavaScript 的启动时间降到足够低，那自然就无需再费尽心思去隐藏启动时间了，因为能在几微秒之间就启动一个实例。</p> <p>如果能做到这种程度，就能为每个请求提供一个新实例，于是不会再有全局状态横穿多个请求。而且，由于这些实例足够轻量，开发者能够任意把代码拆分成粒度更细的片段，把每一段代码的故障范围压缩到最小。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/7b51723f3cb7469f9dbb773554202631~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=yKGOQWdtdAlkWrt7j%2BK7rsx%2F4Zg%3D" alt=""></p> <p>这种实现还有另外一个安全方面的优点。除了实例能保持轻量、代码隔离粒度更优之外，Wasm 引擎能提供的安全壁垒也更坚固了。</p> <p>JavaScript 引擎过去用来创建隔离的代码库庞大无比，包含着大量用来进行极其复杂的优化工作的底层代码，所以很容易产生 Bug，从而使得攻击者跳出虚拟机、获取到虚拟机所在系统的访问权限。这就是为何像 Chrome 和 Firefox 这样的浏览器要竭尽全力确保网站运行在完全隔离的进程中。</p> <p>相反的是，Wasm 引擎需要的代码极少，因此便于检查，而且它们中有许多是用 Rust 这种内存无害语言写的。而由 WebAssembly 模块生成的原生二进制码，其内存隔离的安全性是可以验证的。</p> <p><strong>通过在 Wasm 引擎中运行 JavaScript 代码，构筑起了这座安全性更高的外部沙盒堡垒，以此作为另一道防线。</strong></p> <p>因此，在上述这些场景中，让 JavaScript 在 Wasm 引擎上运行得更快，是裨益良多的。那我们怎么来实现呢？要回答这个问题，需要弄清楚 JavaScript 引擎把时间都消磨在哪里了。</p> <h1 id="javascript-的两个耗时之处"><a href="#javascript-的两个耗时之处" class="header-anchor">#</a> JavaScript 的两个耗时之处</h1> <p>可以粗略地把 JavaScript 引擎所做的工作拆分为两个部分：初始化和运行时。</p> <p>把 JavaScript 看作是一个包工头。这位包工头被雇用来完成这样一份工作，即运行 JavaScript 代码，并得出结果。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/bfc0d42b4056400f834b450cedea6d4c~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=2qXlnEej48OK2NZhYA2pCTPgoTQ%3D" alt=""></p> <h1 id="初始化阶段"><a href="#初始化阶段" class="header-anchor">#</a> 初始化阶段</h1> <p>在这位包工头真正开始运作项目之前，它需要做一点预备工作。此初始化阶段包括了在执行之初<strong>所有那些只需运行一次的操作</strong>。</p> <h1 id="应用初始化"><a href="#应用初始化" class="header-anchor">#</a> 应用初始化</h1> <p>不论是什么项目，合同工都需要了解一下客户的需求，然后配置要完成任务所需的资源。</p> <p>例如，合同工浏览一遍项目概要以及其他支持文档，然后把它们转化成自己能处理的东西，比如搭建一个项目管理系统，把所有文档存储并整理起来。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/a6005c33ecfa4f76bcff2febb4608389~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=Tsr15otubr1%2FfokHxp%2BcgoJf48Q%3D" alt=""></p> <p>在 JavaScript 引擎看来，这个任务更像是通读顶层源码并把各项功能解析为字节码、为声明的变量分配内存、给已经定义过的变量赋值。</p> <h1 id="引擎初始化"><a href="#引擎初始化" class="header-anchor">#</a> 引擎初始化</h1> <p>在无服务器等特定场景中，还有另一个需要初始化的部分，发生在应用初始化之前。</p> <p>那就是引擎初始化。引擎本身需要率先启动起来，内置函数需要添加到环境当中。可以把这个过程看作在开始工作之前要先把办公室布置好 ，组装桌椅之类的事。</p> <p><img src="https://p26-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/2ea3a3de10374a90b91607ae14824e13~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=QOF0dTJJb1OEBLesrcAtat7eVsc%3D" alt=""></p> <p>这个过程也可能花费一定量的时间，也是导致冷启动成为无服务器使用场景的大问题的原因之一。</p> <h1 id="运行时阶段"><a href="#运行时阶段" class="header-anchor">#</a> 运行时阶段</h1> <p>一旦初始化阶段结束，JavaScript 引擎就能开始运行代码了。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/25342fb6dd9d4b3c8d121d250e071f1c~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=Pv%2B6u49oAA4mrXgW1ZNgMvn1Ae8%3D" alt=""></p> <p>把这部分工作的完成速度称为吞吐量（Throughput），能影响吞吐量的因素有很多。比如：</p> <ul><li>功能使用哪种语言开发</li> <li>JavaScript 引擎是否能预测代码行为</li> <li>使用哪种数据结构</li> <li>代码的运行周期是否足够长到能从 JavaScript 引擎的优化编译中获益</li></ul> <p>那么这就是 JavaScript 消耗时间的两个阶段。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/4dbf980c22864a16a8004c675283b7e5~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=CqkW5zKjksqgnwppJZxgEib9U%2Bo%3D" alt=""></p> <p>那该如何让这两个阶段运行得更快呢？</p> <h1 id="大幅压缩初始化耗时"><a href="#大幅压缩初始化耗时" class="header-anchor">#</a> 大幅压缩初始化耗时</h1> <p>先使用 Wizer 这个工具来加快初始化过程。稍后我会解释如何操作，但为了让心急的读者一睹为快，下面先给出运行一个非常简单的 JavaScript 应用时的加速情况。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/9564657dbcbe4dd2b57fac2ec3897d0c~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=A5W9jgGl59Aj5vbL%2FqX7dMwhRyY%3D" alt=""></p> <p>当用 Wizer 运行这个小应用时，只消耗了 0.36 毫秒（等于 360 微秒）。这要比纯 JavaScript 的方式快了不止 13 倍。</p> <p>启动能如此迅速，是因为借助了快照（Snapshot）。Nick Fitzgerald 在 WebAssembly 峰会上关于 Wizer 的演讲中进行了更为详尽的解释。</p> <p>那么其中的原理是什么？在部署代码之前，作为构建步骤的一部分，用 JavaScript 引擎运行 JavaScript 代码，直到初始化结束。</p> <p>在此处，JavaScript 引擎把所有的 JavaScript 代码解析成了字节码，并存储在了线性内存中。在这一阶段，引擎还会进行大量的内存分配和初始化工作。</p> <p><strong>由于线性内存的独立完备性非常强，当所有的数据值被存进来后，直接把这块内存绑定为 Wasm 模块的数据区块即可。</strong></p> <p>当 JavaScript 引擎模块被实例化后，它就能访问数据区块中的所有数据了。当引擎需要使用这块内存时，它可以复制所需的区块（或者内存页）到自己的线性内存中去。这样，JavaScript 引擎在启动时就无需再做配置工作了。所有的预初始化的数据就都已经准备就绪、听凭差遣了。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/f7805f5fe41f474d802e74a3c47bdf5d~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=cv%2FoFZUEaCE5HB1T4conKV6RSMo%3D" alt=""></p> <p>眼下，把这个数据区块和 JavaScript 引擎绑在了一起。但在将来，一旦模块链接（Module linking）可用了，就能把数据区块装载为一个单独的模块了，也就能让 JavaScript 引擎被多个不同的 JavaScript 应用复用了。</p> <p>这样就实现了真正干净清爽的解耦。</p> <p>JavaScript 引擎模块只包含引擎本身的代码。这意味着一经编译完成，这部分代码就可以高效率地被多个不同实例缓存和复用了。</p> <p>另一方面，特定的应用模块不包含 Wasm 代码。它只含有线性内存，而线性内存只含有 JavaScript 代码字节码，以及初始化生成的 JavaScript 引擎状态数据。这让内存整理和分配十分便利。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/5c955837b5044b6ba5577891d4860ec9~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=mATaL1q6KkM8HHSAdMVX9opVWOU%3D" alt=""></p> <p><strong>就好像是包工头 JavaScript 引擎根本不需要再去布置办公室了。它直接可以拎包入住了。它的包里装下了整个办公室，所有器具一应俱全，全部都调校就绪，就等 JavaScript 引擎破土动工了。</strong></p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/2b51aece17184f26a6738ff6fb884e9f~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=EloBLe8EMGqDtw%2F2Ws2LQdMyl5c%3D" alt=""></p> <p>而最酷的就是，这不是特地为 JavaScript 实现的 —— 只需要使用 WebAssembly 现有的属性即可。所以你也可以把这个办法用在 Python、Ruby、Lua 或其他运行时环境中。</p> <h1 id="下一步-提升吞吐量"><a href="#下一步-提升吞吐量" class="header-anchor">#</a> 下一步：提升吞吐量</h1> <p>通过这种方式，可以让启动时长超级短了，那如何优化吞吐量呢？</p> <p>对于某些情况来说，吞吐量其实不算差。如果你的 JavaScript 应用运行周期非常短，它怎么也轮不到即时编译来处理 —— 它的全程都在解释器中完成。在这种情况中，吞吐量就和在浏览器中一样了，在传统的 JavaScript 引擎初始化完成之前，程序就已经运行完了。</p> <p>但是对于运行周期更长的 JavaScript 代码，即时编译用不了多久就得开始介入了。一旦发生这种情况，吞吐量的差异就开始变得悬殊了。</p> <p><strong>如上面所言，在纯 WebAssembly 环境中是不可能使用即时编译的。但事实上，可以把即时编译的一些想法应用到提前编译模型中。</strong></p> <h1 id="快速-aot-编译-javascript-代码-无分析"><a href="#快速-aot-编译-javascript-代码-无分析" class="header-anchor">#</a> 快速 AOT 编译 JavaScript 代码（无分析）</h1> <p>即时编译用到的一个优化技术是内联缓存（Inline caching）。通过内联缓存，即时编译创建一个存根链表，其中包含了机器编码的快捷路径，指向曾经运行过的 JavaScript 字节码的所有运行方式。（详情请参阅文章：即时编译器速成课）</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/adc4d4eb93c3472ebdc8549b561b33ab~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=Wzs3MKDVfZn6dHTMFTdgJfbN9Z0%3D" alt=""></p> <p>之所以需要用链表，是因为 JavaScript 是动态类型语言。每当一行代码变换了不同的类型，就需要生成一个新的存根，添加到链表中。但如果之前就处理过这个类型，那就可以直接使用已经生成好的存根。</p> <p>由于内联缓存（IC）在即时编译中比较常用，人们会认为它们是非常动态化的，并且专用于特定程序。但实际上，它们也可以用于 AOT 场景。</p> <p>即使还没有看到 JavaScript 代码，也对要生成的 IC 存根比较熟悉了。这是因为 JavaScript 中有一些模式是经常被使用到的。</p> <p>访问对象属性就是一个有力佐证。访问对象属性在 JavaScript 中非常常见，而使用 IC 存根就能为这个操作提速。对于那些有确定“形状”或者“隐藏类”（即属性的存储位置相对固定）的对象来说，当你读取这类对象的某个属性，该属性总在同样的偏移位置（Offset）上。</p> <p>按照传统，即时编译中的这种 IC 存根会硬编码为两种值：一个是指向形状的指针，一个是属性的偏移量。而这所需的信息，是提前预知不到的。但能做的是把 IC 存根参数化。可以把形状和属性偏移量看作是传到存根里的变量。</p> <p>这样，就能创建出一个单独的存根，它从内存中加载值，然后可以到处使用这个存根。可以把属于常见模式的所有存根合成一个 AOT 编译模块，不去关心 JavaScript 代码的具体功能细节。即使在浏览器设置中，这种 IC 共享也是有益处的，因为这让 JavaScript 引擎生成更少的机器编码，提升启动速度，优化本地指令缓存。</p> <p>对于我们的使用场景来说，IC 共享尤其重要。它意味着可以把属于常见模式的所有存根合成一个 AOT 编译模块，不去关心 JavaScript 代码的具体实现细节。</p> <p>我们发现，仅需几 KB 的 IC 存根，就能覆盖全部 JavaScript 代码中的绝大部分。例如，只需 2 KB 的 IC 存根，就足以覆盖 Google Octane 基准测试中 95% 的 JavaScript 代码。从初步测试结果来看，通常的网页浏览场景似乎都能保持这个比率。</p> <p><img src="https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/2dda46060c804c719a0ac40526c62009~noop.image?_iz=58558&amp;from=article.pc_detail&amp;x-expires=1687573683&amp;x-signature=phkqPS810SF9NCJW0CUzQCxIqNs%3D" alt=""></p> <p>因此，使用这种优化手段，我们应该能够达到早期即时编译的吞吐量水平。一旦我们做到这个程度，我们就将加入更细粒度的优化，进一步打磨性能，正如各个浏览器厂商的 JavaScript 引擎开发团队在早期即时编译中所做的那样。</p> <h1 id="下一步-或许该加一点分析"><a href="#下一步-或许该加一点分析" class="header-anchor">#</a> 下一步：或许该加一点分析？</h1> <p>以上是能提前做的，无需知道程序是做什么的，也无需知道它都使用了什么类型的数据。但要是能像即时编译一样访问到分析数据呢？那就可以全面优化代码了。</p> <p>但这会引出一个问题 ，开发者分析起自己的代码来往往十分困难。要想提取出有代表性的代码样本，实非易事。因此没法确定是否能得到优质的分析数据。</p> <p>如果能找合适的工具来进行分析，那么还是有可能让 JavaScript 代码运行得像如今的即时编译一样快速（连热身的时间都不需要！）的。</p> <h1 id="如今该如何上手"><a href="#如今该如何上手" class="header-anchor">#</a> 如今该如何上手？</h1> <p>这种新的方式让我们激动不已，期盼着能更上一层楼。也很激动地看到，其他动态类型语言可以用这种方式拥抱 WebAssembly 了。</p> <p>因此，下面是有几种上手的方式，如果有任何问题，可以在 Zulip 中提问。</p> <h1 id="对于其他想支持-javascript-的平台"><a href="#对于其他想支持-javascript-的平台" class="header-anchor">#</a> 对于其他想支持 JavaScript 的平台</h1> <p>要想在自己的平台运行 JavaScript，你<strong>需要嵌入一个支持 WASI 的 WebAssembly 引擎</strong>，比如Wasmtime。</p> <p><strong>然后需要 JavaScript 引擎</strong>。在这一步里，我们为 Mozilla 的构建系统添加了对编译 SpiderMonkey 到 WASI 的完全支持。Mozilla 将把 SpiderMonkey 的 WASI 构建添加到用于构建和测试 Firefox 的 CI 设置中。这让 WASI 成为了 SpiderMonkey 的线上质量目标，确保了 WASI 构建能够一直保持运转。这意味着可以如文中所讲的那样使用 SpiderMonkey。</p> <p><strong>最后，需要让用户提供预先初始化的 JavaScript 代码</strong>。为了能助你一臂之力，我们还开源了 Wizer，可以集成到构建工具中，产出针对特定应用的 WebAssembly 模块，以适用于 JavaScript 引擎模块所用的预先初始化内存。</p> <h1 id="对于其他想要使用这种方法的语言"><a href="#对于其他想要使用这种方法的语言" class="header-anchor">#</a> 对于其他想要使用这种方法的语言</h1> <p>如果是 Python、Ruby、Lua 等语言的使用者，可以针对该语言构建出一个自己的版本。</p> <p>首先，需要把运行时编译成 WebAssembly，使用 WASI 作为系统调用，可参考我们对 SpiderMonkey 的处理。然后，可以按照上文所说，把 Wizer 集成到构建工具中，生成内存快照，这样就能用快照来加速启动。</p> <h1 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h1> <blockquote><p>原文链接：
https://bytecodealliance.org/articles/making-javascript-run-fast-on-webassembly</p> <p>原文作者：Lin Clark</p> <p>中文参考翻译：
https://juejin.cn/post/6981685894470172679</p></blockquote> <p>文章来源：https://www.toutiao.com/article/7215518603293098556/?log_from=88908aa900322_1686968883656</p> <!----></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/book/366.html" class="prev">
         JavaScript 内存泄漏
      </a></span> <span class="next"><a href="/book/361.html">
         《程序员数学：位运算》——如何使用二进制计算乘法？
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><section class="side-anchor"><ul style="display:none;"></ul></section></div></div>
    <script src="/book/assets/js/app.4c3d5465.js" defer></script><script src="/book/assets/js/3.0d5fb1e8.js" defer></script><script src="/book/assets/js/142.8c865bfb.js" defer></script><script src="/book/assets/js/4.4c5f7830.js" defer></script>
  </body>
</html>
