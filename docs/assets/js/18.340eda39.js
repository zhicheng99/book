(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{397:function(t,n,e){"use strict";e.r(n);var i=e(10),a=Object(i.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"页面滚动后导致-html2canvas截图不全、图片模糊的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#页面滚动后导致-html2canvas截图不全、图片模糊的问题"}},[t._v("#")]),t._v(" 页面滚动后导致 html2canvas截图不全、图片模糊的问题")]),t._v(" "),e("p",[t._v("增加scrollY参数即可 如果是fixed定位的置为0即可")]),t._v(" "),e("p",[t._v("生成的图片模糊一般都是css使用背景图片导致的  修改为用img引入图片，不要用background")]),t._v(" "),e("p",[t._v("还有个要注意 FileSaver.saveAs会导致苹果手机safari直接打开 不会直接保存 所以如果是移动端 最好先生成base64的图片 放到页面上  然后长按图片 触发浏览器下保存事件进而保存图片")]),t._v(" "),e("p",[t._v("要截图部分的html结构要尽量简洁，css样式尽量不要使用:before :after  因为可能会解析有误 生成的图片有空白")]),t._v(" "),e("p",[t._v("mobile代码：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<template>\n\t<div v-if="show" class="pp box box-align-center" ref="pp">\n\t\t\x3c!-- <div class="pp_con" v-if="!isIOS">\n\t\t\t<div class="share_pic" ref="share_pic" @touchstart="gotouchstart" @touchmove="gotouchmove" @touchend="gotouchend">\n\n\t\n\n\n\t\t\t\t<img class="bg" src="../../static/img/m_share.png" alt="">\n\t\t\t\t<div class="cover" >\n\t\t\t\t\t<img :src="detailObj.cover" width="100%" height="100%" alt="">\n\t\t\t\t</div>\n\t\t\t\t<div class="title">{{detailObj.title.replace(/(“|”)/g,\'"\')}}</div>\n\t\t\t</div>\n\n\t\t\t<div class="save">长按保存</div>\n\t\t\t<van-icon class="close" name="cross" @click="close"/>\n\n\t\t</div> --\x3e \n\n\t\t<div class="pp_con">\n\t\t\t<div class="share_pic" ref="share_pic">\n\t\t\t\x3c!-- <div class="share_pic" ref="share_pic" @click="godown"> --\x3e\n\n\t\n\n\n\t\t\t\t<img class="bg" src="../../static/img/m_share.png" alt="">\n\t\t\t\t\x3c!-- //ios13.4以上html2canvas对cover元素截图有兼容问题 一直是空白 \n\t\t\t\t\t可能是对:after样式解析不了 所以得直接写绝对定位的图片\n\t\t\t\t--\x3e\n\t\t\t\t\x3c!-- <div class="cover" >    --\x3e\n\t\t\t\t\t<img class="cover_img" :src="detailObj.cover"  alt="">\n\t\t\t\t\x3c!-- </div> --\x3e\n\t\t\t\t<div class="title">{{formater(detailObj.title)}}</div>\n\n\t\t\t\t<img class="shareImg" v-if="shareImg!=\'\'" :src="shareImg" alt="">\n\n\t\t\t</div>\n\n\t\t\t<div class="save">长按保存</div>\n\t\t\t<van-icon class="close" name="cross" @click="close"/>\n\n\t\t</div> \n\n\n\n\n\n\t</div>\n</template>\n<script>\n\timport html2canvas from \'html2canvas\';\n\timport FileSaver from \'file-saver\';\n\nimport { Toast,ActionSheet } from \'vant\';\n\nVue.use(Toast)\n.use(ActionSheet);\n\n\tlet timeOutEvent = {};\n\texport default{\n\t\tcomponents:{},\n\t\tprops:[\'isShow\',\'detailObj\'],\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tshow:false,\n\t\t\t\tshowAction:false, \n\t\t\t\tisIOS:!!navigator.userAgent.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),\n\t\t\t\tshareImg:\'\' \n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tformater:function(title){\n\n\t\t\t\treturn title.replace(/(“|”)/g,\'"\')\n\t\t\t\t.replace(/’|‘/g,"\'")\n\t\t\t\t.replace(/\\（/g,\'(\')\n\t\t\t\t.replace(/\\）/g,\')\')\n\t\t\t\t.replace(/；/g,\';\')\n\t\t\t\t.replace(/。/g,\'.\')\n\t\t\t\t.replace(/：/g,\':\');\n\t\t\t},\n\t\t\tclose:function(){\n\t\t\t\tthis.$emit(\'update:isShow\',false);\n\t\t\t},\n\t\t\tdataURLtoBlob:function(baseurl) {\n\t\t\t\t    let arr = baseurl.split(\',\'),\n\t\t\t\t        mime = arr[0].match(/:(.*?);/)[1],\n\t\t\t\t        bstr = atob(arr[1]),\n\t\t\t\t        n = bstr.length,\n\t\t\t\t        u8arr = new Uint8Array(n);\n\t\t\t\t    while (n--) {\n\t\t\t\t        u8arr[n] = bstr.charCodeAt(n);\n\t\t\t\t    }\n\t\t\t\t    return new Blob([u8arr], {\n\t\t\t\t        type: mime\n\t\t\t\t    });\n\t\t\t},\n\t\t\tcreateImg:function(){\n\t\t\t\tvar d = this.$refs[\'share_pic\'];\n\n\t\t\t\tlet w = d.offsetWidth;\n\t\t\t\tlet h = d.offsetHeight;\n \n\t\n\n\t\t\t\tsetTimeout(()=>{\n \n\t\t\t\t\tvar top = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop; \n\t\t\t\t\thtml2canvas(d, {\n\t\t\t\t\t\t// backgroundColor: \'#000\',\n\t\t\t\t\t\tbackgroundColor: "transparent",\n\t\t\t\t\t    allowTaint: true,\n\t\t\t\t\t    useCORS: true,\n\t\t\t\t\t    height: h,\n\t\t\t\t\t    width: w,\n\t\t\t\t\t    scrollY:0,\n\t\t\t\t\t    scale:window.devicePixelRatio\n\t\t\t\t\t}).then(canvas => {  \n\n\t\t\t\t\t\t let fileName = new Date().getFullYear()+\'\'+(new Date().getMonth()+1)+\'\'+new Date().getDate()+\'\'+parseInt(Math.random()*10000);\n\n\t\t\t\t\t\t \n\t\t\t\t\t\t// if(this.isIOS){  \n\t\t\t\t\t\t   //FileSaver.saveAs会导致苹果手机safari直接打开 不会直接保存\n\t\t\t\t\t\t   //所以先生成图片 把生成的图片覆盖上去 然后长按图片再去保存\n\n\t\t\t\t\t\t\t// let img = document.createElement(\'img\');\n\t\t\t\t\t\t\t// img.onload = ()=>{\n\t\t\t\t\t\t\t// \tconsole.log(\'生成图片完成\');\n\n\t\t\t\t\t\t\t// \t// d.appendChild(img);\n\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t// img.style.position = \'absolute\';\n\t\t\t\t\t\t\t// img.style.left=0;\n\t\t\t\t\t\t\t// img.style.top=0;\n\t\t\t\t\t\t\t// img.style.width=\'100%\';\n\t\t\t\t\t\t\t// img.style.zIndex=1; \n\t\t\t\t\t\t\t// img.src=canvas.toDataURL("image/png");\n\n\t\t\t\t\t\t\t\tthis.shareImg = canvas.toDataURL("image/png");\n\t\t\t\t\t\t\t\tconsole.log(\'图片生成完毕\');\n\t\t\t\t\t\t\t\t// console.log(this.shareImg);\n\t\t\t\t\t\t\t\tToast.clear();\n\n\n\n\n\n\t\t\t\t\t\t\t// img.className="bg";\n\n\n\t\t\t\t\t\t// }else{\n\n\t\t\t\t\t\t// FileSaver.saveAs(this.dataURLtoBlob(canvas.toDataURL("image/png")), fileName+".png");\n\t\t\t\t\t\t// }\n\n\n\t\t\t\t\t});\n\n\t\t\t\t},200)\n\t\t\t},\n\t\t\tgodown:function(){\n\t\t\t\tthis.showAction = true;\n\t\t\t},\n\t\t\tonSelect:function(item){\n\t\t\t\tconsole.log(item);\n\n\t\t\t\tif(item.name == \'保存分享图片\'){\n\n\t\t\t\t\t Toast.loading({\n\t\t\t\t\t  message: \'正在生成分享图片...\',\n\t\t\t\t\t  forbidClick: true,\n\t\t\t\t\t  loadingType: \'spinner\',\n\t\t\t\t\t  duration:0\n\t\t\t\t\t});\n\n\t\t\t\t\tsetTimeout(this.createImg,200)\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tgotouchstart(){\n\t\t\t   let that = this;\n\t\t\t   clearTimeout(timeOutEvent);//清除定时器\n\t\t\t   timeOutEvent = 0;\n\t\t\t   timeOutEvent = setTimeout(()=>{\n\t\t\t        //执行长按要执行的内容，\n\t\t\t  \n\t\t\t        console.log(\'长按保存图片\');\n\n\t\t\t        Toast.loading({\n\t\t\t\t\t  message: \'正在生成分享图片...\',\n\t\t\t\t\t  forbidClick: true,\n\t\t\t\t\t  loadingType: \'spinner\',\n\t\t\t\t\t  duration:0\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.createImg();\n\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t// Toast.clear();\n\t\t\t\t\t},3000)\n\t\t\t  \n\t\t\t     },600);//这里设置定时\n\t\t\t },\n\t\t\t      //手释放，如果在500毫秒内就释放，则取消长按事件，此时可以执行onclick应该执行的事件\n\t\t\tgotouchend(){\n\t\t\t    clearTimeout(timeOutEvent);\n\t\t\t      if(timeOutEvent!=0){\n\t\t\t        //这里写要执行的内容（尤如onclick事件）\n\t\t\t     }\n\t\t\t},\n\t\t\t//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按 \n\t\t\tgotouchmove(){\n\t\t\t     clearTimeout(timeOutEvent);//清除定时器\n\t\t\t     timeOutEvent = 0;\n\t\t\t},\n\n\t\t},\n\t\tmounted(){\n\n\t\t},\n\t\tcreated(){\n\n\t\t},\n\t\tcomputed:{\n\n\t\t},\n\t\twatch:{ \n\t\t\t\'isShow\':{\n\t\t\t\thandler:function(v){\n\t\t\t\t\tthis.shareImg = \'\';\n\n\t\t\t\t\tthis.show  = v;\n\n\t\t\t\t\tif(v){\n\n\t\t\t\t\t\t// if(this.isIOS){ //如果是苹果手机 先生成\n\t\t\t\t\t\t\t// alert(this.isIOS);\n\n\t\t\t\t\t\t\tToast.loading({\n\t\t\t\t\t\t\t  message: \'正在生成分享图片...\',\n\t\t\t\t\t\t\t  forbidClick: true,\n\t\t\t\t\t\t\t  loadingType: \'spinner\',\n\t\t\t\t\t\t\t  duration:0\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tlet img = new Image();\n\t\t\t\t\t\t\timg.onload = this.createImg;\n\t\t\t\t\t\t\timg.src = this.detailObj.cover;\n\n\n\t\t\t\t\t\t// }\n\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\timmediate:true\n\t\t\t}\n\n\t\t},\n\t\tdestroyed(){\n\t\t\tthis.shareImg = \'\';\n\t\t}\n\t}\n\n\n\n<\/script>\n<style scoped>\n.pp{\n\tposition: fixed;\n\tz-index: 1;\n\ttop:0;\n\tleft:0;\n\twidth: 100%;\n\tbottom:0;\n\t/*background: rgba(0,0,0,0.7);*/\n}\n.pp_con{ \n\tpadding: 15px;\n\twidth: 100%;\n\tposition: relative;\n\tborder-radius: 10px;\n\t-webkit-box-sizing: border-box;\n\t-moz-box-sizing: border-box;\n\tbox-sizing: border-box;\n} \n.share_pic .bg{\n\twidth: 100%;\n\tposition: relative;\n\tz-index: 0;\n}\n.share_pic{\n\tposition: relative;\n}\n.cover{\n\tposition: absolute;\n    z-index: 1;\n    top: 15%;\n    width: 69%;\n    left: 16%;\n    overflow: hidden;\n    border-radius: 5px;\n}\n.cover img{\n\tposition: absolute;\n\tz-index: 1;\n\tleft:0;\n\ttop:0;\n}\n.cover:after{\n\tcontent: "";\n\tdisplay: block;\n\tpadding-top: 100%;\n}\n\n.cover_img{\n\tposition: absolute;\n    z-index: 1;\n    top: 15%;\n    width: 69%;\n    left: 16%;\n    /*overflow: hidden;*/\n    border-radius: 5px;\n}\n\n.title{\n\twidth: 57%;\n    position: absolute;\n    z-index: 1;\n    left: 21%;\n    top: 63%;\n    height: 44px;\n    font-size: 16px;\n    font-weight: bold;\n    line-height: 22px;\n    text-align: justify;\n\n    overflow: hidden;\n     /*display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;*/\n\n}\n\n.save{\n\tposition: absolute;\n\tz-index: 1;\n    bottom: 12%;\n    right: 18%;\n    background: #fff;\n    width: 100px;\n    height: 20px;\n    line-height: 22px;\n    font-size: 14px;\n    border-radius: 10px;\n    text-align: center;\n    font-weight: bold;\n    pointer-events: none;\n}\n.close{\n\tposition: absolute;\n\tz-index: 1;\n    top: 15px;\n    right: 15px;\n    color: #fff;\n    font-weight: bold;\n    font-size: 20px;\n}\n.qr{\n\tposition: absolute;\n    z-index: 1;\n    left: 18%;\n    top: 77%;\n    width: 22%;\n}\n.shareImg{\n\tposition: absolute;\n\tleft:0;\n\ttop:0;\n\twidth: 100%;\n\tz-index: 1; \n}\n</style>\n')])])]),e("p",[t._v("pc代码：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("<template>\n\t<div class=\"share_inner notrigger\" :ref=\"'share_inner_'+dataIndex\" style=\"color:#000\"> \n\t\t\t\t<img class=\"bg notrigger\" src=\"../../static/img/share_bg.png\" alt=\"\">\n\t\t\t\t<img class=\"cover notrigger\" :src=\"dataObj.cover\" alt=\"\" > \n\n\t\t\t\t\x3c!-- <img class=\"cover\" src=\"../../static/img/404.png\" alt=\"\" >  --\x3e\n\t\t\n\t\t\t\t<div class=\"case_title notrigger\">{{formater(dataObj.title)}}</div>\n\n\t\t\t\t\x3c!-- <el-button class=\"download\" type=\"text\" @click=\"share\">下载</el-button>  --\x3e\n\t</div>\n</template>\n<script>\n\timport html2canvas from 'html2canvas';\n\timport FileSaver from 'file-saver';\n\texport default{\n\t\tcomponents:{},\n\t\tprops:['dataIndex','dataObj','setTip'],\n\t\tdata(){\n\t\t\treturn {\n\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tformater:function(title){\n\n\t\t\t\treturn title.replace(/(“|”)/g,'\"')\n\t\t\t\t.replace(/’|‘/g,\"'\")\n\t\t\t\t.replace(/\\（/g,'(')\n\t\t\t\t.replace(/\\）/g,')')\n\t\t\t\t.replace(/；/g,';')\n\t\t\t\t.replace(/。/g,'.')\n\t\t\t\t.replace(/：/g,':');\n\t\t\t},\n\t\t\tdataURLtoBlob:function(baseurl) {\n\t\t\t\t    let arr = baseurl.split(','),\n\t\t\t\t        mime = arr[0].match(/:(.*?);/)[1],\n\t\t\t\t        bstr = atob(arr[1]),\n\t\t\t\t        n = bstr.length,\n\t\t\t\t        u8arr = new Uint8Array(n);\n\t\t\t\t    while (n--) {\n\t\t\t\t        u8arr[n] = bstr.charCodeAt(n);\n\t\t\t\t    }\n\t\t\t\t    return new Blob([u8arr], {\n\t\t\t\t        type: mime\n\t\t\t\t    });\n\t\t\t},\n\t\t\tshare:function(index){ \n\n\t\t\t\tthis.setTip('正在生成分享图片...'); \n\n\n\t\t\t\t// let d = document.getElementById('share_'+index);\n\t\t\t\t// let d = document.getElementById('more');\n\t\t\t\tvar d = this.$refs['share_inner_'+this.dataIndex];\n\n\n\t\t\n\t\t\t\tlet w = d.offsetWidth;\n\t\t\t\tlet h = d.offsetHeight;\n\n\t\t\t\t// window.scrollTo(0, 0); \n\t\t\n\t\t\n\t\t\n\t\t\t\tsetTimeout(()=>{\n \n\t\t\t\t\tvar top = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop; \n\n\n\t\t\t\t\thtml2canvas(d, {\n\t\t\t\t\t\t// backgroundColor: '#000',\n\t\t\t\t\t\tbackgroundColor: \"transparent\",\n\t\t\t\t\t    allowTaint: true,\n\t\t\t\t\t    useCORS: true,\n\t\t\t\t\t    height: h,\n\t\t\t\t\t    width: w,\n\t\t\t\t\t    scrollY:-top-10, //增加鼠标划过向上移的10个象素\n\t\t\t\t\t    scale:window.devicePixelRatio,\n\t\t\t\t\t}).then(canvas => {  \n\n\t\t\t\t\t\t let fileName = new Date().getFullYear()+''+(new Date().getMonth()+1)+''+new Date().getDate()+''+parseInt(Math.random()*10000);\n\t\t\t\t\t\tFileSaver.saveAs(this.dataURLtoBlob(canvas.toDataURL(\"image/png\")), fileName+\".png\");\n\t\t\t\t\n\t\t\t\t\t\tthis.setTip(''); \n\n\n\t\t\t\t\t});\n\n\t\t\t\t},200)\n \n\n\t\t\n\n\n\n\n\n\t\t\t}\n\t\t},\n\t\tmounted(){\n\n\t\t},\n\t\tcreated(){\n\t\n\t\t},\n\t\tcomputed:{\n\n\t\t},\n\t\twatch:{\n\n\t\t}\n\t}\n\n<\/script>\n<style scoped>\n\n.share_inner{\n\twidth: 278px;\n\theight: 398px;\n    position: relative;\n  /*  top: 0;\n    left: 50%; \n    margin-left: -186px;*/\n\t/*display: none;*/\n\t/*background: url(../../static/img/share_bg.png) center center no-repeat;\n    background-size: auto 100%;*/\n}\n \n.bg{\n\theight: 100%;\n    position: relative;\n    z-index: 0;\n    margin: 0 auto;\n    display: block;\n}\n.cover{\n\tposition: absolute;\n\tz-index: 1;\n    width: 193px;\n    height: 193px;\n    top: 66px;\n    left: 50%;\n    margin-left: -97px;\n    border-radius: 7px;\n}\n.case_title{\n\tposition: absolute;\n\tz-index: 1;\n    width: 148px;\n    height: 32px;\n    left: 63px;\n    top: 265px;\n    font-size: 14px;\n    font-weight: bold;\n    line-height: 16px;\n    text-align: justify;\n\n    overflow: hidden;\n   /* display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;*/\n}\n\n.download{\n\tposition: absolute;\n    left: 50%;\n    bottom: 6px;\n    color: #fff;\n    cursor: pointer;\n    width: 50px;\n    height: 50px;\n    margin-left: -25px;\n}\n\n</style>\n")])])]),e("backTop")],1)}),[],!1,null,null,null);n.default=a.exports}}]);