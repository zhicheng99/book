(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{448:function(t,n,i){"use strict";i.r(n);var s=i(10),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,i=t._self._c||n;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("h1",{attrs:{id:"自己实现的【在线裁图】组件"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#自己实现的【在线裁图】组件"}},[t._v("#")]),t._v(" 自己实现的【在线裁图】组件")]),t._v(" "),i("p",[t._v("https://github.com/zhicheng99/qcut.git")]),t._v(" "),i("p",[i("img",{attrs:{src:"Public/upload/2021-06-29/60da8230bfb47.png",alt:"60da8230bfb47.png"}})]),t._v(" "),i("p",[t._v("app.vue")]),t._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[t._v('<template>\n  <div id="app">\n    <input\n      id="file"\n      type="file"\n      @change="addImg"\n      accept="image/png,image/jpeg,image/gif,image/jpg"\n    />\n    =============================\n    <br />自由裁图：\n    <div style="width: 200px; height: 300px">\n      <qcut ref="qcut1" v-bind:file-obj="file" />\n    </div>\n    <span id="qcut1"></span>\n    <button @click="cut1">裁图</button><br />\n    ============================== <br />\n    等比裁图\n    <div style="width: 300px; height: 300px">\n      <qcut\n        ref="qcut2"\n        v-bind:is-fixed="fixed"\n        v-bind:fixed-ratio="ratio"\n        v-bind:file-obj="file"\n      />\n    </div>\n\n    <span id="qcut2"></span>\n    <button @click="cut2">裁图</button><br />\n    ============================== <br />\n  </div>\n</template>\n\n<script>\nimport qcut from "./components/qcut";\n\nexport default {\n  name: "App",\n  components: {\n    qcut,\n  },\n  data() {\n    return {\n      fixed: true,\n      file: null,\n      ratio: [2, 3],\n    };\n  },\n  methods: {\n    addImg: function (e) {\n      this.file = e.target.files[0];\n    },\n    cut1: function () {\n      document.getElementById("qcut1").innerHTML =\n        \'<img src="\' + this.$refs.qcut1.getCropData() + \'" />\';\n    },\n    cut2: function () {\n      document.getElementById("qcut2").innerHTML =\n        \'<img src="\' + this.$refs.qcut2.getCropData() + \'" />\';\n    },\n  },\n};\n<\/script>\n\n<style>\n</style>\n\n')])])]),i("p",[t._v("qcut.vue")]),t._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[t._v('<template>\n  \x3c!-- <div> --\x3e\n  <div class="cropper" ref="cropper">\n    <div\n      class="bg"\n      v-if="base64 != \'\'"\n      :style="{\n        width: bg_width + \'px\',\n        height: bg_height + \'px\',\n        transform:\n          \'scale(\' +\n          scaleX +\n          \',\' +\n          scaleY +\n          \') translate3d(\' +\n          translateX / scaleBase +\n          \'px,\' +\n          translateY / scaleBase +\n          \'px,0px)\',\n      }"\n    >\n      <img :src="base64" ref="cut_img" />\n    </div>\n\n    <div class="cropper-drag cropper-move" id="cropper-drag"></div>\n\n    <div\n      class="cut_cover"\n      id="cut_cover"\n      ref="cut_cover"\n      v-bind:style="{\n        width: cut_width + \'px\',\n        height: cut_height + \'px\',\n        left: cut_translateX + \'px\',\n        top: cut_translateY + \'px\',\n      }"\n    >\n      <div class="img_cover">\n        <div\n          class="front"\n          v-if="base64 != \'\'"\n          ref="front"\n          :style="{\n            width: bg_width + \'px\',\n            height: bg_height + \'px\',\n            transform:\n              \'scale(\' +\n              scaleX +\n              \',\' +\n              scaleY +\n              \') translate3d(\' +\n              frontX / scaleBase +\n              \'px,\' +\n              frontY / scaleBase +\n              \'px,0px)\',\n          }"\n        >\n          <img :src="base64" ref="front_img" />\n        </div>\n      </div>\n      <div id="tip">{{ cut_width | format }}x{{ cut_height | format }}</div>\n\n      <template v-if="!cut_moving">\n        <span id="point1" class="point"></span>\n        <span id="point2" class="point"></span>\n        <span id="point3" class="point"></span>\n        <span id="point4" class="point"></span>\n        <span id="point5" class="point"></span>\n        <span id="point6" class="point"></span>\n        <span id="point7" class="point"></span>\n        <span id="point8" class="point"></span>\n      </template>\n    </div>\n  </div>\n  \x3c!-- <input\n      id="file"\n      type="file"\n      @change="addImg"\n      accept="image/png,image/jpeg,image/gif,image/jpg"\n    />\n\n    <button @click="cut4">截图</button> \n  </div>--\x3e\n</template>\n\n<script>\nvar Event = {};\nEvent.addEvents = function (target, eventType, handle) {\n  if (target.addEventListener) {\n    Event.addEvents = function (target, eventType, handle) {\n      target.addEventListener(eventType, handle, false);\n    };\n  } else {\n    Event.addEvents = function (target, eventType, handle) {\n      target.attachEvent("on" + eventType, function () {\n        handle.call(target, arguments);\n      });\n    };\n  }\n  Event.addEvents(target, eventType, handle);\n};\nexport default {\n  props: ["isFixed", "fixedRatio", "fileObj"],\n  data() {\n    return {\n      base64: "",\n      cropper_width: 0,\n      cropper_height: 0,\n      img_width: 0,\n      img_height: 0,\n\n      bg_width: 0,\n      bg_height: 0,\n      old_bg_width: 0,\n      old_bg_height: 0,\n\n      disX: 0,\n      disY: 0,\n\n      translateX: 0,\n      translateY: 0,\n      init_translateX: -1,\n      init_translateY: -1,\n      init_centerX: -1,\n      init_centerY: -1,\n      scaleBase: 1,\n      scaleX: 1,\n      scaleY: 1,\n\n      drag: null,\n\n      cut_width: 100,\n      cut_height: 100,\n      fixed: false, // 是否开启截图框宽高固定比例\n      fixedNumber: [3, 4], // 截图框的宽高比例\n      fixedRate: 0,\n      old_cut_width: 100,\n      old_cut_height: 100,\n      cut_translateX: 0,\n      cut_translateY: 0,\n\n      cut_maxLeft: 0,\n      cut_maxTop: 0,\n\n      cut_moving: false, //裁剪框是否正在移动\n    };\n  },\n  filters: {\n    format: function (v) {\n      return parseInt(v);\n    },\n  },\n  methods: {\n    init_cut: function () {\n      if (this.fixed) {\n        this.fixedRate = this.fixedNumber[0] / this.fixedNumber[1];\n        //以宽度为准 重新计算高\n        this.cut_height = this.cut_width / this.fixedRate;\n      }\n    },\n    limitRange: function () {\n      //裁剪框限制在划动区域内\n      this.cut_maxLeft = this.cropper_width - this.cut_width;\n      this.cut_maxTop = this.cropper_height - this.cut_height;\n    },\n    getPosition: function (event) {\n      var e = event || window.event;\n      var scrollX =\n        document.documentElement.scrollLeft || document.body.scrollLeft;\n      var scrollY =\n        document.documentElement.scrollTop || document.body.scrollTop;\n      var x = e.pageX || e.clientX + scrollX;\n      var y = e.pageY || e.clientY + scrollY;\n      return {\n        x: x,\n        y: y,\n      };\n    },\n    initEvent: function () {\n      var _this = this;\n      Event.addEvents(this.$refs.cropper, "mousewheel", function (event) {\n        var delta = 0;\n        if (!event) event = window.event;\n        if (event.wheelDelta) {\n          //IE、chrome浏览器使用的是wheelDelta，并且值为“正负120”\n          delta = event.wheelDelta / 120;\n          if (window.opera) delta = -delta; //因为IE、chrome等向下滚动是负值，FF是正值，为了处理一致性，在此取反处理\n        } else if (event.detail) {\n          //FF浏览器使用的是detail,其值为“正负3”\n          delta = -event.detail / 3;\n        }\n\n        if (_this.base64 != "") {\n          if (delta < 0) {\n            _this.scaleBase += 0.01;\n          } else {\n            _this.scaleBase -= 0.01;\n          }\n          _this.scaleBase = _this.scaleBase <= 0 ? 0 : _this.scaleBase;\n\n          _this.scaleX = _this.scaleBase;\n          _this.scaleY = _this.scaleBase;\n\n          // _this.bg_width = _this.old_bg_width * _this.scaleBase;\n          // _this.bg_height = _this.old_bg_height * _this.scaleBase;\n          // console.log(_this.bg_width);\n          // console.log(_this.bg_height);\n\n          // _this.initBgImgPosition();\n        }\nevent.preventDefault();\n      });\n\n      Event.addEvents(this.$refs.cropper, "mousedown", function (event) {\n        var tmp = _this.getPosition(event);\n        var x = tmp.x,\n          y = tmp.y;\n\n        if (event.target.id == "cropper-drag") {\n          //背景图的覆盖层\n          _this.disX = x - _this.translateX;\n          _this.disY = y - _this.translateY;\n        } else if (event.target.className == "point") {\n          _this.disX = x - event.target.offsetLeft;\n          _this.disY = y - event.target.offsetTop;\n\n          //更新裁剪框的宽高位置记录\n          _this.old_cut_width = _this.$refs.cut_cover.offsetWidth;\n          _this.old_cut_height = _this.$refs.cut_cover.offsetHeight;\n          _this.old_cut_translateX = _this.$refs.cut_cover.offsetLeft;\n          _this.old_cut_translateY = _this.$refs.cut_cover.offsetTop;\n        } else {\n          _this.disX = x - event.target.offsetLeft;\n          _this.disY = y - event.target.offsetTop;\n        }\n\n        _this.drag = event.target;\n      });\n      Event.addEvents(this.$refs.cropper, "mousemove", function (event) {\n        if (_this.drag === null) {\n          return false;\n        }\n\n        var tmp = _this.getPosition(event);\n        var x = tmp.x,\n          y = tmp.y;\n\n        if (_this.drag.id == "cropper-drag") {\n          //在背景覆盖层滑动 移动底部图片\n\n          _this.translateX = x - _this.disX;\n          _this.translateY = y - _this.disY;\n        }\n\n        if (_this.drag.id == "cut_cover") {\n          //移动裁剪框\n          _this.cut_moving = true;\n\n          //裁剪框限制在容器内\n          var tmpX = x - _this.disX;\n          var tmpY = y - _this.disY;\n          tmpX =\n            tmpX <= 0\n              ? 0\n              : tmpX >= _this.cut_maxLeft\n              ? _this.cut_maxLeft\n              : tmpX;\n          tmpY =\n            tmpY <= 0 ? 0 : tmpY >= _this.cut_maxTop ? _this.cut_maxTop : tmpY;\n          _this.cut_translateX = tmpX;\n          _this.cut_translateY = tmpY;\n        }\n        if (_this.drag.id == "point1") {\n          //影响裁剪框宽、高、位置[x,y]\n\n          _this.cut_width = _this.old_cut_width - (x - _this.disX + 5);\n          // _this.cut_height = _this.old_cut_height-(y - _this.disY+5);\n\n          if (_this.fixed) {\n            //如果固定比例 就以宽为准 对高度做限\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          } else {\n            _this.cut_height = _this.old_cut_height - (y - _this.disY + 5);\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          // 以上计算变形一下  以宽 高为变量做计算\n          _this.cut_translateX =\n            _this.old_cut_translateX + (_this.old_cut_width - _this.cut_width);\n          _this.cut_translateY =\n            _this.old_cut_translateY +\n            (_this.old_cut_height - _this.cut_height);\n        }\n\n        if (_this.drag.id == "point2") {\n          //影响裁剪框高 位置y\n\n          // _this.cut_width = _this.old_cut_width-(x - _this.disX);\n          _this.cut_height = _this.old_cut_height - (y - _this.disY + 5);\n\n          if (_this.fixed) {\n            //固定比例时 以高为准\n            _this.cut_width = _this.cut_height * _this.fixedRate;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          // 以上计算变形一下  以宽 高为变量做计算\n          _this.cut_translateX =\n            _this.old_cut_translateX + (_this.old_cut_width - _this.cut_width);\n          _this.cut_translateY =\n            _this.old_cut_translateY +\n            (_this.old_cut_height - _this.cut_height);\n        }\n        if (_this.drag.id == "point3") {\n          //影响裁剪框宽、高、位置y\n\n          _this.cut_width = x - _this.disX + 5;\n          // _this.cut_height = _this.old_cut_height-(y - _this.disY+5);\n\n          if (_this.fixed) {\n            //固定比例时 以宽为准\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          } else {\n            _this.cut_height = _this.old_cut_height - (y - _this.disY + 5);\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          //以上计算变形一下 以宽 高为变量做计算\n          _this.cut_translateY =\n            _this.old_cut_translateY +\n            (_this.old_cut_height - _this.cut_height);\n        }\n        if (_this.drag.id == "point4") {\n          //影响裁剪框宽\n\n          _this.cut_width = x - _this.disX + 5;\n          // _this.cut_height = _this.old_cut_height-(y - _this.disY);\n\n          if (_this.fixed) {\n            //固定比例时 以宽为准\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          //以上计算变形一下 以宽 高为变量做计算\n        }\n        if (_this.drag.id == "point5") {\n          //影响裁剪框宽、高\n\n          _this.cut_width = x - _this.disX + 5;\n          // _this.cut_height = (y - _this.disY+5);\n\n          if (_this.fixed) {\n            //固定比例时 以宽为准\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          } else {\n            _this.cut_height = y - _this.disY + 5;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n        }\n        if (_this.drag.id == "point6") {\n          //影响裁剪框高\n\n          // _this.cut_width = (x - _this.disX+5);\n          _this.cut_height = y - _this.disY + 5;\n\n          if (_this.fixed) {\n            //固定比例时 以宽为准\n            _this.cut_width = _this.cut_height * _this.fixedRate;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n        }\n        if (_this.drag.id == "point7") {\n          //影响裁剪框宽、高 位置x\n\n          _this.cut_width = _this.old_cut_width - (x - _this.disX + 5);\n          // _this.cut_height = (y - _this.disY+5);\n\n          if (_this.fixed) {\n            //固定比例时 以宽为准\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          } else {\n            _this.cut_height = y - _this.disY + 5;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          //以上计算变形一下 以宽 高为变量做计算\n          _this.cut_translateX =\n            _this.old_cut_translateX + (_this.old_cut_width - _this.cut_width);\n        }\n        if (_this.drag.id == "point8") {\n          //影响裁剪框宽 位置x\n\n          _this.cut_width = _this.old_cut_width - (x - _this.disX + 5);\n          // _this.cut_height = (y - _this.disY+5);\n\n          if (_this.fixed) {\n            _this.cut_height = _this.cut_width / _this.fixedRate;\n          }\n\n          //point块的中心点位置即为裁剪框的[x,y]\n          // _this.cut_translateX = _this.old_cut_translateX +(x - _this.disX + 5);\n          // // _this.cut_translateY = _this.old_cut_translateY +(y - _this.disY + 5);\n\n          //以上计算变形一下 以宽 高为变量做计算\n          _this.cut_translateX =\n            _this.old_cut_translateX + (_this.old_cut_width - _this.cut_width);\n        }\n      });\n      Event.addEvents(this.$refs.cropper, "mouseup", function () {\n        _this.cut_moving = false;\n        _this.drag = null;\n      });\n    },\n    initBgImgPosition: function () {\n      //初始化背景图片位置 保证图片全部放到预览框内 居中显示\n      //情况一 图片宽高度都小于等于显示框的宽高 所以图片不需要缩放\n      if (\n        this.img_width <= this.cropper_width &&\n        this.img_height <= this.cropper_height\n      ) {\n        this.bg_width = this.img_width;\n        this.bg_height = this.img_height;\n      } else {\n        //计算缩放比例\n        var cropper_rate = this.cropper_width / this.cropper_height;\n        var img_rate = this.img_width / this.img_height;\n        if (cropper_rate >= img_rate) {\n          //以图片高度显示全为准\n          this.bg_height = this.cropper_height;\n          this.bg_width =\n            this.img_width / (this.img_height / this.cropper_height);\n        } else {\n          this.bg_width = this.cropper_width;\n          this.bg_height =\n            this.img_height / (this.img_width / this.cropper_width);\n        }\n      }\n\n      if (this.old_bg_width == 0) {\n        this.old_bg_width = this.bg_width;\n        this.old_bg_height = this.bg_height;\n      }\n\n      this.translateX = (this.cropper_width - this.bg_width) * 0.5;\n      this.translateY = (this.cropper_height - this.bg_height) * 0.5;\n\n      if (this.init_translateX == -1) {\n        this.init_translateX = this.translateX;\n        this.init_translateY = this.translateY;\n      }\n    },\n    toBase64: function (file) {\n      var _this = this;\n      let reader = new FileReader();\n      reader.onload = function (evt) {\n        var base64 = evt.target.result;\n\n        var img = new Image();\n        img.onload = function () {\n          _this.img_width = this.width;\n          _this.img_height = this.height;\n\n          //初始化\n          (_this.scaleBase = 1),\n            (_this.scaleX = 1),\n            (_this.scaleY = 1),\n            (_this.old_bg_width = 0);\n          _this.init_translateX = -1;\n\n          _this.initBgImgPosition();\n          _this.base64 = base64;\n        };\n        img.src = base64;\n      };\n      reader.readAsDataURL(file);\n    },\n    addImg: function (e) {\n      this.toBase64(e.target.files[0]);\n    },\n    getCropData: function () {\n      return this.cut4();\n    },\n    cut4: function () {\n      //对cut3的优化  需要进一步测试验证\n      if (this.base64 == "") {\n        return false;\n      }\n\n      //因为scale样式不能具体体现实际大小 所以得重新计算缩放时候 底图相对于整体区域的位置\n      var w = this.bg_width * this.scaleBase;\n      var h = this.bg_height * this.scaleBase;\n\n      // console.log(\'实际的宽度：\'+w);\n      // console.log(\'实际的高度：\'+h);\n\n      //缩放后相对位置计算\n      // var off_scale_x = x - w * 0.5;\n      // var off_scale_y = y - h * 0.5;\n      // var off_scale_x = x - this.cropper_width * 0.5;\n      // var off_scale_y = y - this.cropper_height * 0.5;\n      // var off_scale_x = this.cropper_width*0.5 - w * 0.5;\n      // var off_scale_y = this.cropper_height*0.5 - h * 0.5;\n      // console.log(\'初始化底图片translateX:\'+this.init_translateX);\n      // console.log(\'初始化底图片translateY:\'+this.init_translateY);\n\n      //计算图片相对于初始位置移动了多少\n      //正值是向上 向左移了\n      //负值是向下 向右移了\n      var dis_x = this.init_translateX - this.translateX;\n      var dis_y = this.init_translateY - this.translateY;\n      // console.log(\'dis_x:\'+dis_x);\n      // console.log(\'dis_y:\'+dis_y);\n\n      // var off_scale_x = (this.cropper_width - w)*0.5-dis_x;\n      // var off_scale_y = (this.cropper_height - h)*0.5-dis_y;\n      // console.log(\'初始化底图片中心坐标x:\'+this.init_centerX);\n      // console.log(\'初始化底图片中心坐标y:\'+this.init_centerY);\n\n      var center_x = this.init_centerX - dis_x;\n      var center_y = this.init_centerY - dis_y;\n\n      // console.log(\'缩放后的图片中心点x:\'+center_x);\n      // console.log(\'缩放后的图片中心点y:\'+center_y);\n\n      var off_scale_x = center_x - w * 0.5;\n      var off_scale_y = center_y - h * 0.5;\n\n      // console.log(\'缩放后的x的偏移：\'+off_scale_x);\n      // console.log(\'缩放后的y的偏移：\'+off_scale_y);\n\n      var canvas = document.createElement("canvas");\n      var ctx = canvas.getContext("2d");\n\n      canvas.width = this.cut_width;\n      canvas.height = this.cut_height;\n\n      //图片尺寸整体小于容器\n      if (\n        this.img_width <= this.cropper_width &&\n        this.img_height <= this.cropper_height\n      ) {\n        ctx.drawImage(\n          this.$refs.cut_img,\n          (this.cut_translateX - off_scale_x) / this.scaleBase,\n          (this.cut_translateY - off_scale_y) / this.scaleBase,\n\n          this.cut_width / this.scaleBase,\n          this.cut_height / this.scaleBase,\n          0,\n          0,\n          this.cut_width,\n          this.cut_height\n        );\n\n        // console.log(canvas.toDataURL("image/png", 1.0));\n      } else {\n        // console.log(\'图片尺寸大于容器\');\n        //计算初始显示图片时 尺寸与原图的比例\n        var cropper_rate = this.cropper_width / this.cropper_height;\n        var img_rate = this.img_width / this.img_height;\n        if (cropper_rate >= img_rate) {\n          //以图片高度显示全为准\n          // console.log(\'以高度比例为准\')\n          var scale_rate = this.cropper_height / this.img_height;\n        } else {\n          // console.log(\'以宽度比例为准\')\n\n          var scale_rate = this.cropper_width / this.img_width;\n          // console.log(\'初始图片尺寸与原图比例：\'+scale_rate);\n        }\n\n        ctx.drawImage(\n          this.$refs.cut_img,\n          (this.cut_translateX - off_scale_x) / this.scaleBase / scale_rate,\n          (this.cut_translateY - off_scale_y) / this.scaleBase / scale_rate,\n\n          this.cut_width / this.scaleBase / scale_rate,\n          this.cut_height / this.scaleBase / scale_rate,\n          0,\n          0,\n          this.cut_width,\n          this.cut_height\n        );\n\n        // console.log(canvas.toDataURL("image/png", 1.0));\n      }\n\n      return canvas.toDataURL("image/png", 1.0);\n    },\n    cut3: function () {\n      //算对了 但是复杂  多了一层临时画布的过程\n      if (this.base64 == "") {\n        return false;\n      }\n\n      //因为scale样式不能具体体现实际大小 所以得重新计算缩放时候 底图相对于整体区域的位置\n      var w = this.bg_width * this.scaleBase;\n      var h = this.bg_height * this.scaleBase;\n\n      console.log("实际的宽度：" + w);\n      console.log("实际的高度：" + h);\n\n      //缩放后相对位置计算\n      // var off_scale_x = x - w * 0.5;\n      // var off_scale_y = y - h * 0.5;\n      // var off_scale_x = x - this.cropper_width * 0.5;\n      // var off_scale_y = y - this.cropper_height * 0.5;\n      // var off_scale_x = this.cropper_width*0.5 - w * 0.5;\n      // var off_scale_y = this.cropper_height*0.5 - h * 0.5;\n      console.log("初始化底图片translateX:" + this.init_translateX);\n      console.log("初始化底图片translateY:" + this.init_translateY);\n\n      console.log("当前图片translateX:" + this.translateX);\n      console.log("当前图片translateY:" + this.translateY);\n      console.log(this.init_translateX - this.translateX);\n      //计算图片相对于初始位置移动了多少\n      //正值是向上 向左移了\n      //负值是向下 向右移了\n      var dis_x = this.init_translateX - this.translateX;\n      var dis_y = this.init_translateY - this.translateY;\n      console.log("dis_x:" + dis_x);\n      console.log("dis_y:" + dis_y);\n\n      // var off_scale_x = (this.cropper_width - w)*0.5-dis_x;\n      // var off_scale_y = (this.cropper_height - h)*0.5-dis_y;\n      console.log("初始化底图片中心坐标x:" + this.init_centerX);\n      console.log("初始化底图片中心坐标y:" + this.init_centerY);\n\n      var center_x = this.init_centerX - dis_x;\n      var center_y = this.init_centerY - dis_y;\n\n      console.log("缩放后的图片中心点x:" + center_x);\n      console.log("缩放后的图片中心点y:" + center_y);\n\n      var off_scale_x = center_x - w * 0.5;\n      var off_scale_y = center_y - h * 0.5;\n\n      console.log("缩放后的x的偏移：" + off_scale_x);\n      console.log("缩放后的y的偏移：" + off_scale_y);\n\n      var old_canvas = document.createElement("canvas");\n      var old_ctx = old_canvas.getContext("2d");\n      old_canvas.width = w;\n      old_canvas.height = h;\n      old_ctx.drawImage(\n        this.$refs.cut_img,\n        0,\n        0,\n        this.img_width,\n        this.img_height,\n        0,\n        0,\n        old_canvas.width,\n        old_canvas.height\n      );\n\n      // console.log(old_canvas.toDataURL());\n\n      setTimeout(() => {\n        var canvas = document.createElement("canvas");\n        var ctx = canvas.getContext("2d");\n\n        canvas.width = this.cut_width;\n        canvas.height = this.cut_height;\n\n        ctx.drawImage(\n          old_canvas,\n          this.cut_translateX - off_scale_x,\n          this.cut_translateY - off_scale_y,\n\n          this.cut_width,\n          this.cut_height,\n          0,\n          0,\n          this.cut_width,\n          this.cut_height\n        );\n\n        console.log(canvas.toDataURL());\n      }, 200);\n    },\n    cut2: function () {\n      //失败 没算对\n      if (this.base64 == "") {\n        return false;\n      }\n      console.log(this.$refs.front.getBoundingClientRect());\n\n      var old_canvas = document.createElement("canvas");\n      var old_ctx = old_canvas.getContext("2d");\n      old_canvas.width = this.$refs.front_img.offsetWidth * this.scaleBase;\n      old_canvas.height = this.$refs.front_img.offsetHeight * this.scaleBase;\n      old_ctx.drawImage(\n        this.$refs.cut_img,\n        0,\n        0,\n        this.bg_width,\n        this.bg_height,\n        0,\n        0,\n        old_canvas.width,\n        old_canvas.height\n      );\n\n      setTimeout(() => {\n        var canvas = document.createElement("canvas");\n        var ctx = canvas.getContext("2d");\n        ctx.scale(this.scaleBase, this.scaleBase);\n\n        canvas.width = this.cut_width;\n        canvas.height = this.cut_height;\n\n        // var startX = -(this.frontX);\n        // var startY = -(this.frontY);\n\n        //缩放后图片相对于区域的位置\n        var startX = (-this.translateX / this.scaleBase) * 0.5;\n        var startY = (-this.translateY / this.scaleBase) * 0.5;\n        console.log(startX);\n        console.log(startY);\n\n        ctx.drawImage(\n          old_canvas,\n          startX,\n          startY,\n\n          this.cut_width,\n          this.cut_height,\n          0,\n          0,\n          this.cut_width,\n          this.cut_height\n        );\n\n        console.log(canvas.toDataURL());\n      }, 200);\n\n      // var canvas = document.createElement(\'canvas\');\n      // var ctx = canvas.getContext(\'2d\');\n      // ctx.scale(this.scaleBase,this.scaleBase);\n\n      // canvas.width = this.cut_width;\n      // canvas.height = this.cut_height;\n      // var startX = this.cut_translateX - this.translateX/this.scaleBase;\n      // var startY = this.cut_translateY - this.translateY/this.scaleBase;\n\n      // console.log(startX);\n      // console.log(startY);\n\n      // ctx.drawImage(\n      //     this.$refs.cut_img,\n      //     startX,\n      //     startY,\n\n      //     this.cut_width,\n      //     this.cut_height,\n      //     0,0,\n      //     this.cut_width,\n      //     this.cut_height,\n      //     )\n\n      // console.log(canvas.toDataURL());\n    },\n    cut1: function () {\n      //失败 没算对\n\n      if (this.base64 == "") {\n        return false;\n      }\n\n      var old_canvas = document.createElement("canvas");\n      var old_ctx = old_canvas.getContext("2d");\n      old_canvas.width = this.$refs.front_img.offsetWidth * this.scaleBase;\n      old_canvas.height = this.$refs.front_img.offsetHeight * this.scaleBase;\n      old_ctx.drawImage(\n        this.$refs.cut_img,\n        0,\n        0,\n        this.bg_width,\n        this.bg_height,\n        0,\n        0,\n        old_canvas.width,\n        old_canvas.height\n      );\n\n      console.log(old_canvas.toDataURL());\n\n      var canvas = document.createElement("canvas");\n      canvas.width = this.cut_width;\n      canvas.height = this.cut_height;\n      var ctx = canvas.getContext("2d");\n\n      var startX = this.cut_translateX - this.translateX;\n      var startY = this.cut_translateY - this.translateY;\n      console.log(startX);\n      console.log(startY);\n\n      // ctx.drawImage(\n      //     this.$refs.cut_img,\n      //     startX,startY,\n\n      //     this.cut_width,\n      //     this.cut_height,\n      //     0,0,\n      //     this.cut_width,\n      //     this.cut_height,\n      //     )\n\n      // console.log(canvas.toDataURL());\n    },\n\n    cut: function () {\n      //失败 没算对\n\n      if (this.base64 == "") {\n        return false;\n      }\n      var old_canvas = document.createElement("canvas");\n      var canvas = document.createElement("canvas");\n      var old_ctx = old_canvas.getContext("2d");\n      var ctx = canvas.getContext("2d");\n      // ctx.scale(this.scaleBase,this.scaleBase);\n\n      old_canvas.width = this.$refs.front_img.offsetWidth * this.scaleBase;\n      old_canvas.height = this.$refs.front_img.offsetHeight * this.scaleBase;\n\n      canvas.width = this.cut_width;\n      canvas.height = this.cut_height;\n      console.log(this.$refs.front_img.offsetWidth * this.scaleBase);\n\n      old_ctx.drawImage(\n        this.$refs.cut_img,\n        0,\n        0,\n        this.bg_width,\n        this.bg_height,\n        0,\n        0,\n        old_canvas.width,\n        old_canvas.height\n      );\n\n      console.log(old_canvas.toDataURL());\n      setTimeout(() => {\n        ctx.drawImage(\n          old_canvas,\n          -this.frontX,\n          -this.frontY,\n          this.cut_width * this.scaleBase,\n          this.cut_height * this.scaleBase,\n          0,\n          0,\n          this.cut_width,\n          this.cut_height\n        );\n        console.log(canvas.toDataURL());\n      }, 200);\n\n      // var new_translateX = this.translateX/this.scaleBase;\n      // var new_translateY = this.translateY/this.scaleBase;\n      // var new_width = this.cut_width*this.scaleBase;\n      // var new_height = this.cut_height*this.scaleBase;\n      // console.log(\'-----\')\n      // console.log(this.scaleBase);\n      // console.log(new_translateX);\n      // console.log(new_width);\n\n      // ctx.drawImage(\n      //     this.$refs.cut_img,\n      //     this.cut_translateX - new_translateX,\n      //     this.cut_translateX - new_translateY,\n\n      //     new_width,\n      //     new_height,\n      //     0,0,\n      //     this.cut_width,\n      //     this.cut_height,\n      //     )\n\n      // console.log(canvas.toDataURL());\n\n      // var startX = this.cut_translateX - this.translateX/this.scaleBase;\n      // var startY = this.cut_translateY - this.translateY/this.scaleBase;\n\n      // console.log(startX);\n      // console.log(startY);\n\n      // ctx.drawImage(\n      //     this.$refs.cut_img,\n      //     startX,\n      //     startY,\n\n      //     this.cut_width,\n      //     this.cut_height,\n      //     0,0,\n      //     this.cut_width,\n      //     this.cut_height,\n      //     )\n\n      // console.log(canvas.toDataURL());\n    },\n  },\n  mounted() {\n    this.cropper_width = this.$refs.cropper.offsetWidth;\n    this.cropper_height = this.$refs.cropper.offsetHeight;\n\n    this.init_centerX = this.cropper_width * 0.5;\n    this.init_centerY = this.cropper_height * 0.5;\n\n    this.init_cut();\n\n    this.limitRange();\n    this.initEvent();\n  },\n  computed: {\n    frontX() {\n      return this.translateX - this.cut_translateX;\n    },\n    frontY() {\n      return this.translateY - this.cut_translateY;\n    },\n  },\n  watch: {\n    isFixed: {\n      handler: function (v) {\n        if (v !== "") {\n          this.fixed = v;\n          this.init_cut();\n        }\n      },\n      immediate: true,\n    },\n    fixedRatio: {\n      handler: function (v) {\n        if (v) {\n          this.fixedNumber = v;\n          this.init_cut();\n          this.limitRange();\n        }\n      },\n      immediate: true,\n    },\n    fileObj: function (v) {\n      if (v === null) {\n        return;\n      }\n      if (typeof v !== "undefined" && v !== "") {\n        this.toBase64(v);\n      }\n    },\n  },\n};\n<\/script>\n\n\x3c!-- Add "scoped" attribute to limit CSS to this component only --\x3e\n<style scoped>\n.cropper {\n  position: relative;\n  /*width: 200px;\n  height: 250px;*/\n  width: 100%;\n  height: 100%;\n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC);\n  overflow: hidden;\n  user-select: none;\n}\n.bg {\n  transition: transform 0.05s;\n  -moz-transition: transform 0.05s; /* Firefox 4 */\n  -webkit-transition: transform 0.05s; /* Safari 和 Chrome */\n  -o-transition: transform 0.05s; /*Opera */\n  transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -webkit-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n}\n.front {\n  transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -webkit-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n}\n.bg img,\n.front img {\n  max-width: 100%;\n  max-height: 100%;\n  pointer-events: none;\n  transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0); /* IE 9 */\n  -moz-transform: translate3d(0, 0, 0); /* Firefox */\n  -webkit-transform: translate3d(0, 0, 0); /* Safari 和 Chrome */\n  -o-transform: translate3d(0, 0, 0); /* Opera */\n  transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -webkit-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n}\n.cropper-move {\n  cursor: move;\n}\n.cropper-drag {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  user-select: none;\n  background: rgba(0, 0, 0, 0.5);\n}\n\n.cut_cover {\n  box-sizing: border-box;\n  border: solid blue 1px;\n  position: absolute;\n  transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0); /* IE 9 */\n  -moz-transform: translate3d(0, 0, 0); /* Firefox */\n  -webkit-transform: translate3d(0, 0, 0); /* Safari 和 Chrome */\n  -o-transform: translate3d(0, 0, 0); /* Opera */\n  transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -webkit-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n\n  cursor: move;\n}\n.point {\n  position: absolute;\n  display: block;\n  width: 10px;\n  height: 10px;\n  border-radius: 5px;\n  background: blue;\n  transform: translate3d(0, 0, 0);\n  -ms-transform: translate3d(0, 0, 0); /* IE 9 */\n  -moz-transform: translate3d(0, 0, 0); /* Firefox */\n  -webkit-transform: translate3d(0, 0, 0); /* Safari 和 Chrome */\n  -o-transform: translate3d(0, 0, 0); /* Opera */\n  opacity: 0.5;\n}\n#point1 {\n  left: -5px;\n  top: -5px;\n  cursor: nw-resize;\n}\n#point2 {\n  left: 50%;\n  margin-left: -5px;\n  top: -5px;\n  cursor: ns-resize;\n}\n#point3 {\n  right: -5px;\n  margin-left: -5px;\n  top: -5px;\n  cursor: ne-resize;\n}\n#point4 {\n  right: -5px;\n  margin-top: -5px;\n  top: 50%;\n  cursor: ew-resize;\n}\n#point5 {\n  right: -5px;\n  bottom: -5px;\n  cursor: se-resize;\n}\n#point6 {\n  left: 50%;\n  margin-left: -5px;\n  bottom: -5px;\n  cursor: ns-resize;\n}\n#point7 {\n  left: -5px;\n  bottom: -5px;\n  cursor: sw-resize;\n}\n#point8 {\n  left: -5px;\n  margin-top: -5px;\n  top: 50%;\n  cursor: ew-resize;\n}\n\n.img_cover {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  overflow: hidden;\n  transform-origin: 50% 50%;\n  -ms-transform-origin: 50% 50%;\n  -moz-transform-origin: 50% 50%;\n  -webkit-transform-origin: 50% 50%;\n  -o-transform-origin: 50% 50%;\n}\n\n#tip {\n  position: absolute;\n  left: 0;\n  top: -20px;\n  font-size: 12px;\n  color: blue;\n  background: #fff;\n  pointer-events: none;\n}\n</style>\n\n')])])]),i("backTop")],1)}),[],!1,null,null,null);n.default=e.exports}}]);