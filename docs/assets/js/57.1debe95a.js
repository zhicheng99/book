(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{426:function(t,n,e){"use strict";e.r(n);var i=e(10),s=Object(i.a)({},(function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"在线裁图-分块上传图片-vue组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在线裁图-分块上传图片-vue组件"}},[t._v("#")]),t._v(" 在线裁图+分块上传图片 vue组件")]),t._v(" "),e("p",[t._v("调用")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<UploadChunk v-if="addVisible"\nv-bind:max-num="\'1\'"\nv-bind:upload-img.sync="addForm.logo"\nv-bind:is-cut="true"\nv-bind:fixed-number="\'2:1\'"\n\n> </UploadImg>\n')])])]),e("p",[t._v("UploadChunk.vue")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("<template>\n<div class=\"clear\" id=\"uu\">\n<div class=\"item up\" v-for=\"(item,index) in imgs\"\nv-bind:style=\"{\n'background': 'url('+item+') center center no-repeat',\n'backgroundSize':'cover',\n'position':'relative',\n'backgroundColor':'#fff'}\"\n@click=\"showPre(item,index)\"\n>\n\n\n<i class=\"el-icon-close\" @click.stop=\"close(index)\" v-if=\"!onlyPreview\"></i>\n\n\n<i v-if=\"showDown\"  class=\"down\" v-bind:class=\"{'el-icon-download':pindex != index,'el-icon-loading':pindex==index}\" @click.stop=\"down(item,index)\"></i>\n\n  <div class=\"pro_lay\" v-if=\"editIndex == index && percent!=0\">\n\t\t<div class=\"progress\" v-bind:style=\"{'width':percent+'%'}\"></div>\n  </div>\n</div>\n<div class=\"item up box box-align-center\" v-if=\"imgs.length<limtNum\">\n\t<i class=\"el-icon-upload\"></i>\n\n\t<input :key=\"key\" type=\"file\" @change=\"addImg\" ref=\"inputer\" accept=\"image/png,image/jpeg,image/gif,image/jpg\">\n\n\n\t<div class=\"pro_lay\" v-if=\"editIndex == -1 && percent!=0\">\n\t\t<div class=\"progress\" v-bind:style=\"{'width':percent+'%'}\"></div>\n\t</div>\n</div>\n\n\n\n<CutImg\nv-bind:is-show.sync=\"isShow\"\nv-bind:img-url=\"imgUrl\"\nv-bind:call-back=\"initStep\"\nv-bind:file-name=\"fileName\"\nv-bind:file-type=\"fileType\"\nv-bind:fixed-number=\"fixedNumber\"\n></CutImg>\n\n\n</div>\n\n\n\n</template>\n<script>\n\timport FileSaver from 'file-saver';\n\timport CutImg from './CutImg.vue'\n\n\nexport default{\ncomponents:{\nCutImg\n},\nprops:['maxNum','uploadImg','isDown','onlyPreview','pieceSize','isCut','fixedNumber'],\ndata(){\nreturn {\nkey:'0',\n\n\nisShow:false,\n\t\timg:'',\n\n\t\timgs:[\n\t\t\t// '../../static/img/no.jpg'\n\t\t],\n\t\teditIndex:-1,\n\t\tlimtNum:2,\n\n\t\tmaxW :500,\n\t\tmaxH :500,\n\n\t\tshowDown:false,\n\t\tdowning:[],\n\t\tpindex:-1, \n\n\n\n\t\t//分块上传\n\t\tblobSlice: null,\n        file: null,\n        identifier: null,\n        chunkSize: 1024000,\n        chunks: 0,\n        currentChunk: 0,\n        spark: null,\n        fileReader: null,\n        tmpDataList: [],\n        formDataList: [],\n        uploadedList: [],\n        start: 0,\n        end: 0,\n        headers: {},\n        // urlCode: code.urlCode.lectureDemand,\n        xhr: null,\n        pauseStatus: false,\n        showProgress: false,\n        percent: 0,\n\n\n        uploadingChunk:0,  //正在上传的块\n        snapshotFlag:0,\n        saveType:'local',\n        taskId:'',\n\n\n        //在线裁图\n        isShow:false,\n        isCut:false,\n        imgUrl:'',\n        fileName:'',\n        fileType:'',\n\n        editLoading:null\n\n\n\t}\n},\nmethods:{\n\tdataURLtoBlob:function(baseurl) {\n\t\t    let arr = baseurl.split(','),\n\t\t        mime = arr[0].match(/:(.*?);/)[1],\n\t\t        bstr = atob(arr[1]),\n\t\t        n = bstr.length,\n\t\t        u8arr = new Uint8Array(n);\n\t\t    while (n--) {\n\t\t        u8arr[n] = bstr.charCodeAt(n);\n\t\t    }\n\t\t    return new Blob([u8arr], {\n\t\t        type: mime\n\t\t    });\n\t},\n\tdown:function(url,index){\n\n\n\n\t\tif(this.pindex != -1){\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pindex = index;\n\n\t\tvar img = new Image();\n\t\timg.onload = ()=>{\n\n\t\t\tlet w = img.width;\n\t\t\tlet h = img.height;\n\n\t\t\tlet canvas = document.createElement('canvas');\n\t\t\tlet ctx = canvas.getContext('2d');\n\t\t\tcanvas.width = w;\n\t\t\tcanvas.height = h;\n\n\t\t\tctx.drawImage(img,0,0);\n\n\n\t\t\tlet fileName = new Date().getFullYear()+''+(new Date().getMonth()+1)+''+new Date().getDate()+''+parseInt(Math.random()*10000);\n\n\t\t\tFileSaver.saveAs(this.dataURLtoBlob(canvas.toDataURL(\"image/png\")), fileName+\".png\");\n\n\t\t\tsetTimeout(()=>{\n\t\t\t\tthis.pindex = -1;\n\t\t\t})\n\n\t\t}\n\t\timg.src = url;\n\t},\n\thide:function(){\n\t\tthis.isShow = false;\n\t},\n\n\tshowPre:function(url,editIndex){\n\n\t\tif(!this.isCut){\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.editLoading = this.$loading({\n          lock: true,\n          text: 'Loading',\n          spinner: 'el-icon-loading',\n          background: 'rgba(0, 0, 0, 0.7)'\n        });\n\n\n\t\tthis.editIndex = editIndex;\n\n\t\tvar _this = this;\n\t\tvar i = new Image();\n\t\ti.onload = function(){\n\n\t\t\tlet w = i.width;\n\t\t\tlet h = i.height;\n\n\t\t\tlet canvas = document.createElement('canvas');\n\t\t\tlet ctx = canvas.getContext('2d');\n\t\t\tcanvas.width = w;\n\t\t\tcanvas.height = h;\n\n\t\t\tctx.drawImage(i,0,0);\n\n\t\t\ttry{\n\n\t\t\t\tlet reader = new FileReader();\n\t\t\t    reader.onload =  (evt)=> {\n\t\t\t      var base64 = evt.target.result\n\t\t\t\t      _this.imgUrl = base64;\n\n\t\t\t\t      var t = url.split('/')\n\n\t\t\t\t      _this.fileName = t[t.length-1];\n\t\t\t\t      _this.fileType = 'image/png';\n\t\t              _this.isShow = true;\n\t\t              _this.editLoading.close();\n\t\t\t    };\n\t\t\t    reader.onerror = ()=>{\n\t\t              _this.editLoading.close();\n\t\t\t    }\n\t\t\t    reader.readAsDataURL(_this.dataURLtoBlob(canvas.toDataURL(\"image/png\")));\n\n\n\n\t\t\t} catch(e){\n\t\t\t\tconsole.log(e);\n\t\t\t\t_this.$message({\n\t\t\t\t\tmessage:'图片数据转换失败（可能原因：图片跨域）',\n\t\t\t\t\ttype:'warning'\n\t\t\t\t})\n\t\t        _this.editLoading.close();\n\n\t\t\t}\n\n\n\t\t}\n\t\turl = url.indexOf(location.protocol)>-1?url:url.replace(/http.*?\\/\\//g,location.protocol+'//');\n\t\tconsole.log(url);\n\t\ti.src = url;\n\n\n\n\n\n\n\n\t\t// this.img = img;\n\t\t// this.isShow = true;\n\t},\n\n\tclose:function(index){\n\t\tthis.imgs.splice(index,1);\n\n\n\t\tif(typeof this.uploadImg != 'undefined'){\n\t\t\t    this.$emit('update:uploadImg',this.imgs.join(','));\n\n\t\t}\n\n\n\t}, \n\taddImg:function(file){\n\n\t\tif(this.limtNum == this.imgs.length){\n\n\t\t\tthis.$message({\n\t\t\t\tmessage:'最多可上传'+this.limtNum+'张图片！',\n\t\t\t\ttype:'warning'\n\n\t\t\t}) \n\t\t\treturn false;\n\t\t}\n\n\n\t\tlet inputDOM = this.$refs.inputer;  \n\t\tif(typeof inputDOM.files[0] == 'undefined'){\n\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.fileChange(inputDOM.files[0]);\n\n\n\n\t\t// this.$postWithFile('/admin/system/uploadFile',{\n\t\t// \tfile:inputDOM.files[0], \n\t\t// }).then(({code,obj})=>{\n\n\n\n\t\t// \t(code == '00') &&\n\t\t// \t(()=>{\n\t\t// \t\tthis.imgs.push(obj);\n\n\t\t// \t})()\n\n\t\t// \tif(typeof this.uploadImg != 'undefined'){\n\t\t// \t    this.$emit('update:uploadImg',this.imgs.join(','));\n\n\t\t// \t    this.key++;\n\t\t// \t}\n\n\t\t// })\n\t},\n\tgetExt:function(name){\n\t\tvar tmp = name.split('.');\n\n\t\treturn tmp[tmp.length-1];\n\t},\n\tcut:function(file,fileName,fileType){\n\n\t\tlet reader = new FileReader();\n\t    reader.onload =  (evt)=> {\n\t      var base64 = evt.target.result\n\t\t      this.imgUrl = base64;\n\t\t      this.fileName = fileName;\n\t\t      this.fileType = fileType;\n              this.isShow = true;\n\t    };\n\t    reader.readAsDataURL(file);  \n\n\t},\n\t// taskId 任务 ID 索引\n\t// chunk 当前 第 N 块\n\t// size 上传文件块大小\n\t// totalChunk 总文件 块数 \n\t// totalSize 文件总大小 \n\t// chunkFile 文件块对象 \n\t//  fileType 文件类型 后缀名\n\t//  snapshotFlag  是否生成快照(视频类型专用)\n\t// saveType  文件保存路径（oss 、local）\n\t// module 文件归属模块 (默认 others)\n\tinitStep:function(file,fileName){\n\t\tconsole.log('initStep');\n\t\tthis.file = file;\n\t\tthis.taskId =(new Date()).getTime()+''+parseInt(Math.random()*10000000);\n\n\t\tthis.chunks = Math.ceil(this.file.size / this.chunkSize);\n\n\n\t\tconsole.log(this.taskId,this.file.size,this.chunks,this.chunkSize);\n\n\t\t// return false;\n\n\t\tthis.fileReader.onload = e => {\n\t\t\tconsole.log(e.target.result);\n\t\t\t// this.spark.append(e.target.result); // Append array buffer\n            this.currentChunk++;\n            if (this.currentChunk < this.chunks) {\n                this.loadNext();\n            } else {\n\n            \tconsole.log('片分完了');\n            \tconsole.log(this.tmpDataList);\n                // this.identifier = this.spark.end(); //文件的MD5身份标识\n                this.tmpDataList.map((el, i) => {\n                    // let formData = new FormData();\n\n\n                    // formData.append(\"fileType\", this.getExt(this.file.name));\n                    // formData.append(\"totalSize\", this.file.size);\n                    // formData.append(\"taskId\", el.taskId);\n                    // formData.append(\"totalChunk\", this.chunks);\n                    // formData.append(\"chunkFile\", el.file);\n                    // formData.append(\"chunk\", el.currentNum + 1);\n\n\n                    // this.formDataList.push(formData);\n\n                    this.formDataList.push({\n                    \t    \"fileType\": this.getExt(fileName),\n\t                        \"totalSize\": this.file.size,\n\t                        \"taskId\": el.taskId,\n\t                        \"totalChunk\": this.chunks,\n\t                        \"file\": el.file,\n\t                        \"size\": el.currentSize,\n\t                        // \"chunk\": (el.currentNum + 1)\n\t                        \"chunk\": this.formDataList.length,\n\t                        'snapshotFlag':this.snapshotFlag,\n\t                        'saveType':this.saveType,\n\t                        'module':'video'\n\n                    });\n\n\n\n                });\n\n\n                console.log('生成多个formData表单');\n                console.log(this.formDataList);\n\n                this.formDataList.length >0 &&\n                // this.upload();\n                this.uploadByStep(0);\n\n\n\n                // this.checkMd5();\n            }\n\t\t}\n\t\t this.fileReader.onerror = function() {\n            this.$Message.error(\"读取文件出错，请重试\");\n        };\n        this.loadNext();\n\t\t// this.fileReader.readAsArrayBuffer(file.raw);\n\n\t},\n\n\n\neqScale:function(imgObj){\n\n\nvar _this = this;\nreturn new Promise((resolve,reject)=>{\n\n\nlet reader = new FileReader();\n\t\t    reader.onload =  (evt)=> {\n\t\t        var img = new Image();\n\t\t\t\timg.onload = function(){\n\t\t\t\t\tconsole.log(this.width);\n\t\t\t\t\tconsole.log(this.height);\n\n\t\t\t\t\tlet n = _this.fixedNumber.split(\":\"); \n\t\t\t\t\tlet rate1 = n[0]/n[1];\n\t\t\t\t\tlet rate2 = this.width/this.height;\n\t\t\t\t\tif(parseInt(rate1*100) == parseInt(rate2*100)){\n\t\t\t\t\t\tresolve('0')\n\t\t\t\t\t}else{\n\t\t\t\t\t\tresolve('1')\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\timg.src = evt.target.result\n\n\t\t    };\n\t\t    reader.readAsDataURL(imgObj);  \n\n\t\t})\n\n\n\t},\n\tfileChange:function(file){\n\n\n\t\tif(!this.isCut){\n\n\t\t\tthis.initStep(file,file.name);\n\n\t\t}else{\n\n\t\t\tconsole.log(file);\n\n\n\nthis.eqScale(file).then(res=>{\n\n\nif(res == '0'){\nconsole.log('直接上传')\nthis.initStep(file,file.name);\n\n\n}else{\n\t\t\t\t\tthis.cut(file,file.name,file.type);\n\n\t\t\t\t}\n\n\t\t\t})\n\n\t\t\t//this.cut(file,file.name,file.type);\n\n\t\t}\n\t},\n\tuploadByStep(num){\n\n\t\tthis.percent = parseInt((num/this.chunks)*100);\n\n\t\tthis.uploadingChunk = num;\n\n\t\tthis.$postWithFile('/admin/system/cutFileUpload',this.formDataList[this.uploadingChunk]).then(({code,obj})=>{\n\t\t\tif(code == '00'){\n\n\t\t\t\tif(this.uploadingChunk < (this.formDataList.length-1)){\n\n\t\t\t\t\t\tnum++;\n\t\t\t\t\t\tthis.uploadByStep(num); \n\t\t\t\t\t\t \n\t\t\t\t}else{\n\n\t\t\t\t\tthis.percent = 100;\n\n\n\t\t\t\t\tconsole.log('上传完成了');\n\t\t\t\t\t// this.$refs.upload.clearFiles();\n\t\t\t\t\tthis.key++;\n\n\t\t\t\t\tif(this.maxNum == 1){\n\t\t\t\t\t\tthis.imgs = [obj];\n\t\t\t\t\t}else if(this.editIndex != -1){ //编辑某一个图片\n\t\t\t\t\t\tthis.imgs[this.editIndex]  = obj;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tthis.imgs.push(obj); \n\n\t\t\t\t\t}\n\n\t\t\t\t\tif(typeof this.uploadImg != 'undefined'){\n\t\t\t\t\t    this.$emit('update:uploadImg',this.imgs.join(','));\n\t\t\t\t\t}\n\t\t\t\t\tthis.currentChunk = 0;\n\t\t\t\t\tthis.uploadingChunk = 0;\n\t\t\t\t\tthis.start =  0;\n\t\t\t\t\tthis.end = 0;\n\t\t\t\t\tthis.formDataList = [];\n\t\t\t\t\tthis.tmpDataList = [];\n\t\t\t\t\tthis.editIndex = -1;\n\t\t\t\t\tthis.taskId = '';\n\n\t\t\t\t\tsetTimeout(()=>{\n\n\t\t\t\t\t\tthis.percent = 0;\n\n\t\t\t\t\t},2000)\n\n\n\t\t\t\t}\n\n\n\n\t\t\t}\n\t\t})\n\n\t},\n\tupload:function(){\n\t\tvar tmp = [];\n\t\tthis.formDataList.forEach(item=>{\n\t\t\ttmp.push(\n\t\t\t\t\tnew Promise((resolve, reject)=>{\n\t\t\t\t\t\tthis.$postWithFile('/admin/file/cutFileUpload',item).then((code)=>{\n\t\t\t\t\t\t\tif(code == '00'){\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t})\n\n\t\tPromise.all(tmp).then(()=>{ \n\t\t    console.log('callback')\n\n\t\t\tthis.$refs.upload.clearFiles();\n\n\t\t})\n\n\n\t},\n\tloadNext:function(){\n\t\t(this.start = this.currentChunk * this.chunkSize),\n            (this.end =\n                this.start + this.chunkSize >= this.file.size\n                    ? this.file.size\n                    : this.start + this.chunkSize);\n        let pieceFile = this.blobSlice.call(\n            this.file,\n            this.start,\n            this.end\n        );\n\n        console.log(pieceFile);\n\n\n        pieceFile.name = this.file.name;\n        let tmpObj = {\n            file: pieceFile,\n            currentSize: this.end - this.start,\n            currentNum: this.currentChunk,\n            taskId:this.taskId\n        };\n        this.tmpDataList.push(tmpObj);\n        this.fileReader.readAsArrayBuffer(pieceFile);\n\t}\n\n},\nmounted(){\n\n\tif(typeof this.maxNum !='undefined'){\n\t\tthis.limtNum = this.maxNum;\n\t} \n\n\n},\ncreated(){\n\n\tthis.blobSlice =\n        window.File.prototype.slice ||\n        window.File.prototype.mozSlice ||\n        window.File.prototype.webkitSlice;\n    // this.spark = new SparkMD5.ArrayBuffer();\n    this.fileReader = new FileReader();\n    this.percent = 0;\n\n},\ncomputed:{\n\t// doing:function(){\n\t// \treturn this.index!=-1?this.downing[this.index]:false;\n\t// }\n},\nwatch:{\n\t'uploadImg':{\n\t\thandler:function(v){\n\n\t\t\tif(typeof v !='undefined' && v!=''){\n\n\t\t\t\tif(v.indexOf(',')>-1){  //多个图片\n\t\t\t\t\tthis.imgs = v.split(',');\n\t\t\t\t}else{\n\t\t\t\t\tthis.imgs = [v];\n\t\t\t\t}\n\n\t\t\t}else{\n\t\t\t\tthis.imgs = [];\n\t\t\t}\n\n\t\t},\n\t\timmediate:true\n\t},\n\t'isDown':{\n\t\thandler:function(v){\n\t\t\tif(typeof v !='undefined'){\n\t\t\t\tthis.showDown = v;\n\t\t\t}\n\t\t},\n\t\timmediate:true\n\t},\n\t'pieceSize':{\n\t\thandler:function(v){\n\t\t\tconsole.log(typeof v);\n\t\t\tif(typeof v !='undefined'){\n\n\t\t\t\tif(v <=1024000){\n\t\t\t\t\tthis.chunkSize = 1024000\n\t\t\t\t}else{\n\t\t\t\t\tthis.chunkSize = v;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tthis.chunkSize = 1024000\n\t\t\t}\n\n\t\t},\n\t\timmediate:true\n\t},\n\t'isCut':{\n\t\thandler:function(v){\n\t\t\tif(typeof v !='undefined'){\n\t\t\t\tthis.isCut = v;\n\t\t\t}\n\t\t},\n\t\timmediate:true\n\t},\n\t'isShow':function(v){\n\t\tif(!v){\n\t\t\t// console.log('需要清空input file');\n\t\t\tthis.key++;\n\t\t}\n\t}\n}\n\n\n}\n\n\n<\/script>\n<style scoped>\n\t.clear:after{\n\t\tcontent: \"\";\n\t\tdisplay: block;\n\t\tclear: both;\n\t\tline-height: 0;\n\t\tfont-size: 0;\n\t\theight: 0;\n\t}\n\t.item{\n\t\tposition: relative;\n\t\tfloat: left;\n\t\twidth: 100px;\n\t\theight: 100px;\n\n\n-webkit-transform-origin: left top;\n-moz-transform-origin: left top;\n-ms-transform-origin: left top;\n-o-transform-origin: left top;\ntransform-origin: left top;\n-webkit-transform: scale(0.9);\n-ms-transform: scale(0.9);\n-o-transform: scale(0.9);\ntransform: scale(0.9);\n}\n.item:after{\ncontent: \"\";\ndisplay: block;\n\n\nmargin-top:100%;\n\n\n}\n.up{\nbox-sizing:border-box;\nborder:dashed #c3c3c3 1px;\nbackground: #fff;\nborder-radius: 4px;\nbackground-size: cover !important;\n\n}\n.up input{\nposition: absolute;\nleft:0;\ntop:0;\nbottom:0;\nwidth: 100%;\nheight:100%;\nopacity: 0;\n}\n.item .el-icon-close{\nposition: absolute;\ntop: 1px;\nright: 1px;\nfont-size: 14px;\nbackground: #FC9153;\ncolor: #fff;\nborder-radius: 15px;\npadding:5px;\ncursor: pointer;\n\n}\n.item .down{\nposition: absolute;\nbottom:0;\nright:0;\nfont-size: 20px;\n/*background: #FC9153;*/\ncolor: #FC9153;\nborder-radius: 15px;\npadding:5px;\ncursor: pointer;\n}\n.el-icon-upload{\nfont-size: 50px;\ncolor: #999\n}\n\n.pro_lay{\nposition: absolute;\nheight: 3px;\nline-height:10px;\nleft:10px;\nright:10px;\nbottom:10px;\nbackground: #c3c3c3;\n}\n.progress{\nposition: absolute;\nleft:0;\ntop:0;\nheight: 3px;\nbackground: #409EFF\n}\n\n\n</style>\n")])])]),e("p",[t._v("CutImg.vue")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('<template>\n\t<div>\n\t\t<el-dialog  :append-to-body="true"\n\t\t    title="图片裁剪"\n\t\t    :visible.sync="show" \n\t\t    @close="close">\n\n\t\t    <div style="height: 400px;">\n\t\t    \t<VueCropper  \n\t\t\t\t  ref="cropper"\n\t\t\t\t  v-bind:img="option.img" \n\t\t\t\t  :outputSize="option.size"\n                :outputType="option.outputType"\n                :info="true"\n                :full="option.full"\n                :canMove="option.canMove"\n                :canMoveBox="option.canMoveBox"\n                :original="option.original"\n                :autoCrop="option.autoCrop"\n                :fixed="option.fixed"\n                :fixedNumber="option.fixedNumber"\n                :centerBox="option.centerBox"\n                :infoTrue="option.infoTrue"\n                :fixedBox="option.fixedBox" \n\t\t\t\t></VueCropper> \n\n\n\t\t    </div>\n\t\t  \n\t\t    <span slot="footer">\n                       <span class="pull-left m-t-10">\n\t\t\t      <i class="iconfont icon-tishi text-warning"></i>\n\n\t\t    \t\t触控板双指上下划动\n\t\t\t\t\t    \t<i class="iconfont icon-shuangzhishangxiahua"></i>\n\t\t\t\t\t    \t或使用鼠标滚轮\n\t\t\t\t\t    \t<i class="iconfont icon-shubiaogunlun-caozuotishi-"></i>\n\t\t\t\t\t    \t可使图片缩放\n\t\t    \t</span>\n\t\t        <el-button size="small" @click="close(\'\')">取 消</el-button>\n\t\t        <el-button size="small" type="primary" @click="cut" :loading="doing" :disabled="doing">确 定</el-button>\n\t\t    </span>\n\t\t</el-dialog>\n\t</div>\n</template>\n<script> \n\timport { VueCropper }  from \'vue-cropper\'\n\n\texport default{\n\t\tcomponents:{\n\t\t\tVueCropper\n\t\t},\n\t\tprops:[\'isShow\',\'imgUrl\',\'callBack\',\'fixedNumber\',\'fileName\',\'fileType\'],\n\t\tdata(){\n\t\t\treturn {\n\t\t\t\tshow:false,\n\t\t\t\toption:{\n\t\t\t\t\timg:\'\',  \n\t\t\t\t\tinfo: true, // 裁剪框的大小信息\n                    outputSize: 1, // 裁剪生成图片的质量\n                    outputType: \'png\', // 裁剪生成图片的格式\n                    canScale: true, // 图片是否允许滚轮缩放\n                    autoCrop: true, // 是否默认生成截图框\n                    autoCropWidth: 600, // 默认生成截图框宽度\n                    autoCropHeight: 800, // 默认生成截图框高度\n                    fixedBox: false, // 固定截图框大小 不允许改变\n                    fixed: true, // 是否开启截图框宽高固定比例\n                    fixedNumber: [3, 4], // 截图框的宽高比例\n                    full: true, // 是否输出原图比例的截图\n                    canMoveBox: true, // 截图框能否拖动\n                    original: false, // 上传图片按照原始比例渲染\n                    high: true,\n                    centerBox: false, // 截图框是否被限制在图片里面\n                    infoTrue: true // true 为展示真实输出图片宽高 false 展示看到的截图框宽高\n\n\t\t\t\t},\n\t\t\t\tdoing:false,\n\t\t\t\tfileType:\'image/png\',\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tclose:function(url=\'\'){\n\t\t\t\t// this.callBack && this.callBack(url);\n\t\t\t\tthis.$emit(\'update:isShow\',false);\n\n\t\t\t},\n\t\t\t// 将base64的图片转换为file文件\n\t        convertBase64UrlToBlob(urlData) {\n\t            let bytes = window.atob(urlData.split(\',\')[1]);//去掉url的头，并转换为byte\n\t            //处理异常,将ascii码小于0的转换为大于0\n\t            let ab = new ArrayBuffer(bytes.length);\n\t            let ia = new Uint8Array(ab);\n\t            for (var i = 0; i < bytes.length; i++) {\n\t                ia[i] = bytes.charCodeAt(i);\n\t            }\n\t            return new Blob([ab], { type: this.fileType });\n\t        }, \n\t\t\tcut:function(){\n\t\t\t\tif(this.doing){\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tthis.doing = true;\n \n\t\t\t\t\t\tthis.$refs.cropper.getCropData((data) => { \n\n\t\t\t\t\t\t\tconsole.log(this.convertBase64UrlToBlob(data));\n\n\t\t\t\t\t\t\tthis.callBack && this.callBack(this.convertBase64UrlToBlob(data),this.fileName);\n\t\t\t\t\t\t\tthis.$emit(\'update:isShow\',false);\n\n\n\t\t\t\t\t\t\t// this.$postWithFile(\'/system/base64UploadFile\',{file:data.replace(\'data:image/png;base64,\',\'\')}).then(({code,obj})=>{\n\n\t\t\t\t\t\t\t// \tif(code == \'00\'){\n\n\t\t\t\t\t\t\t// \t\tthis.$message({\n\t\t\t\t\t\t\t// \t\t\tmessage:\'上传成功！\',\n\t\t\t\t\t\t\t// \t\t\ttype:\'success\'\n\t\t\t\t\t\t\t// \t\t})\n\n\t\t\t\t\t\t\t// \t\t// this.close(obj);\n\n\t\t\t\t\t\t\t// \t\tthis.callBack && this.callBack(obj);\n\n\t\t\t\t\t\t\t// \t\tthis.$emit(\'update:isShow\',false);\n\n\t\t\t\t\t\t\t// \t\tsetTimeout(()=>{\n\n\t\t\t\t\t\t\t// \t\t\tthis.doing = false;\n\n\t\t\t\t\t\t\t// \t\t},2000);\n\n\n\n\n\t\t\t\t\t\t\t// \t}\n\n\n\t\t\t\t\t\t\t// })\n\n\t\t\t\t\t\t})\n \n\n\t\t\t}\n\t\t\t \n\t\t},\n\t\tmounted(){\n\n\t\t},\n\t\tcreated(){\n\n\t\t},\n\t\tcomputed:{\n\n\t\t},\n\t\twatch:{\n\t\t\tisShow:{\n\t\t\t\thandler:function(v){ \n\t\t\t\t\tthis.option = {\n\t\t\t\t\t\t\t\t...this.option,\n\t\t\t\t\t\t\t\t...{img:this.imgUrl}\n\t\t\t\t\t\t\t}\n\t\t\t\t\tthis.show = v;\n\t\t\t\t},\n\t\t\t\timmediate:true\n\n\t\t\t},\n\t\t\tfixedNumber:{\n\t\t\t\thandler:function(v){\n\t\t\t\t\tif(v){\n\t\t\t\t\t\tthis.option.fixedNumber = v.split(\':\');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\timmediate:true\n\t\t\t}\n\n\t\t}\n\t}\n\n<\/script>\n<style scoped>\n\n</style>\n')])])]),e("backTop")],1)}),[],!1,null,null,null);n.default=s.exports}}]);