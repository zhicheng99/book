(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{388:function(n,t,e){"use strict";e.r(t);var i=e(10),a=Object(i.a)({},(function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"小程序图片显示自定义组件-imgshow"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序图片显示自定义组件-imgshow"}},[n._v("#")]),n._v(" 小程序图片显示自定义组件 imgShow")]),n._v(" "),e("p",[e("img",{attrs:{src:"Public/upload/2020-06-30/202006301936090857.png",alt:"5efb23a77a504.png"}})]),n._v(" "),e("blockquote",[e("p",[n._v("为了解决小程图片 缩放后宽度或高度如果超过容器不居中显示的问题")])]),n._v(" "),e("p",[n._v("imgShow.js")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("// pages/components/imgShow/imgShow.js\nComponent({\n  /**\n   * 组件的属性列表\n   * 为了解决小程序图片 缩放后宽度或高度超过容器不居中显示的问题\n   */\n  properties: {\n      areaHeight:{  //显示区域高度  可以设置百分比 也可以设置确切的数字\n        type:String,\n        value:'60%',\n        observer: 'init'\n      },\n      imgUrl:{\n        type:String,\n        value:'',\n        observer:'iInit'\n      },\n      imgMode:{\n        type:String,\n        value:'heighFix',\n        observer:'mInit'\n      }\n  },\n\n  /**\n   * 组件的初始数据\n   */\n  data: {\n    id:'',\n    holderPadding:'60%',\n    imgShowH:'',\n    img:{},\n\n    /*两种模式 \n    ‘heightFix’:高全部显示(撑满区域高度) 宽等比缩放  图片居中显示 （横向可能有裁剪）\n    'widthFix':宽全部显示（撑满区域高度）高等比缩放 图片居中显示（竖向可能有裁剪）\n    */\n    mode:'heighFix',\n    styleAttr:{},\n\n    finished:false\n  },\n\n  /**\n   * 组件的方法列表\n   */\n  methods: {\n    loaded:function(v){\n      console.log(v);\n      this.setData({\n        img:v.detail\n      })\n\n      this.reset();\n    },\n    reset:function(){\n        //创建节点选择器\n        var query = wx.createSelectorQuery().in(this); \n\n\n        query.select('#imgShow_'+this.data.id).boundingClientRect((rect)=>{\n          console.log(rect);\n\n          //开始缩放图片 单位是px\n          var layH = rect.height;\n          var layW = rect.width; \n\n          console.log(this.data.mode);\n\n          if(this.data.mode == 'heighFix'){\n             var rate = layH/this.data.img.height;\n             console.log(rate); \n             this.setData({\n              styleAttr:{\n                height:layH,\n                width:this.data.img.width*rate,\n                top:0,\n                left:this.data.img.width*rate>layW?(layW-this.data.img.width*rate)*0.5:0\n              }\n             })\n          }else{\n\n            var rate = layW/this.data.img.width;\n            console.log(rate); \n            this.setData({\n             styleAttr:{\n               height:this.data.img.height*rate,\n               width:layW,\n               top:this.data.img.height*rate>layH?(layH-this.data.img.height*rate)*0.5:0,\n               left:0\n             }\n            })\n          }\n\n\n          this.setData({\n            finished:true\n          })\n      \n        }).exec(); \n\n    },\n    mInit:function(v){\n      if(v){\n        this.setData({\n          mode:v\n        })\n      }\n\n      console.log(this.data.mode);\n\n    },\n    init:function(v){\n      console.log(v);\n      if(v.indexOf('%')>-1){  //按百分比\n\n        this.setData({\n          holderPadding:v\n        })\n\n        console.log(this.data.holderPadding);\n\n      }else{  //固定数值 按rpx单元\n        this.setData({\n          imgShowH:v+'rpx',\n          holderPadding:'0'\n        })\n      }\n \n    }\n  },\n  attached() {  //在组件完全初始化完毕\n    this.setData({\n      id:parseInt(Math.random()*10000)\n    })\n    // setTimeout(()=>{\n    //   this.reset();\n\n    // },200);\n\n  \n  }\n})\n\n")])])]),e("p",[n._v("imgShow.wxml"),e("view",{staticClass:"imgShow",staticStyle:{height:"{{imgShowH}}"},attrs:{id:"imgShow_{{id}}"}})]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<view id="imgShow_{{id}}" class="imgShow" style="height:{{imgShowH}}">\n  <view class="imgShow_holder" style="padding-top:{{holderPadding}}"></view>\n  <view class="imgShow_lay">\n      <view>\n      <i class="fa fa-spinner fa-spin" wx:if="{{!finished}}"></i>\n      </view>\n\n        <image bindload="loaded" src="{{imgUrl}}" style="width:{{styleAttr.width}}px;height:{{styleAttr.height}}px;margin-left:{{styleAttr.left}}px;margin-top:{{styleAttr.top}}px;opacity:{{!finished?0:\'\'}}"/>\n\n  </view>\n</view>\n')])])]),e("p",[n._v("imgShow.wsxx")]),n._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('@import "../../../font.wxss";\n@import "../../../public.wxss";\n\n.imgShow{\n  position: relative;\n  width: 100%;\n  overflow: hidden;\n}\n\n.imgShow_lay{\n  position: absolute;\n  width: 100%;\n  height:100%;\n  left:0;\n  top:0;\n  bottom: 0;\n  text-align: center;\n}\n.imgShow_lay image{\n  height: 100%;\n}\n\n.imgShow_lay i{\n  display: inline-block;\n  background: none !important;\n}\n')])])]),e("backTop")],1)}),[],!1,null,null,null);t.default=a.exports}}]);