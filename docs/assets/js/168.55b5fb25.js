(window.webpackJsonp=window.webpackJsonp||[]).push([[168],{444:function(t,s,a){"use strict";a.r(s);var n=a(10),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"解决子目录布署-vue-应用-nginx-访问报-404-的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决子目录布署-vue-应用-nginx-访问报-404-的问题"}},[t._v("#")]),t._v(" 解决子目录布署 vue 应用 nginx 访问报 404 的问题")]),t._v(" "),a("p",[t._v("以往部署 vuejs 应用都是直接在 nginx 的 location 为/下直接部署，这次遇到要将 vue 应用部署在/vuejs-admin 的非根下，使用以往部署方案直接访问就会 404，这时修改步骤如下：")]),t._v(" "),a("ol",[a("li",[t._v("修改项目 router 配置，如下：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"Public/upload/20200331/15856543378.png",alt:""}})]),t._v(" "),a("p",[t._v("这里一是要修改 router 模式为 history，另一个就是修改 base 地址为要访问的/vuejs-admin 的地址，注意前后都有斜线")]),t._v(" "),a("ol",[a("li",[t._v("修改 build 下静态资源路径前缀")])]),t._v(" "),a("p",[a("img",{attrs:{src:"Public/upload/20200331/15856543372.png",alt:""}})]),t._v(" "),a("p",[t._v("同上一部，这里要修改 assetsPublicPath 为/vuejs-admin/地址")]),t._v(" "),a("ol",[a("li",[t._v("执行 vuejs 打包：npm run build")])]),t._v(" "),a("p",[t._v("确保打包后所有静态资源均是相对地址/vuejs-admin 开头，比如：\n"),a("img",{attrs:{src:"Public/upload/20200331/15856543388.png",alt:""}})]),t._v(" "),a("ol",[a("li",[t._v("修改 nginx 配置，使用 rewrite 配置")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\tlisten       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\tserver_name  xxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \t\t#charset koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \t\t#access_log  logs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\tlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vuejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \t\t\tproxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vuejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t\tlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vuejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("admin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\talias "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("server"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("webapps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("vuejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   \t\t\t#index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\ttry_files $uri $uri"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" @rewrites"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \t\t\n\t\t location @rewrites "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t                rewrite "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vuejs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html last"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t\terror_page   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\tlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \t\t\troot   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n")])])]),a("ol",[a("li",[t._v("热重载 nginx，搞定收工：nginx -s reload")])]),t._v(" "),a("p",[t._v("文章来源：https://www.cnblogs.com/vipzhou/p/9255552.html")]),t._v(" "),a("backTop")],1)}),[],!1,null,null,null);s.default=r.exports}}]);