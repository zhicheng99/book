<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一种对开发更友好的前端骨架屏自动生成方案 | 日常收集</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/book/assets/css/0.styles.0575b83d.css" as="style"><link rel="preload" href="/book/assets/js/app.c8cf2c2d.js" as="script"><link rel="preload" href="/book/assets/js/3.0d5fb1e8.js" as="script"><link rel="preload" href="/book/assets/js/154.e1f55cec.js" as="script"><link rel="preload" href="/book/assets/js/4.4c5f7830.js" as="script"><link rel="prefetch" href="/book/assets/js/10.b7e4165a.js"><link rel="prefetch" href="/book/assets/js/100.ff8b475f.js"><link rel="prefetch" href="/book/assets/js/101.19bef30c.js"><link rel="prefetch" href="/book/assets/js/102.9f2e224b.js"><link rel="prefetch" href="/book/assets/js/103.6dd6e411.js"><link rel="prefetch" href="/book/assets/js/104.29cb43a7.js"><link rel="prefetch" href="/book/assets/js/105.bea4dd2d.js"><link rel="prefetch" href="/book/assets/js/106.5a045c6a.js"><link rel="prefetch" href="/book/assets/js/107.24dfb0a1.js"><link rel="prefetch" href="/book/assets/js/108.faf80b69.js"><link rel="prefetch" href="/book/assets/js/109.c40b51b2.js"><link rel="prefetch" href="/book/assets/js/11.44217601.js"><link rel="prefetch" href="/book/assets/js/110.0ad5bafa.js"><link rel="prefetch" href="/book/assets/js/111.c85d723e.js"><link rel="prefetch" href="/book/assets/js/112.b8d99964.js"><link rel="prefetch" href="/book/assets/js/113.7b01d741.js"><link rel="prefetch" href="/book/assets/js/114.40924aed.js"><link rel="prefetch" href="/book/assets/js/115.73705314.js"><link rel="prefetch" href="/book/assets/js/116.2722c552.js"><link rel="prefetch" href="/book/assets/js/117.d5ea400e.js"><link rel="prefetch" href="/book/assets/js/118.8f552084.js"><link rel="prefetch" href="/book/assets/js/119.05f11ec8.js"><link rel="prefetch" href="/book/assets/js/12.571f12ac.js"><link rel="prefetch" href="/book/assets/js/120.7ac63c38.js"><link rel="prefetch" href="/book/assets/js/121.addba4bc.js"><link rel="prefetch" href="/book/assets/js/122.e36ab092.js"><link rel="prefetch" href="/book/assets/js/123.f768b115.js"><link rel="prefetch" href="/book/assets/js/124.88cc6bb2.js"><link rel="prefetch" href="/book/assets/js/125.3086a6c7.js"><link rel="prefetch" href="/book/assets/js/126.8685f3d1.js"><link rel="prefetch" href="/book/assets/js/127.a2e54fa3.js"><link rel="prefetch" href="/book/assets/js/128.05dd1ef5.js"><link rel="prefetch" href="/book/assets/js/129.8d61cdc3.js"><link rel="prefetch" href="/book/assets/js/13.94f0d951.js"><link rel="prefetch" href="/book/assets/js/130.6894001e.js"><link rel="prefetch" href="/book/assets/js/131.3b56b34d.js"><link rel="prefetch" href="/book/assets/js/132.de4f4a7c.js"><link rel="prefetch" href="/book/assets/js/133.f22a0818.js"><link rel="prefetch" href="/book/assets/js/134.39fc556b.js"><link rel="prefetch" href="/book/assets/js/135.674da456.js"><link rel="prefetch" href="/book/assets/js/136.33860124.js"><link rel="prefetch" href="/book/assets/js/137.2c19d3fa.js"><link rel="prefetch" href="/book/assets/js/138.c402dab0.js"><link rel="prefetch" href="/book/assets/js/139.5e82f303.js"><link rel="prefetch" href="/book/assets/js/14.3d533f57.js"><link rel="prefetch" href="/book/assets/js/140.62e0cb58.js"><link rel="prefetch" href="/book/assets/js/141.fa154467.js"><link rel="prefetch" href="/book/assets/js/142.778347a5.js"><link rel="prefetch" href="/book/assets/js/143.9c54f61b.js"><link rel="prefetch" href="/book/assets/js/144.662af319.js"><link rel="prefetch" href="/book/assets/js/145.5944e1fc.js"><link rel="prefetch" href="/book/assets/js/146.fd43269d.js"><link rel="prefetch" href="/book/assets/js/147.c84266c4.js"><link rel="prefetch" href="/book/assets/js/148.dbc94a8a.js"><link rel="prefetch" href="/book/assets/js/149.b9372d26.js"><link rel="prefetch" href="/book/assets/js/15.281fe50b.js"><link rel="prefetch" href="/book/assets/js/150.37570d27.js"><link rel="prefetch" href="/book/assets/js/151.d1827480.js"><link rel="prefetch" href="/book/assets/js/152.fbcaf5cb.js"><link rel="prefetch" href="/book/assets/js/153.3776cdba.js"><link rel="prefetch" href="/book/assets/js/155.4669a8c6.js"><link rel="prefetch" href="/book/assets/js/156.458405bf.js"><link rel="prefetch" href="/book/assets/js/157.d95c27d1.js"><link rel="prefetch" href="/book/assets/js/158.e0bc050f.js"><link rel="prefetch" href="/book/assets/js/159.143f4e35.js"><link rel="prefetch" href="/book/assets/js/16.c05e6974.js"><link rel="prefetch" href="/book/assets/js/160.5ab2a46a.js"><link rel="prefetch" href="/book/assets/js/161.24b0ff2e.js"><link rel="prefetch" href="/book/assets/js/162.ae6079c0.js"><link rel="prefetch" href="/book/assets/js/163.137cde9d.js"><link rel="prefetch" href="/book/assets/js/164.b805d4a1.js"><link rel="prefetch" href="/book/assets/js/165.31686672.js"><link rel="prefetch" href="/book/assets/js/166.fb140ab0.js"><link rel="prefetch" href="/book/assets/js/167.f41765a0.js"><link rel="prefetch" href="/book/assets/js/168.0573b984.js"><link rel="prefetch" href="/book/assets/js/169.6877c1df.js"><link rel="prefetch" href="/book/assets/js/17.98e34aaf.js"><link rel="prefetch" href="/book/assets/js/170.948c455c.js"><link rel="prefetch" href="/book/assets/js/18.51ea57a3.js"><link rel="prefetch" href="/book/assets/js/19.8ba7ecb7.js"><link rel="prefetch" href="/book/assets/js/20.428d3741.js"><link rel="prefetch" href="/book/assets/js/21.6229732b.js"><link rel="prefetch" href="/book/assets/js/22.aaf4eec1.js"><link rel="prefetch" href="/book/assets/js/23.3c002936.js"><link rel="prefetch" href="/book/assets/js/24.bd9616e3.js"><link rel="prefetch" href="/book/assets/js/25.13ac73ab.js"><link rel="prefetch" href="/book/assets/js/26.87ee90df.js"><link rel="prefetch" href="/book/assets/js/27.2e41022a.js"><link rel="prefetch" href="/book/assets/js/28.47dbd3dd.js"><link rel="prefetch" href="/book/assets/js/29.f9a72fbb.js"><link rel="prefetch" href="/book/assets/js/30.f25cdd9c.js"><link rel="prefetch" href="/book/assets/js/31.efc3f08d.js"><link rel="prefetch" href="/book/assets/js/32.5dcd7f59.js"><link rel="prefetch" href="/book/assets/js/33.8760ca3a.js"><link rel="prefetch" href="/book/assets/js/34.fa9fc2e4.js"><link rel="prefetch" href="/book/assets/js/35.b1a81b64.js"><link rel="prefetch" href="/book/assets/js/36.dcb0e8e4.js"><link rel="prefetch" href="/book/assets/js/37.f208f46d.js"><link rel="prefetch" href="/book/assets/js/38.749c6353.js"><link rel="prefetch" href="/book/assets/js/39.c79b7b8d.js"><link rel="prefetch" href="/book/assets/js/40.e57f0567.js"><link rel="prefetch" href="/book/assets/js/41.b7de65dc.js"><link rel="prefetch" href="/book/assets/js/42.a4199118.js"><link rel="prefetch" href="/book/assets/js/43.29627dcd.js"><link rel="prefetch" href="/book/assets/js/44.4fd40982.js"><link rel="prefetch" href="/book/assets/js/45.f9ca9392.js"><link rel="prefetch" href="/book/assets/js/46.224d749a.js"><link rel="prefetch" href="/book/assets/js/47.46212b48.js"><link rel="prefetch" href="/book/assets/js/48.b4530c84.js"><link rel="prefetch" href="/book/assets/js/49.c5ce825f.js"><link rel="prefetch" href="/book/assets/js/5.eefbb6d1.js"><link rel="prefetch" href="/book/assets/js/50.abb4615c.js"><link rel="prefetch" href="/book/assets/js/51.2bad13e4.js"><link rel="prefetch" href="/book/assets/js/52.a281d464.js"><link rel="prefetch" href="/book/assets/js/53.d932d947.js"><link rel="prefetch" href="/book/assets/js/54.14345852.js"><link rel="prefetch" href="/book/assets/js/55.3188a009.js"><link rel="prefetch" href="/book/assets/js/56.e16829eb.js"><link rel="prefetch" href="/book/assets/js/57.53dea087.js"><link rel="prefetch" href="/book/assets/js/58.538898c1.js"><link rel="prefetch" href="/book/assets/js/59.b7d7c110.js"><link rel="prefetch" href="/book/assets/js/6.18aff54a.js"><link rel="prefetch" href="/book/assets/js/60.1e7dcd20.js"><link rel="prefetch" href="/book/assets/js/61.f13068fe.js"><link rel="prefetch" href="/book/assets/js/62.0a4e1149.js"><link rel="prefetch" href="/book/assets/js/63.431914ad.js"><link rel="prefetch" href="/book/assets/js/64.df81dce3.js"><link rel="prefetch" href="/book/assets/js/65.6143b870.js"><link rel="prefetch" href="/book/assets/js/66.f9abed3f.js"><link rel="prefetch" href="/book/assets/js/67.3397cfbe.js"><link rel="prefetch" href="/book/assets/js/68.bf72bbf4.js"><link rel="prefetch" href="/book/assets/js/69.e3a5531b.js"><link rel="prefetch" href="/book/assets/js/7.637d308b.js"><link rel="prefetch" href="/book/assets/js/70.e3c80238.js"><link rel="prefetch" href="/book/assets/js/71.e0711aa7.js"><link rel="prefetch" href="/book/assets/js/72.13845c1b.js"><link rel="prefetch" href="/book/assets/js/73.a982a8ed.js"><link rel="prefetch" href="/book/assets/js/74.22bbccf1.js"><link rel="prefetch" href="/book/assets/js/75.d22833f1.js"><link rel="prefetch" href="/book/assets/js/76.6cdfacdd.js"><link rel="prefetch" href="/book/assets/js/77.c715bf8d.js"><link rel="prefetch" href="/book/assets/js/78.c77b50af.js"><link rel="prefetch" href="/book/assets/js/79.2f968e4e.js"><link rel="prefetch" href="/book/assets/js/8.3201113b.js"><link rel="prefetch" href="/book/assets/js/80.5e7ab955.js"><link rel="prefetch" href="/book/assets/js/81.2e117c7b.js"><link rel="prefetch" href="/book/assets/js/82.1f9856a9.js"><link rel="prefetch" href="/book/assets/js/83.22728db6.js"><link rel="prefetch" href="/book/assets/js/84.c28a521e.js"><link rel="prefetch" href="/book/assets/js/85.473f6b95.js"><link rel="prefetch" href="/book/assets/js/86.e4b6adfa.js"><link rel="prefetch" href="/book/assets/js/87.d46fb7cf.js"><link rel="prefetch" href="/book/assets/js/88.18a2b0e0.js"><link rel="prefetch" href="/book/assets/js/89.9ee67c4a.js"><link rel="prefetch" href="/book/assets/js/9.5cf4899a.js"><link rel="prefetch" href="/book/assets/js/90.3b188a59.js"><link rel="prefetch" href="/book/assets/js/91.e8768301.js"><link rel="prefetch" href="/book/assets/js/92.19241f7a.js"><link rel="prefetch" href="/book/assets/js/93.bc96ef51.js"><link rel="prefetch" href="/book/assets/js/94.dd590ff1.js"><link rel="prefetch" href="/book/assets/js/95.884ed018.js"><link rel="prefetch" href="/book/assets/js/96.a5548eaf.js"><link rel="prefetch" href="/book/assets/js/97.f5d876cb.js"><link rel="prefetch" href="/book/assets/js/98.5f912987.js"><link rel="prefetch" href="/book/assets/js/99.a74b7e4e.js"><link rel="prefetch" href="/book/assets/js/vendors~docsearch.c8693219.js">
    <link rel="stylesheet" href="/book/assets/css/0.styles.0575b83d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/book/" class="home-link router-link-active"><!----> <span class="site-name">日常收集</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>dom的事件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Javascript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/book/363.html" class="sidebar-link"> 让 JavaScript 在 WebAssembly 上加速运行！</a></li><li><a href="/book/361.html" class="sidebar-link"> 《程序员数学：位运算》——如何使用二进制计算乘法？</a></li><li><a href="/book/360.html" class="sidebar-link"> 速记：一个http请求的全过程是怎样的？</a></li><li><a href="/book/359.html" class="sidebar-link"> 万字扫盲ByteBuffer</a></li><li><a href="/book/338.html" class="sidebar-link"> JS异步编程——WebWorker多线程机制</a></li><li><a href="/book/337.html" class="sidebar-link">js</a></li><li><a href="/book/336.html" class="sidebar-link"> [核心概念] 一文说透JS中的原型和继承(上)</a></li><li><a href="/book/335.html" class="sidebar-link"> [关联概念] 一文说透 JS 中的变量提升</a></li><li><a href="/book/334.html" class="sidebar-link"> [核心概念] 一文说透浏览器环境下的JS运行机制</a></li><li><a href="/book/333.html" class="sidebar-link"> [核心概念] 一文说透JS中的函数柯里化(Currying)</a></li><li><a href="/book/332.html" class="sidebar-link"> [核心概念] 一文说透 JS 中 this 的基本概念</a></li><li><a href="/book/331.html" class="sidebar-link"> [核心概念] 一文说透 JS 的作用域（scope）</a></li><li><a href="/book/330.html" class="sidebar-link"> [核心概念] 一文说透 JS 中的闭包（closure）</a></li><li><a href="/book/329.html" class="sidebar-link"> [核心概念] 一文说透 JS 中的执行上下文</a></li><li><a href="/book/268.html" class="sidebar-link"> 「硬核JS」你真的了解垃圾回收机制吗</a></li><li><a href="/book/262.html" class="sidebar-link"> 「硬核JS」你的程序中可能存在内存泄漏</a></li><li><a href="/book/229.html" class="sidebar-link"> 聊聊JS的二进制家族：Blob、ArrayBuffer和Buffer</a></li><li><a href="/book/226.html" class="sidebar-link"> `Object.defineProperty()详解`</a></li><li><a href="/book/180.html" class="sidebar-link">yield是什么</a></li><li><a href="/book/175.html" class="sidebar-link">HTTP请求中，几种常见的Content-Type类型</a></li><li><a href="/book/172.html" class="sidebar-link"> js 给元素添加、删除父标签</a></li><li><a href="/book/171.html" class="sidebar-link"> 多个promise实现</a></li><li><a href="/book/131.html" class="sidebar-link"> Object.defineProperty和Object.defineProperties()</a></li><li><a href="/book/126.html" class="sidebar-link"> scrollHeight,scrollLeft,offsetHeight,offsetLeft</a></li><li><a href="/book/118.html" class="sidebar-link"> 怎样让 forEach 停下来呢；**try catch**</a></li><li><a href="/book/105.html" class="sidebar-link">div拖动的实现</a></li><li><a href="/book/93.html" class="sidebar-link">JavaScript对象之深拷贝和浅拷贝</a></li><li><a href="/book/92.html" class="sidebar-link">base64。js</a></li><li><a href="/book/85.html" class="sidebar-link">你也许不知道的JavaScript高级函数</a></li><li><a href="/book/78.html" class="sidebar-link">ESmodules:Acartoondeep-dive</a></li><li><a href="/book/73.html" class="sidebar-link">setTimeout和setImmediate到底谁先执行，本文让你彻底理解EventLoop</a></li><li><a href="/book/71.html" aria-current="page" class="active sidebar-link">一种对开发更友好的前端骨架屏自动生成方案</a></li><li><a href="/book/68.html" class="sidebar-link">深入理解ESModules(手绘示例)</a></li><li><a href="/book/48.html" class="sidebar-link">系统学习前端之FormData详解</a></li><li><a href="/book/47.html" class="sidebar-link">使用FormData上传文件</a></li><li><a href="/book/46.html" class="sidebar-link">数组排序方法</a></li><li><a href="/book/43.html" class="sidebar-link">利于FileReader实现二进制数据流转JSON</a></li><li><a href="/book/28.html" class="sidebar-link">reduce过滤数组中重复对象</a></li><li><a href="/book/27.html" class="sidebar-link">常用文件类型对应</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>element-ui</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Qcanvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/365.html" class="sidebar-link"> WASM 在动画引擎中的设计优化</a></li><li><a href="/book/364.html" class="sidebar-link"> 你管这破玩意叫指针？</a></li><li><a href="/book/362.html" class="sidebar-link"> 图说 WebAssembly</a></li><li><a href="/book/328.html" class="sidebar-link"> 从哲学层面浅谈计算机学习方法论</a></li><li><a href="/book/324.html" class="sidebar-link"> 微信游览器，解决安卓和ios自动播放音乐</a></li><li><a href="/book/323.html" class="sidebar-link"> CSS3 animation属性中的steps功能符深入介绍</a></li><li><a href="/book/322.html" class="sidebar-link"> 前端搞工程化：从零打造性能检测库「源码 + 视频」</a></li><li><a href="/book/321.html" class="sidebar-link"> 还在看那些老掉牙的性能优化文章么？这些最新性能指标了解下</a></li><li><a href="/book/320.html" class="sidebar-link"> Nginx根据User Agent动态配置root目录适配移动端</a></li><li><a href="/book/307.html" class="sidebar-link"> cat文档内容中搜索字符串输出到文件</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/301.html" class="sidebar-link">从App store下载App的不同版本ipa文件----很多东西也不是越新越好，比如APP——在 iPhone 上尤其如此</a></li><li><a href="/book/294.html" class="sidebar-link">迟子建老师的《一坛猪油》</a></li><li><a href="/book/288.html" class="sidebar-link">文本文档的协同编辑实现</a></li><li><a href="/book/287.html" class="sidebar-link">再见，整洁代码</a></li><li><a href="/book/286.html" class="sidebar-link"> 可以在 Nginx 中运行 JavaScript，厉害了！</a></li><li><a href="/book/284.html" class="sidebar-link"> word中批量调整图片大小</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>electron打包的一些问题</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/274.html" class="sidebar-link"> 文件分片代码</a></li><li><a href="/book/273.html" class="sidebar-link"> 重学 JS：为啥 await 不能用在 forEach 中详解</a></li><li><a href="/book/269.html" class="sidebar-link"> Excel函数之王，Vlookup到底怎么用？</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/248.html" class="sidebar-link"> 《提问的智慧》精读注解版</a></li><li><a href="/book/199.html" class="sidebar-link"> js监听div的resize事件</a></li><li><a href="/book/198.html" class="sidebar-link"> 引入第三方字体体积太大的问题</a></li><li><a href="/book/195.html" class="sidebar-link"> 多行溢出省略号显示（css/js）实现！</a></li><li><a href="/book/190.html" class="sidebar-link">今天带大家一起来看看下，如何实现“划词高亮”功能。</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工作中解决的疑难问题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/book/135.html" class="sidebar-link"> 深夜，我偷听到程序员要对session下手</a></li><li><a href="/book/132.html" class="sidebar-link"> 读 《深入浅出webpack》</a></li><li><a href="/book/103.html" class="sidebar-link"> 一道被人轻视的前端面试题</a></li><li><a href="/book/101.html" class="sidebar-link">部分前端面试题参考答案</a></li><li><a href="/book/80.html" class="sidebar-link">SVGDeveloper制作矢量地图教程详解</a></li><li><a href="/book/76.html" class="sidebar-link">VisualStudio2010创建的WCF（.dll）服务第一个应用</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一种对开发更友好的前端骨架屏自动生成方案"><a href="#一种对开发更友好的前端骨架屏自动生成方案" class="header-anchor">#</a> 一种对开发更友好的前端骨架屏自动生成方案</h1> <p><em><strong>（马蜂窝技术原创内容，公众号 ID：mfwtech）</strong></em></p> <p>一份来自 Akamai 的研究报告显示，在对 1048 名网购户进行采访后发现：</p> <ul><li>约 47% 的用户期望他们的页面在两秒之内加载完成。</li> <li>如果页面加载时间超过 3s，约 40% 的用户会选择离开或关闭页面。</li></ul> <p><img src="Public/upload/20200318/15845021428.jpg" alt="null"></p> <p></p> <p>一直以来，为了提升用户在页面加载时的体验，无论是 Web 还是 iOS、Android 的应用中，前端开发工程师都做了许多工作。除了解决如何让网页展现速度更快的问题，还有很重要的一点就是提升用户对加载等待时间的感知。「菊花图」以及由其衍生出的各种加载动画就是一类常见的解决方案，相信无论是开发者还是用户对下面这个图标都不会陌生：</p> <p><img src="Public/upload/20200318/15845021426.jpg" alt="null"></p> <p></p> <p>本文要介绍的「骨架屏」则被视为菊花图升级版的方案。受现有骨架屏方案的启发，马蜂窝电商前端研发团队实现了一种自动化生成骨架屏的方法，并在马蜂窝商城的多个页面中实现应用，取得了不错的效果。</p> <p></p> <h1 id="一、什么是骨架屏"><a href="#一、什么是骨架屏" class="header-anchor">#</a> 一、什么是骨架屏</h1> <p>骨架屏可以理解为在页面数据尚未返回或页面未完成完全渲染前，先给用户呈现一个由灰白块组成的当前页面大致结构，让用户产生页面正在逐渐渲染的感受，从而使加载过程从视觉上变得流畅。生成后的骨架屏页面如下图所示：</p> <p><img src="Public/upload/20200318/15845021423.jpg" alt="null"></p> <p></p> <p>骨架屏的主要优势为：</p> <ol><li>用户避免看到长时间的白页</li> <li>可以获知页面的大体结构，减小用户认为页面出错而离开的机率</li> <li>与菊花图相比视觉更加流畅</li></ol> <p></p> <h1 id="二、常见的前端骨架屏方案"><a href="#二、常见的前端骨架屏方案" class="header-anchor">#</a> 二、常见的前端骨架屏方案</h1> <p>在选择骨架屏之前，我们也考虑了一些其他的方法，比如能否通过服务端渲染（SSR）的方式来避开前端白屏时间的问题。但发现需要涉及项目过多，还会涉及服务的构建与部署；或是通过 prerender-spa-plugin 提供简单的预呈现，它对 SPA 支持友好，但需要额外的 webpack 配置，且因为包源的问题，下载时间过长，有时还会莫名失败，等等，都因为种种原因最终放弃。</p> <p>经过一系列调研后，我们对业界常见的几种骨架屏解决方案，以及它们的优势、不足进行了一个简单的梳理。</p> <h2 id="_1-ui-骨架屏图"><a href="#_1-ui-骨架屏图" class="header-anchor">#</a> 1. UI 骨架屏图</h2> <p>即通过 UI 提供符合页面首页样式的图来充当骨架屏，将骨架屏 base64 图片插入 root 根节点，在 webpack 打包时嵌入项目中。</p> <p>这是一种简单粗暴的方法，实现起来比较容易。但缺点也很明显，就是需要 UI 设计师支持和开发介入，不能自动生成。</p> <h2 id="_2-手写骨架屏"><a href="#_2-手写骨架屏" class="header-anchor">#</a> 2.  手写骨架屏</h2> <p>即通过手写 HTML、CSS 的方式为目标页定制骨架屏。这种方式可以做到对页面真实样式的复刻。不过一旦由于各种原因导致页面样式发生改变，就需要再改一遍骨架屏的样式和布局，极大增加了维护的成本。</p> <h2 id="_3-自动生成静态骨架屏"><a href="#_3-自动生成静态骨架屏" class="header-anchor">#</a> 3. 自动生成静态骨架屏</h2> <p>目前比较受关注的是饿了么开源的插件 page-skeleton-webpack-plugin，其具体实现原理为：</p> <ul><li><strong>生成骨架屏</strong></li></ul> <p>通过 Puppeteer 操控 handless Chrome 打开需要生成的骨架屏页面，在等待页面加载完成之后，保留页面布局样式的前提下，通过对页面中元素进行增删，对已有元素通过层叠样式进行覆盖，使其展示为灰白块。然后将修改后的 HTML 和 CSS 提取出来，将页面分为不同的块区域，例如文本块、图片块、按钮块、SVG、伪类元素块等，分别对每个块进行处理，使其尽量与原页面保持一致。这里用到了 Puppeteer  page 实例的 addScriptTag 方法来将处理块的脚本插入到 headless Chrome 打开的页面当中。</p> <p>实际生成的骨架屏页面与原页面可能还会存在差距，插件通过 memory-fs 将骨架屏写入内存中，可以通过预览页面对生成的骨架屏进行二次编辑和效果预览，修改完成后点击生成按钮就能生成一份新的骨架屏写入到项目中。</p> <p>借一张图来说明：</p> <p><img src="Public/upload/20200318/15845021438.jpg" alt="null"></p> <p></p> <ul><li><strong>插入骨架屏</strong></li></ul> <p>骨架屏的 DOM 结构和 CSS 通过离线生成后，在构建时注入模板 (EJS) 中的节点下面，插入到 HTML 是在 after-emit 钩子函数中进行。</p> <p>page-skeleton-webpack-plguin 生成骨架屏的方案可以根据项目中不同的路由页面生成相应的骨架屏页面，并将骨架屏页面通过 webpack 打包到对应的静态路由页面中。</p> <p>它的不足之处在于：</p> <ul><li>实际使用过程中无法监听接口返回导致生成骨架屏的时机是否准确</li> <li>生成的页面与业务人员写的结构质量有直接关系，经常出现需要手工二次调整的情况</li></ul> <p>在这样的背景下，马蜂窝电商研发前端团队希望找一种在提升用户体验的同时，对开发更友好的骨架屏生成方式，能针对不同的业务场景自动生成出相似的骨架屏，并且实现自动注入。对于开发而言，只需要执行一条命令，或者简单配置，就可以生成骨架屏，不需要再考虑后续的维护工作。</p> <p>在方案调研过程中，<strong>draw-page-structure</strong> 为我们的设计提供了灵感。</p> <h2 id="_4-draw-page-structure"><a href="#_4-draw-page-structure" class="header-anchor">#</a> 4. draw-page-structure</h2> <ul><li><strong>生成骨架屏：</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>// dps.config.js
{
  url: 'https://baidu.com',
  output: {
    filepath: '/Users/famanoder/DrawPageStructure/example/index.html',
    injectSelector: '#app'
  },
  background: '#eee',
  animation: 'opacity 1s linear infinite;',
  // ...
}

</code></pre></div><p>根据 URL 指定的线上地址，配合 Puppeteer 获取当前页面的 DOM 结构，并对其中元素节点生成骨架屏文件到 filepath 指定的文件里面，就可以生成骨架屏页面，结果如下图所示：</p> <p><img src="Public/upload/20200318/15845021432.jpg" alt="null"></p> <p></p> <ul><li><h3 id="插入骨架屏"><a href="#插入骨架屏" class="header-anchor">#</a> 插入骨架屏</h3></li></ul> <p>将上述生成的骨架屏文件插入到页面根节点下面一般为 id=&quot;app&quot; 的节点，然后在通用工具里提供主动销毁骨架屏的方法，就可以帮助开发主动控制或销毁骨架屏，显示页面真实内容。</p> <p>draw-page-structure 的设计思想很大程度上可以满足我们的需求，不足的是只能对线上已经存在的 URL 生成骨架屏，不支持开发环境。另外由于是自动生成，当页面存在重定向（如果未登录重定向到登录页面）的情况时，生成的骨架屏可能与预期不一致。而且它的内部实现并不完善，可能导致某些结构复杂的页面下生成的骨架屏需要二次优化调整。</p> <p>于是，我们开始了进一步的探索。</p> <p></p> <h1 id="三、对开发更友好的实现方案"><a href="#三、对开发更友好的实现方案" class="header-anchor">#</a> 三、对开发更友好的实现方案</h1> <h2 id="_1-设计思路"><a href="#_1-设计思路" class="header-anchor">#</a> 1. 设计思路</h2> <p>基于对现有方案的借鉴，我们想到了在配置文件中指定要生成骨架屏的页面 URL 和文件输出的目录，运行时读取配置文件中的配置项，通过 Puppeteer 打开指定的页面并注入 evalDom.js 的方法。因为此 JS 是在 Puppeteer 里面执行的，所以可以获取到当前页面完整的 DOM 结构，这给我们留下了非常大的发挥空间。</p> <p>最初我们是从获取到的 DOM 结构中的 body 标签出发，递归去处理页面上的所有节点，处理完成后用生成的 DIV 替换原有元素的位置。第一版方案中通过 getBoundingClientRect 和 getComputedStyle 的方法来获取元素所有计算属性和相对于视口的宽高和位置，然后结合元素本身的样式属性递归渲染，保留页面原始 DOM 嵌套层次。</p> <p>但由于能够决定元素位置的属性实在太多，如 position，z-index、width、height、top、display、box-sizing、flex 等都需要考虑，导致无法聚焦对页面 DOM 结构处理的逻辑，而且这些属性在处理完成后还需要加到最终生成骨架屏节点的 style 上，这样骨架屏文件可能比原来完整的页面结构还大，这肯定不是我们希望的。</p> <p>优化后的方案是用 getBoundingClientRect 和 getComputedStyle 获取元素相关属性，然后直接通过绝对定位的方式来生成最终的骨架屏节点。这样在页面上最终需要的属性主要是 position、z-index、top、left、width、height、background、border-radius。除了无法保证页面原始的 DOM 结构，其它需求基本都可以满足，也更加聚焦于节点的处理。</p> <p>主要实现流程如下图：</p> <p><img src="Public/upload/20200318/15845021436.jpg" alt="null"></p> <p></p> <p>该方案目前主要应用于马蜂窝电商业务的多页面项目中，包括下单页、签证页等，以下单页为例，展示效果如下图：</p> <p><img src="Public/upload/20200318/15845021432.jpg" alt="null"></p> <p></p> <h2 id="_2-实现方式"><a href="#_2-实现方式" class="header-anchor">#</a> 2. 实现方式</h2> <ul><li><strong>生成骨架屏</strong></li></ul> <p><strong>(1) config.js 配置</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const dpsConfig = {
   // 默认生成位置为当前项目目录skeleton文件夹，已有骨架屏页面不会再次生成，新页面配置只需要添加新条目即可
    visa_guide: {
        url: 'https://w.mafengwo.cn/sfe-app/visa_guide.html?mdd_id=10083', // 必填项
    },
    call_charge： {
        url: 'http://localhost:8081/sfe-app/call_charge.html?rights_id=25', // 必填项 待生成骨架屏页面的地址，用百度（https://baidu.com）试试也可以
        //url:'https://www.baidu.com',
        device: 'pc', // 非必填，默认mobile
        background: '#eee', // 非必填
        animation: 'opacity 1s linear infinite;', // 非必填
        headless:false, // 非必填
        customizeElement: function(node) { // 非必填
            //返回值枚举如果是true表示不会向下递归到这层为止，如果返回值是一个对象那么节点的档子就按照对象里面的样式来绘制
            //如果返回值为0表示正常递归渲染
            //如果返回值为1表示渲染当前节点不在向下递归
            //如果返回值为2表示对当前节点不作任何处理
            if(node.className === 'navs-bottom-bar'){
                return 2;
            }
            return 0;
        },
        showInitiativeBtn: true,// 非必填 如果此值设置为true表示开发需要主动触发生成骨架屏了，此时headless需设置为false
        writePageStructure: function(html) { // 非必填
            // 自己处理生成的骨架屏
            // fs.writeFileSync(filepath, html);
            // console.log(html)
        },
        init: function() { // 非必填
            // 生成骨架屏之前的操作，比如删除干扰节点
        }  
    }
}


module.exports = dpsConfig;

</code></pre></div><p><strong>（2）Puppeteer 新打开页面并返回浏览器实例、openPage</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const ppteer = require('puppeteer');
const { log, getAgrType } = require('./utils');
const insertBtn = require('../insertBtn');


const devices = {
  mobile: [375, 667, 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1'],
  ipad: [1024, 1366, 'Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1'],
  pc: [1200, 1000, 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1']
};

async function pp({device = 'mobile', headless = true, showInitiativeBtn = false}) {

  const browser = await ppteer.launch({headless});//返回browser实例

  async function openPage(url, extraHTTPHeaders) {
    const page = await browser.newPage();
    let timeHandle = null;

   if(showInitiativeBtn){
    browser.on('targetchanged', async ()=&gt;{//监听页面路由变化，并获取当前标签页的最新的页面，在showInitiativeBtn为true时插入按钮由开发控制主动生成骨架屏
      const targets = await browser.targets();
      const currentTarget = targets[targets.length - 1]
      const currentPage = await currentTarget.page();

      clearTimeout(timeHandle)
      setTimeout(()=&gt;{
        if(currentPage){
          currentPage.evaluate(insertBtn);
        }
      },300)
    })
   }
    try{
      let deviceSet = devices[device];
      page.setUserAgent(deviceSet[2]);
      page.setViewport({width: deviceSet[0], height: deviceSet[1]});

      if(extraHTTPHeaders &amp;&amp; getAgrType(extraHTTPHeaders) === 'object') {
        await page.setExtraHTTPHeaders(new Map(Object.entries(extraHTTPHeaders)));
      }
      await page.goto(url, {
        waitUntil: 'networkidle0'//不再有网络连接时触发（至少500ms后）
      });
    }catch(e){
      console.log('n');
      log.error(e.message);
    }
    return page;
  }
  return {
    browser,
    openPage
  }
};

module.exports = pp;

</code></pre></div><p><strong>（3）在浏览器环境里执行 evalDom.js 和 evalDom.js 中处理 node 节点的主要逻辑</strong></p> <div class="language- extra-class"><pre class="language-text"><code>agrs.unshift(evalScripts);//evalScripts = require('../evalDOM');在puppeteer里执行evalDom.js并将config.js里配置的参数传递给evalDom
html = await page.evaluate.apply(page, agrs);

</code></pre></div><p></p> <div class="language- extra-class"><pre class="language-text"><code>//evalDom.js主要逻辑
startDraw: function () {
    const $this = this;
    const nodes = this.rootNode.childNodes;
    this.beforeRenderDomStyle();
    function childNodesStyleConcat(childNodes) {
        for (let i = 0; i &lt; childNodes.length; i++) {
            const currentChildNode = childNodes[i];//当前子节点
            //有哪些节点要跳过绘制骨架屏的过程

            if ($this.shouldIgnoreCurrentElement(currentChildNode)) { //是否应该忽略当前节点，不采取任何措施。后续这个地方可以由用户指定哪些节点应该被略去，todo
                continue;
            }

            const backgroundHasurl = analyseIfHadBackground(currentChildNode);
            const hasDirectTextChild = childrenNodesHasText(currentChildNode);//判断当前元素是不是有直接的子元素并且此元素是Text
            if ($this.customizeElement &amp;&amp; $this.customizeElement(currentChildNode) !== 0 &amp;&amp; $this.customizeElement(currentChildNode) !==  undefined) {
                //开发者自定义节点需要渲染的样子，默认返回false表示使用正常递归的算法来处理。如果返回值是true表示不会在向下递归，如果返回值是一个对象那么表示开发需要自定义样式此时直接绘制就好。todo
                if (getArgtype($this.customizeElement(currentChildNode)) === 'object') {
                    console.log('object');
                    //此处如果返回一个对象表示对象要自定义最后绘制的对象
                } else if ($this.customizeElement(currentChildNode) === 1) {
                    //如果此时返回true，表示此节点要过滤
                    getRenderStyle(currentChildNode);
                } else if ($this.customizeElement(currentChildNode) === 2){
                    continue ;
                }
                continue;
            }
            if (backgroundHasurl || analyseIsEmptyElement(currentChildNode) || hasDirectTextChild || shouldDrawCurrentNode(currentChildNode)) { //如果当前元素是内联元素或者当前元素非内联元素，但是不包含子节点或者子节点都是内联元素的话那么我们就在当前的骨架屏上绘制此节点。                   
                getRenderStyle(currentChildNode, hasDirectTextChild);
            } else if (currentChildNode.childNodes &amp;&amp; currentChildNode.childNodes.length) { //如果当前节点包含子节点
                //递归
                childNodesStyleConcat(currentChildNode.childNodes);
            }
        }
    }
    childNodesStyleConcat(nodes);
    return this.showBlocks();
},

</code></pre></div><p></p> <ul><li>上述 rootNode 为根节点，默认为 document.body 或者可以由开发指定</li> <li>主要逻辑为判断当前节点是否需要忽略、是否设置了背景图片、是否含有文本信息、开发是否指定了当前节点的处理方式等，对满足条件的渲染其对应的骨架屏节点，否则处理当前节点的子节点</li> <li>所有节点处理完成后，调用 showBlocks 将生成的骨架屏节点拼接位 HTML 字符串，以便后续处理</li></ul> <p><strong>(4) getRenderStyle 生成骨架屏样式</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const styles = [
    'position: fixed',
    `z-index: ${zIndex}`,
    `top: ${top}%`,
    `left: ${left}%`,
    `width: ${width}%`,
    `height: ${height}%`,
    'background: '+(background || '#eee'),
];
const radius = getStyle(node, 'border-radius');
radius &amp;&amp; radius != '0px' &amp;&amp; styles.push(`border-radius: ${radius}`);
blocks.push(`&lt;div style=&quot;${styles.join(';')}&quot;&gt;&lt;/div&gt;`);

</code></pre></div><ul><li>zIndex、top、left、width、height 为处理后的属性，然后把所有骨架屏节点的字符串都 push 进 blocks 这个数组中。</li></ul> <p><strong>(5) 最终生成骨架屏的 HTML 文件如下：</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;html&gt;&lt;head&gt;&lt;/head&gt;
    &lt;body&gt;&lt;div style=&quot;position: fixed;z-index: 999;top: 89.805%;left: 4.267%;width: 91.467%;height: 11.994%;background: #eee&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;

</code></pre></div><p></p> <ul><li><strong>插入骨架屏</strong></li></ul> <p>在项目入口 index.html 文件内添加</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
    &lt;/div&gt;
    &lt;% if(htmlWebpackPlugin.options.hasSkeleton) { %&gt;
        &lt;div id=&quot;skeleton&quot;&gt;&lt;!-- 骨架屏通过htmlWebpackPlugin在启动打包的时候自动注入 --&gt;
            &lt;%= htmlWebpackPlugin.options.loading.html %&gt;
        &lt;/div&gt;
    &lt;% } %&gt;
    &lt;!-- built files will be auto injected --&gt;
&lt;/body&gt;

</code></pre></div><p></p> <h1 id="四、-总结"><a href="#四、-总结" class="header-anchor">#</a> 四、 总结</h1> <p>目前，该方案已经支持由开发主动控制骨架屏生成时间，这样就避免了页面重定向的过程中无法生成正确的骨架屏，同时可以支持在本地开发时生成骨架屏。未来我们将实现支持开发自定义生成骨架屏节点的样式和组件骨架屏的生成，并优化 evalDom.js 内部节点过滤、处理的算法。敬请期待！</p> <p>最后，我们正在招聘资深前端开发工程师，欢迎感兴趣的同学发送简历至：kangcenbo@mafengwo.com。</p> <p><strong>本文作者：康岑波、孙昊男，马蜂窝电商平台前端研发工程师。</strong></p> <p><img src="Public/upload/20200318/15845021437.jpg" alt="null"></p> <p>文章来源：https://my.oschina.net/u/4084220/blog/3102803</p> <!----></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/book/73.html" class="prev">
        setTimeout和setImmediate到底谁先执行，本文让你彻底理解EventLoop
      </a></span> <span class="next"><a href="/book/68.html">
        深入理解ESModules(手绘示例)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><section class="side-anchor"><ul style="display:none;"></ul></section></div></div>
    <script src="/book/assets/js/app.c8cf2c2d.js" defer></script><script src="/book/assets/js/3.0d5fb1e8.js" defer></script><script src="/book/assets/js/154.e1f55cec.js" defer></script><script src="/book/assets/js/4.4c5f7830.js" defer></script>
  </body>
</html>
